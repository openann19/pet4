const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-stories-DX9BRjll.js","assets/react-vendor-atdIga2R.js","assets/vendor-B2U5onNE.js","assets/utils-vendor-7mYxNw04.js","assets/ui-vendor-CttiZxwU.js","assets/feature-admin-g8AIjMAb.js","assets/feature-adoption-C919WvgL.js","assets/feature-chat-CPR2_-OR.js","assets/MediaEditor-DkZveExr.js","assets/_react-native-gesture-handler-stub-B1_bHZPA.js","assets/PlaydateScheduler-CrRQOoaB.js","assets/view-CommunityView.tsx-CD5NUxZ2.js","assets/view-AdoptionView.tsx-BJlxubb2.js","assets/PetHealthDashboard-aEGjSURt.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty;import{j as t,R as a,bm as s,C as r,a as i,X as o,T as n,P as l,O as c,D as d,r as u,bn as m,bo as h,bp as p,bq as x,br as g,bs as v,bt as f,am as b,W as y,bu as j,b7 as w,a3 as N,bv as k,an as C,Y as S,a0 as E,bw as z,ac as P,a7 as L,bx as M,by as R,az as F,a1 as O,aY as A,aA as T,bz as U,ah as I,bA as _,bh as D,bi as V,bB as B,aF as $,bj as W,bC as H,bD as q,b8 as X,b9 as Y}from"./react-vendor-atdIga2R.js";import{c as K,_ as G,u as Q,a5 as Z,f as J,d as ee,F as te,M as ae,p as se,T as re,h as ie,G as oe,a3 as ne,D as le,g as ce,i as de,j as ue,k as me,L as he,a6 as pe,a7 as xe,z as ge,H as ve,J as fe,B as be,N as ye,Q as je,U as we,b as Ne,O as ke,W as Ce,a8 as Se,A as Ee,C as ze,a9 as Pe,aa as Le,ab as Me,ac as Re,E as Fe,P as Oe,ad as Ae,ae as Te,af as Ue,ag as Ie,ah as _e,Y as De,Z as Ve,$ as Be,ai as $e}from"./feature-admin-g8AIjMAb.js";import{g as We}from"./utils-vendor-7mYxNw04.js";import{R as He,a as qe}from"./feature-adoption-C919WvgL.js";import{i as Xe}from"./vendor-B2U5onNE.js";function Ye({...e}){return t.jsx(a,{"data-slot":"sheet",...e})}function Ke({...e}){return t.jsx(s,{"data-slot":"sheet-trigger",...e})}function Ge({...e}){return t.jsx(l,{"data-slot":"sheet-portal",...e})}function Qe({className:e,...a}){return t.jsx(c,{"data-slot":"sheet-overlay",className:K("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...a})}function Ze({className:e,children:a,side:s="right",...n}){return t.jsxs(Ge,{children:[t.jsx(Qe,{}),t.jsxs(r,{"data-slot":"sheet-content",className:K("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===s&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===s&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===s&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===s&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",e),...n,children:[a,t.jsxs(i,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[t.jsx(o,{className:"size-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Je({className:e,...a}){return t.jsx("div",{"data-slot":"sheet-header",className:K("flex flex-col gap-1.5 p-4",e),...a})}function et({className:e,...a}){return t.jsx(n,{"data-slot":"sheet-title",className:K("text-foreground font-semibold",e),...a})}function tt({className:e,...a}){return t.jsx(d,{"data-slot":"sheet-description",className:K("text-muted-foreground text-sm",e),...a})}const at=u.lazy(()=>G(()=>Promise.resolve().then(()=>Xt),void 0).then(e=>({default:e.MediaViewer}))),st=u.lazy(()=>G(()=>import("./feature-stories-DX9BRjll.js").then(e=>e.a),__vite__mapDeps([0,1,2,3,4,5,6,7])));u.lazy(()=>G(()=>import("./MediaEditor-DkZveExr.js"),__vite__mapDeps([8,1,2,3,4,5,6,9])).then(e=>({default:e.MediaEditor})));const rt=u.lazy(()=>G(()=>import("./PlaydateScheduler-CrRQOoaB.js"),__vite__mapDeps([10,5,1,2,3,4,6,11,12]))),it=u.lazy(()=>G(()=>import("./PetHealthDashboard-aEGjSURt.js"),__vite__mapDeps([13,1,2,3,4,5,6])));function ot({...e}){return t.jsx(m,{"data-slot":"dropdown-menu",...e})}function nt({...e}){return t.jsx(h,{"data-slot":"dropdown-menu-trigger",...e})}function lt({className:e,sideOffset:a=4,...s}){return t.jsx(p,{children:t.jsx(x,{"data-slot":"dropdown-menu-content",sideOffset:a,className:K("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...s})})}function ct({className:e,inset:a,variant:s="default",...r}){return t.jsx(g,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":s,className:K("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:text-destructive! [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-disabled:pointer-events-none data-disabled:opacity-50 data-inset:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}function dt({className:e,inset:a,...s}){return t.jsx(v,{"data-slot":"dropdown-menu-label","data-inset":a,className:K("px-2 py-1.5 text-sm font-medium data-inset:pl-8",e),...s})}function ut({className:e,...a}){return t.jsx(f,{"data-slot":"dropdown-menu-separator",className:K("bg-border -mx-1 my-1 h-px",e),...a})}function mt({className:e,variant:a="default",...s}){return t.jsx("div",{role:"status","aria-live":"polite","aria-label":"Loading content","data-slot":"skeleton",className:K("bg-muted rounded-md","default"===a&&"animate-pulse","shimmer"===a&&"relative overflow-hidden before:absolute before:inset-0 before:-translate-x-full before:animate-shimmer before:bg-gradient-to-r before:from-transparent before:via-white/10 before:to-transparent",e),...s,children:t.jsx("span",{className:"sr-only",children:"Loading..."})})}const ht=J("CommentsSheet");function pt({open:e,onOpenChange:a,postId:s,postAuthor:r}){var i,o,n,l,c,d,m;const{t:h}=Q(),[p,x]=u.useState([]),[g,v]=u.useState(!1),[f,N]=u.useState(""),[k,C]=u.useState(null),[S,E]=u.useState(!1),z=u.useRef(null),P=u.useRef(null);u.useEffect(()=>{e?L():(N(""),C(null))},[e,s]);const L=async()=>{var e;v(!0);try{const e=await Z.getComments(s);x(e)}catch(t){ht.error("Failed to load comments",t instanceof Error?t:new Error(String(t))),b.error((null==(e=h.community)?void 0:e.commentsLoadError)||"Failed to load comments")}finally{v(!1)}},M=async()=>{var e,t;if(f.trim()&&!S){ie.impact(),E(!0);try{const t={text:f.trim()},a=(null==k?void 0:k._id)??(null==k?void 0:k.id);a&&(t.parentId=a);const r=await Z.addComment(s,t);x(e=>k?[...e||[],r]:[r,...e||[]]),N(""),C(null),ie.success(),b.success((null==(e=h.community)?void 0:e.commentPosted)||"Comment posted!"),setTimeout(()=>{var e;null==(e=P.current)||e.scrollTo({top:0,behavior:"smooth"})},100)}catch(a){ht.error("Failed to post comment",a instanceof Error?a:new Error(String(a))),b.error((null==(t=h.community)?void 0:t.commentError)||"Failed to post comment"),ie.error()}finally{E(!1)}}},R=e=>{var t;C(e),null==(t=z.current)||t.focus(),ie.selection()},F=p.filter(e=>!e.parentId),O=e=>p.filter(t=>t.parentId===e),A=e=>e._id??e.id??null;return t.jsx(Ye,{open:e,onOpenChange:a,children:t.jsxs(Ze,{side:"bottom",className:"h-[85vh] flex flex-col p-0 gap-0",children:[t.jsx(Je,{className:"px-6 py-4 border-b border-border shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx(et,{className:"text-xl",children:(null==(i=h.community)?void 0:i.comments)||"Comments"}),t.jsxs(tt,{className:"text-sm text-muted-foreground mt-1",children:[p.length," ",1===p.length?"comment":"comments"]})]}),t.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>a(!1),className:"rounded-full",children:t.jsx(y,{size:24})})]})}),t.jsx(te,{ref:P,className:"flex-1 px-6",children:t.jsx("div",{className:"py-4 space-y-6",children:g&&0===p.length?Array.from({length:3}).map((e,a)=>t.jsx("div",{className:"space-y-3",children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx(mt,{className:"h-10 w-10 rounded-full shrink-0"}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx(mt,{className:"h-4 w-24"}),t.jsx(mt,{className:"h-16 w-full"})]})]})},a)):0===p.length?t.jsxs(ae,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-16",children:[t.jsx(ae,{animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"text-6xl mb-4",children:"ðŸ’¬"}),t.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:(null==(o=h.community)?void 0:o.noComments)||"No comments yet"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:(null==(n=h.community)?void 0:n.beFirst)||"Be the first to share your thoughts!"})]}):t.jsx(se,{visible:F.length>0,children:F.map((e,a)=>{const s=A(e);return s?t.jsx(xt,{comment:e,index:a,postAuthor:r,getReplies:O,onReply:R,getCommentId:A},s):null})})})}),t.jsxs("div",{className:"shrink-0 border-t border-border bg-card/50 backdrop-blur-xl",children:[t.jsx(se,{visible:!!k,children:k&&t.jsx(ae,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:t.jsxs("div",{className:"px-6 py-3 bg-muted/50 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(j,{size:16,className:"text-muted-foreground"}),t.jsx("span",{className:"text-muted-foreground",children:(null==(l=h.community)?void 0:l.replyingTo)||"Replying to"}),t.jsxs("span",{className:"font-medium text-foreground",children:["@",k.authorName]})]}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>{C(null),ie.selection()},className:"h-7 text-xs",children:(null==(c=h.common)?void 0:c.cancel)||"Cancel"})]})})}),t.jsxs("div",{className:"px-6 py-4",children:[t.jsxs("div",{className:"flex gap-3 items-end",children:[t.jsx(re,{ref:z,value:f,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),M())},placeholder:k?(null==(d=h.community)?void 0:d.replyPlaceholder)||"Write a reply...":(null==(m=h.community)?void 0:m.commentPlaceholder)||"Write a comment...",className:"min-h-[44px] max-h-[120px] resize-none",maxLength:500}),t.jsx(ee,{onClick:M,disabled:!f.trim()||S,size:"icon",className:"h-11 w-11 shrink-0",children:S?t.jsx(ae,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:t.jsx(w,{size:20,weight:"bold"})}):t.jsx(w,{size:20,weight:"bold"})})]}),f.length>0&&t.jsxs(ae,{initial:{opacity:0},animate:{opacity:1},className:"text-xs text-muted-foreground mt-2 text-right",children:[f.length,"/500"]})]})]})]})})}function xt({comment:e,index:a,postAuthor:s,getReplies:r,onReply:i,getCommentId:o}){const n=o(e);if(!n)return t.jsx(t.Fragment,{});const l=r(n);return t.jsxs(ae,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},children:[t.jsx(gt,{comment:e,onReply:i,isAuthor:e.authorName===s}),l.length>0&&t.jsx("div",{className:"ml-12 mt-4 space-y-4 pl-4 border-l-2 border-border/50",children:l.map(e=>{const a=o(e);return a?t.jsx(gt,{comment:e,onReply:i,isReply:!0,isAuthor:e.authorName===s},a):null})})]})}function gt({comment:e,onReply:a,isReply:s=!1,isAuthor:r=!1}){var i,o,n,l;const{t:c}=Q(),[d,m]=u.useState(!1),[h,p]=u.useState(e.reactionsCount??0);return t.jsxs("div",{className:"flex gap-3 group",children:[t.jsx(oe,{className:"h-10 w-10 shrink-0",children:e.authorAvatar?t.jsx("img",{src:e.authorAvatar,alt:e.authorName,className:"object-cover"}):t.jsx("div",{className:"w-full h-full bg-primary/10 flex items-center justify-center text-primary font-semibold text-sm",children:(null==(o=null==(i=e.authorName)?void 0:i[0])?void 0:o.toUpperCase())??"?"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"bg-muted/50 rounded-2xl px-4 py-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-semibold text-sm text-foreground",children:e.authorName}),r&&t.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-primary/15 text-primary font-medium rounded",children:(null==(n=c.community)?void 0:n.author)||"Author"}),t.jsx("span",{className:"text-xs text-muted-foreground",children:We(new Date(e.createdAt),{addSuffix:!0})})]}),t.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap wrap-break-word",children:e.text})]}),t.jsxs("div",{className:"flex items-center gap-4 mt-2 ml-4",children:[t.jsxs("button",{onClick:async()=>{ie.selection(),d?(m(!1),p(e=>Math.max(0,e-1))):(m(!0),p(e=>e+1),ie.success())},className:"flex items-center gap-1 group/like",children:[t.jsx(ae,{whileTap:{scale:.85},children:t.jsx(N,{size:16,weight:d?"fill":"regular",className:"transition-colors "+(d?"text-red-500":"text-muted-foreground group-hover/like:text-red-500")})}),h>0&&t.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:h})]}),!s&&t.jsx("button",{onClick:()=>a(e),className:"text-xs font-medium text-muted-foreground hover:text-foreground transition-colors",children:(null==(l=c.community)?void 0:l.reply)||"Reply"}),t.jsx("button",{className:"opacity-0 group-hover:opacity-100 transition-opacity ml-auto",children:t.jsx(k,{size:16,weight:"bold",className:"text-muted-foreground"})})]})]})]})}const vt=[{value:"spam",label:"Spam",description:"Repetitive, unwanted, or promotional content"},{value:"harassment",label:"Harassment",description:"Bullying, threats, or personal attacks"},{value:"inappropriate",label:"Inappropriate Content",description:"Content that violates community guidelines"},{value:"misleading",label:"Misleading Information",description:"False or deceptive information"},{value:"violence",label:"Violence",description:"Depicts or promotes violence"},{value:"hate-speech",label:"Hate Speech",description:"Discriminatory or offensive language"},{value:"copyright",label:"Copyright Violation",description:"Unauthorized use of copyrighted material"},{value:"other",label:"Other",description:"Other reason not listed above"}];function ft({open:e,onOpenChange:a,resourceType:s,resourceId:r,resourceName:i,onReported:o}){const[n,l]=u.useState(""),[c,d]=u.useState(""),[m,h]=u.useState(!1),p=ne(),x=p?{duration:0}:{duration:.2,ease:[.4,0,.2,1]},g=()=>{l(""),d(""),a(!1)},v="post"===s?"post":"comment"===s?"comment":"user";return t.jsx(le,{open:e,onOpenChange:a,children:t.jsxs(ce,{className:"sm:max-w-[500px]","aria-describedby":"report-description",children:[t.jsxs(de,{children:[t.jsxs(ue,{className:"flex items-center gap-2",children:[t.jsx(C,{className:"w-5 h-5 text-destructive"}),"Report ",v.charAt(0).toUpperCase()+v.slice(1)]}),t.jsxs(me,{id:"report-description",children:[i&&t.jsxs("span",{className:"block mb-2",children:["Reporting: ",t.jsx("strong",{children:i})]}),"Help us maintain a safe community by reporting content that violates our guidelines."]})]}),t.jsxs("div",{className:"space-y-4 py-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(he,{htmlFor:"report-reason",children:"Reason for reporting"}),t.jsx(He,{value:n,onValueChange:e=>l(e),id:"report-reason","aria-label":"Select report reason",children:vt.map(e=>t.jsxs(ae,{className:"flex items-start space-x-3 p-3 rounded-lg border border-border hover:bg-accent/50 transition-colors",whileHover:p?{}:{scale:1.01},transition:x,children:[t.jsx(qe,{value:e.value,id:e.value,className:"mt-1"}),t.jsxs(he,{htmlFor:e.value,className:"flex-1 cursor-pointer space-y-1",children:[t.jsx("div",{className:"font-medium",children:e.label}),t.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.value))})]}),n&&t.jsxs(ae,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:x,className:"space-y-2",children:[t.jsxs(he,{htmlFor:"report-details",children:["Additional details ",t.jsx("span",{className:"text-muted-foreground",children:"(optional)"})]}),t.jsx(re,{id:"report-details",value:c,onChange:e=>d(e.target.value),placeholder:"Provide any additional information that might help our review...",rows:4,className:"resize-none","aria-label":"Additional details for report"})]})]}),t.jsxs(pe,{children:[t.jsx(ee,{variant:"outline",onClick:g,disabled:m,"aria-label":"Cancel report",children:"Cancel"}),t.jsx(ee,{onClick:async()=>{if(n){h(!0),ie.trigger("medium");try{const e=await spark.user(),t={resourceType:s,resourceId:r,reason:n,reporterId:e.id},a=c.trim();a&&(t.details=a),await xe.reportContent(t),b.success("Report submitted successfully. Our team will review it.",{duration:3e3}),null==o||o(),g()}catch(e){b.error("Failed to submit report. Please try again.")}finally{h(!1)}}else b.error("Please select a reason for reporting")},disabled:!n||m,className:"bg-destructive hover:bg-destructive/90","aria-label":"Submit report",children:m?"Submitting...":"Submit Report"})]})]})})}const bt=J("PostDetailView");function yt({open:e,onOpenChange:a,postId:s,onAuthorClick:r}){var i;const{t:o}=Q(),[n,l]=u.useState(null),[c,d]=u.useState([]),[m,h]=u.useState(!0),[p,x]=u.useState(!1),[g,v]=u.useState(!1),[f,y]=u.useState(!1),[j,w]=u.useState(0),[k,C]=u.useState(""),[F,O]=u.useState(!1),[A,T]=u.useState(!1),[U,I]=u.useState(0),[_,D]=u.useState(!1),V=u.useRef(null);u.useEffect(()=>{e&&s?(B(),$()):(l(null),d([]),C(""))},[e,s]);const B=async()=>{h(!0);try{const e=await xe.getPostById(s);e?(l(e),w(e.reactionsCount||0),ge.user().then(e=>{(null==e?void 0:e.id)?(Z.isPostSaved(s).then(e=>y(e)).catch(()=>y(!1)),v(!1)):(v(!1),y(!1))}).catch(()=>{v(!1),y(!1)})):(b.error("Post not found"),a(!1))}catch(e){const t=e instanceof Error?e:new Error(String(e));bt.error("Failed to load post",t,{postId:s}),b.error("Failed to load post"),a(!1)}finally{h(!1)}},$=async()=>{x(!0);try{const e=await Z.getComments(s);d(e),setTimeout(()=>{var e;null==(e=V.current)||e.scrollIntoView({behavior:"smooth"})},100)}catch(e){const t=e instanceof Error?e:new Error(String(e));bt.error("Failed to load comments",t,{postId:s})}finally{x(!1)}},W=async()=>{if(n&&k.trim()){O(!0);try{const e=await ge.user();if(!e)return void b.error("You must be logged in to comment");const t="string"==typeof e.id?e.id:"",a="string"==typeof e.name?e.name:"User",s={postId:n.id,text:k.trim(),authorId:t,authorName:a},r="string"==typeof e.avatarUrl?e.avatarUrl:void 0;void 0!==r&&(s.authorAvatar=r),await xe.createComment(s),C(""),await $(),ie.impact("medium")}catch(e){const t=e instanceof Error?e:new Error(String(e));bt.error("Failed to submit comment",t),b.error("Failed to submit comment")}finally{O(!1)}}};if(!e)return null;const H=((null==n?void 0:n.media)||[]).map((e,t)=>"string"==typeof e?{id:`media-${t}`,url:e,type:"photo"}:e);return t.jsxs(t.Fragment,{children:[t.jsx(le,{open:e,onOpenChange:a,children:t.jsx(ce,{className:"max-w-4xl max-h-[90vh] p-0 gap-0 overflow-hidden",children:m?t.jsxs("div",{className:"p-6 space-y-4",children:[t.jsx(mt,{className:"h-12 w-full"}),t.jsx(mt,{className:"h-64 w-full"}),t.jsx(mt,{className:"h-32 w-full"})]}):n?t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[t.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>a(!1),className:"rounded-full","aria-label":"Close post details",children:t.jsx(S,{size:20})}),t.jsx("h2",{className:"text-lg font-semibold",children:"Post Details"}),t.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>D(!0),className:"rounded-full","aria-label":"Report post",children:t.jsx(E,{size:20})})]}),t.jsx(te,{className:"flex-1",children:t.jsxs("div",{className:"p-4 space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs(oe,{className:"w-12 h-12",children:[t.jsx(ve,{src:n.authorAvatar,alt:n.authorName}),t.jsx(fe,{children:n.authorName.charAt(0).toUpperCase()})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("button",{onClick:()=>null==r?void 0:r(n.authorId),className:"font-semibold hover:underline",children:n.authorName}),t.jsx("p",{className:"text-sm text-muted-foreground",children:We(new Date(n.createdAt),{addSuffix:!0})})]})]}),n.text&&t.jsx("p",{className:"text-base leading-relaxed whitespace-pre-wrap",children:n.text}),H.length>0&&t.jsx("div",{className:"grid grid-cols-2 gap-2",children:H.map((e,a)=>{const s="string"==typeof e?e:e.url;return t.jsx("button",{onClick:()=>{I(a),T(!0)},className:"relative aspect-square rounded-lg overflow-hidden bg-muted",children:t.jsx("img",{src:s,alt:`Post media ${a+1}`,className:"w-full h-full object-cover"})},a)})}),(n.tags&&n.tags.length>0||n.location)&&t.jsxs("div",{className:"flex flex-wrap gap-2",children:[null==(i=n.tags)?void 0:i.map(e=>t.jsxs(be,{variant:"secondary",className:"text-xs",children:[t.jsx(z,{size:12,className:"mr-1"}),e]},e)),n.location&&t.jsxs(be,{variant:"outline",className:"text-xs",children:[t.jsx(P,{size:12,className:"mr-1"}),n.location.city,", ",n.location.country]})]}),t.jsxs("div",{className:"flex items-center gap-4 py-4 border-t border-b",children:[t.jsxs("button",{onClick:async()=>{if(n){ie.impact("light");try{const e=await ge.user();if(!e)return void b.error("You must be logged in to react");const t="string"==typeof e.id?e.id:"",a="string"==typeof e.name?e.name:"User",s=await xe.toggleReaction(n.id,t,a,"string"==typeof e.avatarUrl?e.avatarUrl:void 0,"â¤ï¸");v(s.added),w(s.reactionsCount),s.added&&ie.impact("medium")}catch(e){const t=e instanceof Error?e:new Error(String(e));bt.error("Failed to toggle reaction",t),b.error("Failed to react to post")}}},className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[t.jsx(N,{size:24,weight:g?"fill":"regular",className:g?"text-red-500":""}),t.jsx("span",{className:"text-sm font-medium",children:j})]}),t.jsxs("button",{onClick:()=>{var e;return null==(e=V.current)?void 0:e.scrollIntoView({behavior:"smooth"})},className:"flex items-center gap-2 hover:opacity-80 transition-opacity",children:[t.jsx(L,{size:24}),t.jsx("span",{className:"text-sm font-medium",children:c.length})]}),t.jsx("button",{onClick:async()=>{var e,t;if(n){ie.impact("light");try{f?(await Z.unsavePost(n.id),y(!1),b.success((null==(e=o.community)?void 0:e.unsaved)||"Post removed from saved")):(await Z.savePost(n.id),y(!0),b.success((null==(t=o.community)?void 0:t.saved)||"Post saved"))}catch(a){const e=a instanceof Error?a:new Error(String(a));bt.error("Failed to save post",e),b.error("Failed to save post")}}},className:"hover:opacity-80 transition-opacity",children:t.jsx(M,{size:24,weight:f?"fill":"regular",className:f?"text-primary":""})}),t.jsx("button",{onClick:async()=>{if(n){ie.impact("light");try{navigator.share?await navigator.share({title:`Post by ${n.authorName}`,...n.text?{text:n.text}:{},url:window.location.href}):(await navigator.clipboard.writeText(window.location.href),b.success("Link copied to clipboard"))}catch(e){}}},className:"hover:opacity-80 transition-opacity",children:t.jsx(R,{size:24})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"font-semibold",children:["Comments (",c.length,")"]}),p?t.jsxs("div",{className:"space-y-4",children:[t.jsx(mt,{className:"h-20 w-full"}),t.jsx(mt,{className:"h-20 w-full"})]}):0===c.length?t.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No comments yet. Be the first to comment!"}):t.jsxs("div",{className:"space-y-6",children:[c.filter(e=>!e.parentCommentId&&!e.parentId).map(e=>{const a=e._id||e.id,s=(e=>c.filter(t=>(t.parentCommentId||t.parentId)===e))(a);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(oe,{className:"w-10 h-10",children:[t.jsx(ve,{src:e.authorAvatar,alt:e.authorName}),t.jsx(fe,{children:e.authorName.charAt(0).toUpperCase()})]}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[t.jsx("p",{className:"font-semibold text-sm",children:e.authorName}),t.jsx("p",{className:"text-sm mt-1",children:e.text})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:We(new Date(e.createdAt),{addSuffix:!0})})]})]}),s.length>0&&t.jsx("div",{className:"ml-12 space-y-4 pl-4 border-l-2 border-border/50",children:s.map(e=>{const a=e._id||e.id;return t.jsxs("div",{className:"flex gap-3",children:[t.jsxs(oe,{className:"w-8 h-8",children:[t.jsx(ve,{src:e.authorAvatar,alt:e.authorName}),t.jsx(fe,{children:e.authorName.charAt(0).toUpperCase()})]}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"bg-muted/50 rounded-lg p-2",children:[t.jsx("p",{className:"font-semibold text-xs",children:e.authorName}),t.jsx("p",{className:"text-sm mt-1",children:e.text})]}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:We(new Date(e.createdAt),{addSuffix:!0})})]})]},a)})})]},a)}),t.jsx("div",{ref:V})]})]})]})}),t.jsx("div",{className:"p-4 border-t bg-background",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(re,{value:k,onChange:e=>C(e.target.value),placeholder:"Add a comment...",rows:2,className:"resize-none",onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&W()}}),t.jsx(ee,{onClick:W,disabled:!k.trim()||F,className:"self-end",children:"Post"})]})})]}):null})}),A&&t.jsx(u.Suspense,{fallback:t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:t.jsx(at,{open:A,onOpenChange:T,media:H,initialIndex:U,authorName:(null==n?void 0:n.authorName)||""})}),n&&t.jsx(ft,{open:_,onOpenChange:D,resourceType:"post",resourceId:n.id,resourceName:`Post by ${n.authorName}`,onReported:()=>{b.success("Report submitted. Thank you for helping keep our community safe.")}})]})}const jt=J("PostCard");const wt=u.memo(function({post:e,onAuthorClick:a,onPostClick:s}){var r,i,o,n,l,c,d,m,h;const{t:p}=Q(),[x,g]=u.useState(!1),[v,f]=u.useState(!1),[y,j]=u.useState(e.reactionsCount??0),[w,C]=u.useState(0),[S,F]=u.useState(!1),[O,A]=u.useState(!1),[T,U]=u.useState(!1),[I,_]=u.useState(0),[D,V]=u.useState(!1),[B,$]=u.useState(!1),W=ye(0),H=ye(20);u.useEffect(()=>{W.value=je(1),H.value=je(0)},[W,H]);const q=we(()=>({opacity:W.value,transform:[{translateY:H.value}]})),X=Ne({hoverScale:1,tapScale:1,damping:25,stiffness:400}),Y=ye(0),K=we(()=>({transform:[{translateX:Y.value},{scale:X.scale.value}]})),G=u.useCallback(()=>{X.handleMouseEnter(),Y.value=ke(2)},[X,Y]),J=u.useCallback(()=>{X.handleMouseLeave(),Y.value=ke(0)},[X,Y]),te=Ne({hoverScale:1.05,tapScale:.95,damping:20,stiffness:400}),ae=Ne({hoverScale:1.08,tapScale:.95}),se=ye(0);u.useEffect(()=>{se.value=je(1)},[w,se]);const re=we(()=>({opacity:se.value})),ie=ye(1);u.useEffect(()=>{x&&(ie.value=Ce(ke(1.3),ke(1)))},[x,ie]);const ne=Ne({tapScale:.85}),le=we(()=>({transform:[{scale:ie.value*ne.scale.value}]})),ce=Ne({tapScale:.85});u.useEffect(()=>{g(!1),f(!1)},[e.id]);const de=u.useCallback(async()=>{Se("selection");try{const t=window.spark;if(!t)return void b.error("User service not available");const a=await t.user(),s=await xe.toggleReaction(e.id,a.id,a.login??"User",a.avatarUrl,"â¤ï¸");g(s.added),j(s.reactionsCount),s.added&&Se("success")}catch(t){jt.error("Failed to toggle reaction",t instanceof Error?t:new Error(String(t))),b.error("Failed to react to post")}},[e.id,jt]),ue=u.useCallback(async()=>{var t,a,s;try{Se("selection"),v?(await Z.unsavePost(e.id),f(!1),b.success((null==(t=p.community)?void 0:t.unsaved)||"Post removed from saved")):(await Z.savePost(e.id),f(!0),b.success((null==(a=p.community)?void 0:a.saved)||"Post saved"))}catch(r){const t=r instanceof Error?r:new Error(String(r));jt.error("PostCard handleSave error",t,{postId:e.id,isSaved:v}),b.error((null==(s=p.community)?void 0:s.saveError)||"Failed to save post. Please try again.")}},[v,e.id,p,jt]),me=u.useCallback(async()=>{var t,a,s,r,i,o;try{if(Se("selection"),"undefined"!=typeof navigator&&navigator.share)try{await navigator.share({title:`Post by ${e.authorName}`,text:(null==(t=e.text)?void 0:t.slice(0,100))??"",url:`${window.location.origin}/community/post/${e.id}`})}catch(n){if(n instanceof Error&&"AbortError"!==n.name){const t=n instanceof Error?n:new Error(String(n));jt.error("PostCard handleShare navigator.share error",t,{postId:e.id}),b.error((null==(a=p.community)?void 0:a.shareError)||"Failed to share post. Please try again.")}}else if("undefined"!=typeof navigator&&navigator.clipboard)try{await navigator.clipboard.writeText(`${window.location.origin}/community/post/${e.id}`),b.success((null==(s=p.community)?void 0:s.linkCopied)||"Link copied to clipboard")}catch(n){const t=n instanceof Error?n:new Error(String(n));jt.error("PostCard handleShare clipboard.writeText error",t,{postId:e.id}),b.error((null==(r=p.community)?void 0:r.clipboardError)||"Failed to copy link. Please try again.")}else jt.warn("PostCard handleShare navigator.share and navigator.clipboard not available"),b.error((null==(i=p.community)?void 0:i.shareError)||"Sharing is not supported in this browser.")}catch(n){const t=n instanceof Error?n:new Error(String(n));jt.error("PostCard handleShare error",t,{postId:e.id}),b.error((null==(o=p.community)?void 0:o.shareError)||"Failed to share post. Please try again.")}},[e.authorName,e.text,e.id,p,jt]),he=u.useCallback(()=>{try{Se("selection"),V(!0)}catch(t){const a=t instanceof Error?t:new Error(String(t));jt.error("PostCard handleReport error",a,{postId:e.id})}},[e.id,jt]),pe=u.useCallback(t=>{var a;try{if(t<0||!Array.isArray(e.media)||t>=e.media.length)return void jt.warn("PostCard handleMediaClick invalid index",{postId:e.id,index:t,mediaLength:(null==(a=e.media)?void 0:a.length)??0});_(t),U(!0),Se("selection")}catch(s){const a=s instanceof Error?s:new Error(String(s));jt.error("PostCard handleMediaClick error",a,{postId:e.id,index:t})}},[e.id,e.media,jt]),ge=u.useCallback(t=>{try{const a=t.target;if(a.closest("button")||a.closest('[role="button"]')||a.closest("a")||a.closest('[role="link"]'))return;Se("selection"),$(!0),null==s||s(e.id)}catch(a){const t=a instanceof Error?a:new Error(String(a));jt.error("PostCard handleCardClick error",t,{postId:e.id})}},[s,e.id,jt]),ve=u.useCallback(()=>{try{A(!0),Se("selection")}catch(t){const a=t instanceof Error?t:new Error(String(t));jt.error("PostCard handleCommentClick error",a,{postId:e.id})}},[e.id,jt]),fe=((null==(r=e.text)?void 0:r.length)??0)>150?(null==(i=e.text)?void 0:i.slice(0,150))+"...":e.text??"",Pe=((null==(o=e.text)?void 0:o.length)??0)>150,Le=(e.media??[]).map((e,t)=>{if("string"==typeof e)return{id:`media-${t}`,url:e,thumbnail:e,type:"photo"};{const a={id:e.id||`media-${t}`,url:e.url,thumbnail:e.thumbnail??e.url,type:e.type};return void 0!==e.width&&(a.width=e.width),void 0!==e.height&&(a.height=e.height),a}});return t.jsxs(t.Fragment,{children:[t.jsx(Ee,{style:q,children:t.jsxs(ze,{className:"overflow-hidden bg-linear-to-br from-card via-card to-card/95 border border-border/60 shadow-lg hover:shadow-xl hover:border-border transition-all duration-500 backdrop-blur-sm cursor-pointer",onClick:ge,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 pb-3",children:[t.jsxs(Ee,{style:K,onMouseEnter:G,onMouseLeave:J,onClick:()=>null==a?void 0:a(e.authorId),className:"flex items-center gap-3 group cursor-pointer",children:[t.jsx(Ee,{style:te.animatedStyle,onMouseEnter:te.handleMouseEnter,onMouseLeave:te.handleMouseLeave,onClick:te.handlePress,children:t.jsx(oe,{className:"h-11 w-11 ring-2 ring-primary/10 group-hover:ring-primary/30 transition-all duration-300",children:e.authorAvatar?t.jsx("img",{src:e.authorAvatar,alt:e.authorName,className:"object-cover"}):t.jsx("div",{className:"w-full h-full bg-linear-to-br from-primary/20 to-accent/20 flex items-center justify-center text-primary font-bold text-base",children:(null==(l=null==(n=e.authorName)?void 0:n[0])?void 0:l.toUpperCase())??"?"})})}),t.jsxs("div",{className:"text-left",children:[t.jsx("p",{className:"font-semibold text-sm text-foreground group-hover:text-primary transition-colors duration-200",children:e.authorName}),t.jsx("p",{className:"text-xs text-muted-foreground",children:We(new Date(e.createdAt),{addSuffix:!0})})]})]}),t.jsxs(ot,{children:[t.jsx(nt,{asChild:!0,children:t.jsx(Ee,{style:ae.animatedStyle,onMouseEnter:ae.handleMouseEnter,onMouseLeave:ae.handleMouseLeave,onClick:ae.handlePress,children:t.jsx(ee,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-primary/10 transition-colors duration-200","aria-label":"Post options",children:t.jsx(k,{size:22,weight:"bold"})})})}),t.jsx(lt,{align:"end",children:t.jsxs(ct,{onClick:he,className:"text-destructive",children:[t.jsx(E,{size:18,className:"mr-2"}),"Report Post"]})})]})]}),e.text&&t.jsxs("div",{className:"px-4 pb-3",children:[t.jsx("p",{className:"text-foreground whitespace-pre-wrap wrap-break-word",children:S?e.text:fe}),Pe&&t.jsx("button",{onClick:()=>F(!S),className:"text-sm text-primary font-medium mt-1 hover:underline",children:S?(null==(c=p.community)?void 0:c.showLess)||"Show less":(null==(d=p.community)?void 0:d.showMore)||"Show more"})]}),e.media&&e.media.length>0&&e.media[w]&&t.jsxs("div",{className:"relative bg-muted",children:[t.jsx("div",{className:"relative aspect-square overflow-hidden",children:t.jsx(Ee,{style:re,className:"w-full h-full",children:t.jsx("img",{src:"string"==typeof e.media[w]?e.media[w]:e.media[w].url,alt:"Post media",className:"w-full h-full object-cover cursor-pointer",onClick:()=>pe(w)},w)})}),e.media.length>1&&t.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5",children:e.media.map((e,a)=>t.jsx("button",{onClick:()=>C(a),className:"h-1.5 rounded-full transition-all duration-300 "+(a===w?"w-6 bg-white":"w-1.5 bg-white/50 hover:bg-white/75"),"aria-label":`View photo ${a+1}`},a))}),e.media.length>1&&t.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs font-medium px-2 py-1 rounded-full backdrop-blur-sm",children:[w+1," / ",e.media.length]})]}),t.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("button",{onClick:()=>{de()},className:"flex items-center gap-1.5 group",children:[t.jsx(Ee,{style:le,onMouseEnter:ne.handleMouseEnter,onMouseLeave:ne.handleMouseLeave,onClick:ne.handlePress,children:t.jsx(N,{size:24,weight:x?"fill":"regular",className:"transition-colors "+(x?"text-red-500":"text-foreground group-hover:text-red-500")})}),y>0&&t.jsx("span",{className:"text-sm font-medium text-foreground",children:y})]}),t.jsxs("button",{onClick:ve,className:"flex items-center gap-1.5 group",children:[t.jsx(L,{size:24,weight:"regular",className:"text-foreground group-hover:text-primary transition-colors"}),(e.commentsCount??0)>0&&t.jsx("span",{className:"text-sm font-medium text-foreground",children:e.commentsCount??0})]}),t.jsx("button",{onClick:()=>{me()},className:"group",children:t.jsx(R,{size:24,weight:"regular",className:"text-foreground group-hover:text-primary transition-colors"})})]}),t.jsx("button",{onClick:()=>{ue()},children:t.jsx(Ee,{style:ce.animatedStyle,onMouseEnter:ce.handleMouseEnter,onMouseLeave:ce.handleMouseLeave,onClick:ce.handlePress,children:t.jsx(M,{size:24,weight:v?"fill":"regular",className:"transition-colors "+(v?"text-primary":"text-foreground hover:text-primary")})})})]}),(((null==(m=e.tags)?void 0:m.length)??0)>0||e.location)&&t.jsxs("div",{className:"px-4 pb-3 flex flex-wrap gap-2",children:[null==(h=e.tags)?void 0:h.slice(0,3).map(e=>t.jsxs(be,{variant:"secondary",className:"text-xs",children:[t.jsx(z,{size:12,className:"mr-1"}),e]},e)),e.location&&t.jsxs(be,{variant:"outline",className:"text-xs",children:[t.jsx(P,{size:12,className:"mr-1"}),e.location.city,", ",e.location.country]})]}),(e.viewsCount??0)>0&&t.jsxs("div",{className:"px-4 pb-3 text-xs text-muted-foreground",children:[e.viewsCount," ",1===e.viewsCount?"view":"views"]}),t.jsx(pt,{open:O,onOpenChange:A,postId:e.id,postAuthor:e.authorName}),T&&t.jsx(u.Suspense,{fallback:t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"})}),children:t.jsx(at,{open:T,onOpenChange:U,media:Le,initialIndex:I,authorName:e.authorName})}),t.jsx(ft,{open:D,onOpenChange:V,resourceType:"post",resourceId:e.id,resourceName:`Post by ${e.authorName}`,onReported:()=>{b.success("Report submitted. Thank you for helping keep our community safe.")}})]})}),t.jsx(yt,{open:B,onOpenChange:$,postId:e.id,...a?{onAuthorClick:a}:{}})]})},(e,t)=>e.post.id===t.post.id&&e.post.reactionsCount===t.post.reactionsCount&&e.post.commentsCount===t.post.commentsCount&&e.post.text===t.post.text),Nt=J("ImageUpload"),kt={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,initialQuality:.85};async function Ct(e,t={}){var a,s;try{const i=function(e){const t=["image/jpeg","image/jpg","image/png","image/webp","image/gif"];return t.includes(e.type)?e.size>52428800?{valid:!1,error:`File too large: ${(e.size/1024/1024).toFixed(2)}MB. Maximum size: 50MB`}:{valid:!0}:{valid:!1,error:`Invalid file type: ${e.type}. Allowed types: ${t.join(", ")}`}}(e);if(!i.valid)throw new Error(i.error||"Invalid image file");const o=await function(e){return new Promise((t,a)=>{const s=new Image,r=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(r),t({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{URL.revokeObjectURL(r),a(new Error("Failed to load image"))},s.src=r})}(e),n=e.size;Nt.debug("Compressing image",{originalSize:n,options:{...kt,...t}});const l=await Xe(e,{maxSizeMB:t.maxSizeMB??kt.maxSizeMB??1,maxWidthOrHeight:t.maxWidthOrHeight??kt.maxWidthOrHeight??1920,useWebWorker:t.useWebWorker??kt.useWebWorker??!0,fileType:t.fileType||e.type,initialQuality:t.initialQuality??kt.initialQuality??.85});Nt.debug("Stripping EXIF data");const c=await async function(e){return new Promise((t,a)=>{const s=new FileReader;s.onload=s=>{var r;const i=null==(r=s.target)?void 0:r.result;if(!(i&&i instanceof ArrayBuffer))return void a(new Error("Failed to read file"));const o=new Blob([i],{type:e.type}),n=new File([o],e.name,{type:e.type,lastModified:Date.now()});t(n)},s.onerror=()=>{a(new Error("Failed to read file for EXIF stripping"))},s.readAsArrayBuffer(e)})}(l),d=`images/${Pe()}.${c.type.split("/")[1]||"jpg"}`,u=await c.arrayBuffer();let m=`/api/images/${d}`;try{const e=new FormData,t=new Blob([u],{type:c.type});e.append("file",t,d),e.append("key",d);const r=await Le.post(Me.IMAGES.UPLOAD,e,{headers:{}});(null==(a=r.data)?void 0:a.url)?m=r.data.url:(null==(s=r.data)?void 0:s.key)&&(m=`/api/images/${r.data.key}`),Nt.debug("Image uploaded to API",{key:d,url:m})}catch(r){Nt.warn("Failed to upload image to API, storing locally",{error:r,key:d})}return await Re.set(d,u),Nt.info("Image uploaded successfully",{key:d,url:m,originalSize:n,compressedSize:c.size,compressionRatio:(100*(1-c.size/n)).toFixed(2)+"%",dimensions:o}),{url:m,key:d,originalSize:n,compressedSize:c.size,width:o.width,height:o.height}}catch(i){const t=i instanceof Error?i:new Error(String(i));throw Nt.error("Failed to upload image",t,{fileName:e.name,fileSize:e.size,fileType:e.type}),new Error(`Failed to upload image: ${t.message}`)}}class St{static async getVideoMetadata(e){return new Promise((t,a)=>{const s=document.createElement("video");s.preload="metadata",s.onloadedmetadata=()=>{URL.revokeObjectURL(s.src),t({duration:s.duration,width:s.videoWidth,height:s.videoHeight,size:e.size,type:e.type})},s.onerror=e=>{URL.revokeObjectURL(s.src);const t=e instanceof Error?e.message:"Failed to load video metadata";a(new Error(t))},s.src=URL.createObjectURL(e)})}static async extractThumbnail(e,t=0){return new Promise((a,s)=>{const r=document.createElement("video"),i=document.createElement("canvas"),o=i.getContext("2d");o?(r.preload="metadata",r.currentTime=t,r.onseeked=()=>{i.width=r.videoWidth,i.height=r.videoHeight,o.drawImage(r,0,0,i.width,i.height);const e=i.toDataURL("image/jpeg",.8);URL.revokeObjectURL(r.src),a(e)},r.onerror=e=>{URL.revokeObjectURL(r.src);const t=e instanceof Error?e.message:"Failed to extract thumbnail";s(new Error(t))},r.src=URL.createObjectURL(e)):s(new Error("Failed to get canvas context"))})}static async compressVideo(e,t={},a){const s={maxSizeMB:t.maxSizeMB??this.DEFAULT_OPTIONS.maxSizeMB,maxWidthOrHeight:t.maxWidthOrHeight??this.DEFAULT_OPTIONS.maxWidthOrHeight,maxDurationSeconds:t.maxDurationSeconds??this.DEFAULT_OPTIONS.maxDurationSeconds??60,quality:t.quality??this.DEFAULT_OPTIONS.quality};null==a||a({stage:"analyzing",progress:0,message:"Analyzing video..."});const r=await this.getVideoMetadata(e),i=s.maxDurationSeconds??this.DEFAULT_OPTIONS.maxDurationSeconds??60;if(r.duration>i)throw new Error(`Video duration must be less than ${i} seconds`);const o=r.size/1048576;if(!(r.width>s.maxWidthOrHeight||r.height>s.maxWidthOrHeight)&&!(o>s.maxSizeMB))return null==a||a({stage:"complete",progress:100,message:"Video already optimized"}),e;null==a||a({stage:"extracting",progress:25,message:"Processing frames..."});const{width:n,height:l}=this.calculateDimensions(r.width,r.height,s.maxWidthOrHeight);null==a||a({stage:"compressing",progress:50,message:"Compressing video..."});const c=await this.processVideo(e,n,l,s.quality,a);null==a||a({stage:"finalizing",progress:90,message:"Finalizing..."});const d=c.size/1048576;if(d>s.maxSizeMB){const t=s.maxSizeMB/d,r=Math.max(Math.min(s.quality*t,1),.1);return await this.processVideo(e,n,l,r,a)}return null==a||a({stage:"complete",progress:100,message:"Compression complete"}),c}static calculateDimensions(e,t,a){if(e<=a&&t<=a)return{width:e,height:t};const s=e/t;return e>t?{width:a,height:Math.round(a/s)}:{width:Math.round(a*s),height:a}}static async processVideo(e,t,a,s,r){return new Promise((i,o)=>{const n=document.createElement("video"),l=document.createElement("canvas"),c=l.getContext("2d");if(!c)return void o(new Error("Failed to get canvas context"));l.width=t,l.height=a,n.preload="auto",n.muted=!0;const d=[];let u=0;n.onloadeddata=()=>{var e;try{const m=l.captureStream(30),h=n,p=(null==(e=h.captureStream)?void 0:e.call(h))??null;if(p){p.getAudioTracks().forEach(e=>m.addTrack(e))}const x=new MediaRecorder(m,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5*s});x.ondataavailable=e=>{e.data.size>0&&d.push(e.data)},x.onstop=()=>{const e=new Blob(d,{type:"video/webm"});URL.revokeObjectURL(n.src),i(e)},x.onerror=e=>{URL.revokeObjectURL(n.src);const t=e instanceof Error?e.message:"MediaRecorder error";o(new Error(t))},x.start(),n.play().catch(e=>{URL.revokeObjectURL(n.src);const t=e instanceof Error?e.message:"Failed to play video";o(new Error(t))});const g=()=>{if(n.ended)return void x.stop();c.drawImage(n,0,0,t,a),u++;const e=Math.min(90,50+n.currentTime/n.duration*40);null==r||r({stage:"compressing",progress:e,message:`Processing frame ${u}...`}),requestAnimationFrame(g)};g()}catch(m){URL.revokeObjectURL(n.src);const e=m instanceof Error?m.message:"Failed to process video";o(new Error(e))}},n.onerror=e=>{URL.revokeObjectURL(n.src);const t=e instanceof Error?e.message:"Failed to process video";o(new Error(t))},n.src=URL.createObjectURL(e)})}static formatFileSize(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,t)).toFixed(2)} ${["B","KB","MB","GB"][t]}`}static formatDuration(e){return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}}var Et;((t,a,s)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(St,"symbol"!=typeof(Et="DEFAULT_OPTIONS")?Et+"":Et,{maxSizeMB:50,maxWidthOrHeight:1280,maxDurationSeconds:60,quality:.8});const zt=J("PostComposer");function Pt({open:e,onOpenChange:a,onPostCreated:s}){var r,i,o,n,l,c,d,m,h,p,x,g,v;const{t:f}=Q(),[j,w]=u.useState(""),[N,k]=u.useState([]),[C,S]=u.useState({file:null,previewUrl:null,thumbnailUrl:null,compressedBlob:null,metadata:null,isCompressing:!1,compressionProgress:null,error:null}),[E,P]=u.useState([]),[L,M]=u.useState(null),[R,W]=u.useState("public"),[H,q]=u.useState([]),[X,Y]=u.useState(""),[K,G]=u.useState(!1),[Z]=Fe("user-pets",[]),[J,te]=u.useState("photo"),[oe,ne]=u.useState("original"),[me,pe]=u.useState(!1),ge=u.useRef(null),ve=u.useRef(null),fe=u.useRef(null),[ye,je]=u.useState(!1),[we,Ne]=u.useState(!1),ke=1e3-j.length,Ce=j.trim().length>0&&ke>=0&&!K&&!C.isCompressing,Se=()=>{C.previewUrl&&URL.revokeObjectURL(C.previewUrl),S({file:null,previewUrl:null,thumbnailUrl:null,compressedBlob:null,metadata:null,isCompressing:!1,compressionProgress:null,error:null}),ie.light()},Ee=()=>{var e;if(!X.trim())return;if(H.length>=10)return void b.error((null==(e=f.community)?void 0:e.maxTagsReached)||"Maximum 10 tags allowed");const t=X.trim().toLowerCase().replace(/\s+/g,"_");H.includes(t)||(q(e=>[...e,t]),ie.selection()),Y("")},ze=[{value:"public",icon:F,label:(null==(r=f.community)?void 0:r.visibilityPublic)||"Public"},{value:"matches",icon:O,label:(null==(i=f.community)?void 0:i.visibilityMatches)||"Matches Only"},{value:"private",icon:A,label:(null==(o=f.community)?void 0:o.visibilityPrivate)||"Private"}];return t.jsx(le,{open:e,onOpenChange:a,children:t.jsxs(ce,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[t.jsx("input",{ref:ve,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",className:"hidden",onChange:async e=>{var t,a,s;const r=null==(t=e.target.files)?void 0:t[0];if(r){if(N.length>=10)return b.error((null==(a=f.community)?void 0:a.maxImagesReached)||"Maximum 10 images allowed"),void ie.error();try{Ne(!0);const e={square:{max:800},portrait:{max:800},landscape:{max:1920},original:{max:1920}}[oe].max,t=await Ct(r,{maxWidthOrHeight:e,maxSizeMB:1});k(e=>[...e,t.url]),ie.selection(),b.success((null==(s=f.community)?void 0:s.imageAdded)||"Image added"),pe(!1)}catch(i){const e=i instanceof Error?i:new Error(String(i));zt.error("Failed to upload image",e),b.error(e.message||"Failed to upload image"),ie.error()}finally{Ne(!1),ve.current&&(ve.current.value="")}}},disabled:we}),t.jsx(de,{children:t.jsx(ue,{className:"text-2xl font-bold",children:(null==(n=f.community)?void 0:n.createPost)||"Create Post"})}),t.jsxs("div",{className:"space-y-4 mt-4",children:[t.jsxs("div",{children:[t.jsx(re,{placeholder:(null==(l=f.community)?void 0:l.postPlaceholder)||"Share what's on your mind...",value:j,onChange:e=>w(e.target.value),className:"min-h-[120px] resize-none text-base",maxLength:1e3}),t.jsx("div",{className:"flex items-center justify-between mt-2",children:t.jsxs("span",{className:"text-sm "+(ke<50?"text-destructive":"text-muted-foreground"),children:[ke," ",(null==(c=f.community)?void 0:c.charsRemaining)||"characters remaining"]})})]}),t.jsx(se,{visible:N.length>0,children:N.length>0&&t.jsxs(ae,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(he,{className:"text-sm font-medium",children:["Photos (",N.length,"/",10,")"]}),t.jsx(be,{variant:"outline",className:"text-xs capitalize",children:oe})]}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:N.map((e,a)=>t.jsxs(ae,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative aspect-square rounded-lg overflow-hidden bg-muted group",children:[t.jsx("img",{src:e,alt:`Upload ${a+1}`,className:"w-full h-full object-cover"}),t.jsx("button",{onClick:()=>(e=>{k(t=>t.filter((t,a)=>a!==e)),ie.light()})(a),className:"absolute top-2 right-2 bg-black/60 hover:bg-black/80 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(y,{size:16})})]},a))})]})}),t.jsx(se,{visible:!!C.previewUrl,children:C.previewUrl&&t.jsxs(ae,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[t.jsx(T,{size:16,weight:"bold"}),"Video Preview"]}),C.metadata&&t.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[t.jsxs(be,{variant:"outline",className:"gap-1",children:[t.jsx(U,{size:12}),St.formatDuration(C.metadata.duration)]}),t.jsxs(be,{variant:"outline",children:[C.metadata.width,"Ã—",C.metadata.height]}),C.compressedBlob&&t.jsxs(be,{variant:"secondary",className:"gap-1",children:[t.jsx(I,{size:12,weight:"fill"}),St.formatFileSize(C.compressedBlob.size)]})]})]}),C.isCompressing&&C.compressionProgress&&t.jsxs(ae,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-primary/5 border border-primary/20 rounded-lg p-4 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("span",{className:"font-medium text-primary",children:C.compressionProgress.message}),t.jsxs("span",{className:"text-muted-foreground",children:[Math.round(C.compressionProgress.progress),"%"]})]}),t.jsx(Oe,{value:C.compressionProgress.progress,className:"h-2"}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Stage: ",C.compressionProgress.stage]})]}),C.error&&t.jsxs(ae,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-destructive/10 border border-destructive/20 rounded-lg p-3 flex items-start gap-2",children:[t.jsx(_,{size:20,weight:"fill",className:"text-destructive shrink-0 mt-0.5"}),t.jsx("div",{className:"text-sm text-destructive",children:C.error})]}),t.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-black group",children:[t.jsx("video",{ref:fe,src:C.previewUrl,className:"w-full h-full object-contain",onPlay:()=>je(!0),onPause:()=>je(!1),onEnded:()=>je(!1),loop:!0}),t.jsx("button",{onClick:()=>{fe.current&&(ye?fe.current.pause():fe.current.play(),je(!ye),ie.light())},className:"absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity",disabled:C.isCompressing,children:t.jsx(ae,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"bg-white/90 hover:bg-white rounded-full p-4 shadow-2xl",children:ye?t.jsx(D,{size:32,weight:"fill",className:"text-black"}):t.jsx(V,{size:32,weight:"fill",className:"text-black"})})}),t.jsx("button",{onClick:Se,className:"absolute top-3 right-3 bg-black/70 hover:bg-black/90 text-white rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity",disabled:C.isCompressing,children:t.jsx(y,{size:20})}),C.isCompressing&&t.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:t.jsxs("div",{className:"text-white text-center space-y-2",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-white border-t-transparent mx-auto"}),t.jsx("div",{className:"text-sm font-medium",children:"Processing..."})]})})]})]})}),t.jsx(se,{visible:me,children:me&&t.jsxs(ae,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},className:"border rounded-lg p-4 bg-card space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(he,{className:"text-base font-semibold",children:"Add Media"}),t.jsx(ee,{variant:"ghost",size:"sm",onClick:()=>pe(!1),className:"h-8 w-8 p-0",children:t.jsx(y,{size:16})})]}),t.jsxs(Ae,{value:J,onValueChange:e=>te(e),children:[t.jsxs(Te,{className:"grid w-full grid-cols-2",children:[t.jsxs(Ue,{value:"photo",className:"gap-2",children:[t.jsx(B,{size:16}),"Photo"]}),t.jsxs(Ue,{value:"video",className:"gap-2",children:[t.jsx(T,{size:16}),"Video"]})]}),t.jsxs(Ie,{value:"photo",className:"space-y-4 mt-4",children:[t.jsxs("div",{children:[t.jsx(he,{className:"text-sm mb-2 block",children:"Crop Size"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"original",label:"Original",icon:"ðŸ“"},{value:"square",label:"Square",icon:"â¬œ",desc:"1:1"},{value:"portrait",label:"Portrait",icon:"ðŸ“±",desc:"3:4"},{value:"landscape",label:"Landscape",icon:"ðŸ–¼ï¸",desc:"4:3"}].map(({value:e,label:a,icon:s,desc:r})=>t.jsxs(ae,{as:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>ne(e),className:"p-3 rounded-lg border-2 transition-all text-left "+(oe===e?"border-primary bg-primary/10":"border-border hover:border-primary/50"),children:[t.jsx("div",{className:"text-xl mb-0.5",children:s}),t.jsx("div",{className:"text-xs font-medium",children:a}),r&&t.jsx("div",{className:"text-xs text-muted-foreground",children:r})]},e))})]}),t.jsxs(ee,{onClick:()=>{ve.current&&ve.current.click()},className:"w-full",disabled:N.length>=10,children:[t.jsx(B,{size:18,className:"mr-2"}),"Add Photo"]})]}),t.jsxs(Ie,{value:"video",className:"space-y-4 mt-4",children:[t.jsx("div",{className:"bg-accent/10 border border-accent/20 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx($,{size:16,weight:"duotone",className:"text-accent shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-xs",children:[t.jsx("div",{className:"font-medium mb-1",children:"Video Guidelines"}),t.jsxs("ul",{className:"text-muted-foreground space-y-0.5",children:[t.jsxs("li",{children:["â€¢ Max size: ",50,"MB (compressed)"]}),t.jsx("li",{children:"â€¢ Formats: MP4, MOV, WebM"}),t.jsxs("li",{children:["â€¢ Max duration: ",60," seconds"]}),t.jsx("li",{children:"â€¢ Auto-compression enabled"})]})]})]})}),t.jsx("input",{ref:ge,type:"file",accept:"video/*",onChange:async e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;if(!a.type.startsWith("video/"))return b.error("Please select a valid video file"),void ie.error();if(a.size/1048576>100)return b.error("Video file is too large. Maximum size is 100MB"),void ie.error();try{S(e=>({...e,isCompressing:!0,error:null})),ie.selection();const e=await St.getVideoMetadata(a);if(e.duration>60)return b.error("Video must be less than 60 seconds"),ie.error(),void S(e=>({...e,isCompressing:!1,error:"Video too long"}));const t=await St.extractThumbnail(a,e.duration/2),s=URL.createObjectURL(a);S(r=>({...r,file:a,previewUrl:s,thumbnailUrl:t,metadata:e}));const r=await St.compressVideo(a,{maxSizeMB:50,maxWidthOrHeight:1280,maxDurationSeconds:60,quality:.8},e=>{S(t=>({...t,compressionProgress:e}))});S(e=>({...e,compressedBlob:r,isCompressing:!1,compressionProgress:null})),k([]);const i=St.formatFileSize(a.size),o=St.formatFileSize(r.size);b.success(`Video compressed: ${i} â†’ ${o}`),ie.success(),pe(!1)}catch(s){zt.error("Video processing error",s instanceof Error?s:new Error(String(s))),S({file:null,previewUrl:null,thumbnailUrl:null,compressedBlob:null,metadata:null,isCompressing:!1,compressionProgress:null,error:s instanceof Error?s.message:"Failed to process video"}),b.error("Failed to process video"),ie.error()}},className:"hidden"}),t.jsxs(ee,{onClick:()=>{var e;null==(e=ge.current)||e.click()},className:"w-full",disabled:!!C.file||C.isCompressing,children:[t.jsx(T,{size:18,className:"mr-2"}),C.isCompressing?"Processing...":"Choose Video"]})]})]})]})}),Z&&Z.length>0&&t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:(null==(d=f.community)?void 0:d.tagPets)||"Tag Your Pets"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:Z.map(e=>{const a=E.includes(e.id);return t.jsx(be,{variant:a?"default":"outline",className:"cursor-pointer",onClick:()=>{P(t=>a?t.filter(t=>t!==e.id):[...t,e.id]),ie.selection()},children:e.name},e.id)})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-medium text-foreground mb-2 block",children:[(null==(m=f.community)?void 0:m.tags)||"Tags"," (",H.length,"/10)"]}),t.jsxs("div",{className:"flex gap-2 mb-2",children:[t.jsx("input",{type:"text",value:X,onChange:e=>Y(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),Ee()),placeholder:(null==(h=f.community)?void 0:h.addTag)||"Add tag...",className:"flex-1 px-3 py-2 text-sm border border-input bg-background rounded-md"}),t.jsx(ee,{onClick:Ee,variant:"outline",size:"sm",children:t.jsx(z,{size:16})})]}),H.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(e=>t.jsxs(be,{variant:"secondary",className:"gap-1",children:["#",e,t.jsx("button",{onClick:()=>(e=>{q(t=>t.filter(t=>t!==e)),ie.light()})(e),className:"hover:text-destructive",children:t.jsx(y,{size:12})})]},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-foreground mb-2 block",children:(null==(p=f.community)?void 0:p.visibility)||"Visibility"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:ze.map(({value:e,icon:a,label:s})=>t.jsxs("button",{onClick:()=>{W(e),ie.selection()},className:"p-3 rounded-lg border-2 transition-all "+(R===e?"border-primary bg-primary/10":"border-border hover:border-primary/50"),children:[t.jsx(a,{size:24,className:"mx-auto mb-1",weight:R===e?"fill":"regular"}),t.jsx("div",{className:"text-xs font-medium",children:s})]},e))})]}),t.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t",children:[t.jsx(ee,{variant:"outline",size:"sm",onClick:()=>pe(!me),className:"gap-2",children:me?t.jsxs(t.Fragment,{children:[t.jsx(y,{size:18}),"Close"]}):t.jsxs(t.Fragment,{children:[t.jsx(B,{size:18}),"Media"]})}),t.jsx("div",{className:"flex-1"}),t.jsx(ee,{variant:"ghost",onClick:()=>a(!1),children:(null==(x=f.common)?void 0:x.cancel)||"Cancel"}),t.jsx(ee,{onClick:async()=>{var e,t,r,i,o;if(Ce)try{G(!0),ie.impact();const o=await spark.user();b.info("Your post has been submitted and will be visible once approved by an administrator.");const n={authorId:o.id,authorName:o.login||"User",authorAvatar:o.avatarUrl,kind:"post",text:j.trim(),media:C.file?[]:N,visibility:R};H.length>0&&(n.tags=H),L&&(n.location={city:(null==(e=L.placeName)?void 0:e.split(",")[0])||"Unknown",country:(null==(r=null==(t=L.placeName)?void 0:t.split(",").pop())?void 0:r.trim())||"Unknown",lat:L.lat,lon:L.lng}),await xe.createPost(n),ie.success(),b.success((null==(i=f.community)?void 0:i.postCreated)||"Post created successfully!"),w(""),k([]),Se(),P([]),M(null),q([]),W("public"),ne("original"),pe(!1),null==s||s(),a(!1)}catch(n){ie.error(),b.error((null==(o=f.community)?void 0:o.postFailed)||"Failed to create post"),zt.error("Post creation failed",n instanceof Error?n:new Error(String(n)))}finally{G(!1)}},disabled:!Ce,children:K?(null==(g=f.common)?void 0:g.posting)||"Posting...":(null==(v=f.common)?void 0:v.post)||"Post"})]})]})]})})}function Lt({count:e=3,variant:a="post"}){const s=_e();return"post"===a?t.jsxs("div",{className:"space-y-4",role:"status","aria-label":"Loading posts",children:[Array.from({length:e}).map((e,a)=>t.jsx(ae,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s?0:.1*a,duration:s?0:.3,easing:"easeOut"},children:t.jsxs(ze,{className:"p-4 space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(mt,{className:"w-10 h-10 rounded-full"}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx(mt,{className:"h-4 w-32"}),t.jsx(mt,{className:"h-3 w-24"})]}),t.jsx(mt,{className:"h-8 w-8 rounded"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(mt,{className:"h-4 w-full"}),t.jsx(mt,{className:"h-4 w-5/6"}),t.jsx(mt,{className:"h-4 w-4/6"})]}),t.jsx(mt,{className:"h-64 w-full rounded-lg"}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(mt,{className:"h-6 w-16"}),t.jsx(mt,{className:"h-6 w-16"}),t.jsx(mt,{className:"h-6 w-16"}),t.jsx("div",{className:"flex-1"}),t.jsx(mt,{className:"h-6 w-20"})]})]})},a)),t.jsx("span",{className:"sr-only",children:"Loading feed content..."})]}):"comment"===a?t.jsxs("div",{className:"space-y-3",role:"status","aria-label":"Loading comments",children:[Array.from({length:e}).map((e,a)=>t.jsx(ae,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s?0:.1*a,duration:s?0:.3,easing:"easeOut"},children:t.jsxs("div",{className:"flex gap-3 p-3",children:[t.jsx(mt,{className:"w-8 h-8 rounded-full"}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx(mt,{className:"h-4 w-24"}),t.jsx(mt,{className:"h-4 w-full"}),t.jsx(mt,{className:"h-4 w-3/4"})]})]})},a)),t.jsx("span",{className:"sr-only",children:"Loading comments..."})]}):t.jsxs("div",{className:"space-y-3",role:"status","aria-label":"Loading users",children:[Array.from({length:e}).map((e,a)=>t.jsx(ae,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s?0:.1*a,duration:s?0:.3,easing:"easeOut"},children:t.jsxs("div",{className:"flex items-center gap-3 p-3",children:[t.jsx(mt,{className:"w-12 h-12 rounded-full"}),t.jsxs("div",{className:"flex-1 space-y-2",children:[t.jsx(mt,{className:"h-4 w-32"}),t.jsx(mt,{className:"h-3 w-24"})]}),t.jsx(mt,{className:"h-9 w-20 rounded"})]})},a)),t.jsx("span",{className:"sr-only",children:"Loading users..."})]})}J("FollowGraph");async function Mt(){return await Re.get("follow-relationships")||[]}async function Rt(e,t){return(await Mt()).some(a=>a.followerId===e&&a.followingId===t&&"active"===a.status)}async function Ft(e){return(await Mt()).filter(t=>t.followerId===e&&"active"===t.status).map(e=>e.followingId)}async function Ot(e,t){const a=await Ft(t),s=new Set(a);return e.filter(e=>s.has(e.authorId))}const At=Object.freeze(Object.defineProperty({__proto__:null,filterPostsByFollows:Ot,getFollowing:Ft,isFollowing:Rt,shouldNotifyForPost:async function(e,t){return await Rt(t,e)},shouldNotifyForStream:async function(e,t){return await Rt(t,e)}},Symbol.toStringTag,{value:"Module"})),Tt=J("useFeedManagement");function Ut(e){const{feedTab:t,enabled:a=!0}=e,[s,r]=u.useState([]),[i,o]=u.useState(!0),[n,l]=u.useState(!0),[c,d]=u.useState(),m=u.useRef(!1),h=u.useCallback(async(e=!1)=>{if(!m.current&&a)try{m.current=!0,o(!0);const{userService:a}=await G(async()=>{const{userService:e}=await import("./feature-admin-g8AIjMAb.js").then(e=>e.ba);return{userService:e}},__vite__mapDeps([5,1,2,3,4,6])),s=await a.user(),i={limit:20,...e&&c?{cursor:c}:{}},n=await xe.queryFeed(i,null==s?void 0:s.id);let u=n.posts;"following"===t&&s&&(u=await Ot(n.posts,s.id)),r(e?e=>[...Array.isArray(e)?e:[],...u]:u),l(!!n.nextCursor),d(n.nextCursor)}catch(s){const e=s instanceof Error?s:new Error(String(s));Tt.error("Failed to load feed",e,{action:"loadFeed",feedTab:t})}finally{o(!1),m.current=!1}},[t,c,a]),p=u.useCallback(async()=>{d(void 0),l(!0),await h(!1)},[h]),x=u.useCallback(()=>{r([]),d(void 0),l(!0)},[]);return u.useEffect(()=>{a&&h()},[a,t,h]),{posts:s,loading:i,hasMore:n,cursor:c,loadFeed:h,refreshFeed:p,resetFeed:x}}function It(e){const{hasMore:t,loading:a,onLoadMore:s,enabled:r=!0}=e,i=u.useRef(null);return u.useEffect(()=>{if(!r)return;const e=new IntersectionObserver(e=>{const r=e[0];(null==r?void 0:r.isIntersecting)&&t&&!a&&s()},{threshold:.1}),o=i.current;return o&&e.observe(o),()=>{o&&e.unobserve(o),e.disconnect()}},[t,a,s,r]),{observerTarget:i}}const _t=J("usePullToRefresh");function Dt(e){const{onRefresh:t,enabled:a=!0,activeTab:s="feed",threshold:r=80}=e,i=u.useRef(null),o=u.useRef(0),n=u.useRef(!1),[l,c]=u.useState(!1),d=ye(0),m=we(()=>({opacity:De(d.value,[0,r],[0,1],Ve.CLAMP)})),h=we(()=>({transform:[{rotate:`${De(d.value,[0,r],[0,360],Ve.CLAMP)}deg`}]})),p=we(()=>({transform:[{scale:De(d.value,[0,r],[.5,1],Ve.CLAMP)}]})),x=we(()=>({transform:[{translateY:d.value}]})),g=u.useCallback(e=>{var t;const a=i.current;0===(null==a?void 0:a.scrollTop)&&"feed"===s&&(null==(t=e.touches)?void 0:t[0])&&(o.current=e.touches[0].clientY,n.current=!0)},[s]),v=u.useCallback(e=>{var t;const s=i.current;if(!(n.current&&s&&(null==(t=e.touches)?void 0:t[0])&&a))return;const r=e.touches[0].clientY-o.current;r>0&&r<120&&(d.value=r)},[d,a]),f=u.useCallback(async()=>{if(!n.current||!a)return;n.current=!1;if(d.value>r){c(!0),ie.impact("light");try{await t(),ie.success(),b.success("Feed refreshed!")}catch(e){const t=e instanceof Error?e:new Error(String(e));_t.error("Failed to refresh feed",t),ie.error(),b.error("Failed to refresh")}finally{c(!1)}}d.value=ke(0)},[d,t,r,a]);return u.useEffect(()=>{if(!a)return;const e=i.current;if(!e||"feed"!==s)return;const t=e=>g(e),r=e=>v(e),o=()=>{f()};return e.addEventListener("touchstart",t,{passive:!0}),e.addEventListener("touchmove",r,{passive:!0}),e.addEventListener("touchend",o,{passive:!0}),()=>{e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",r),e.removeEventListener("touchend",o)}},[g,v,f,s,a]),{containerRef:i,pullDistance:d,isRefreshing:l,pullOpacityStyle:m,pullRotationStyle:h,pullScaleStyle:p,pullTranslateStyle:x}}const Vt=J("useTrendingTags");function Bt(){const[e,t]=u.useState([]);return{trendingTags:e,loadTrendingTags:u.useCallback(async()=>{try{const{userService:e}=await G(async()=>{const{userService:e}=await import("./feature-admin-g8AIjMAb.js").then(e=>e.ba);return{userService:e}},__vite__mapDeps([5,1,2,3,4,6])),a=await e.user(),s=await xe.queryFeed({limit:100},null==a?void 0:a.id),r=[];Array.isArray(s.posts)&&s.posts.forEach(e=>{e.tags&&Array.isArray(e.tags)&&r.push(...e.tags)});const i=r.reduce((e,t)=>(e[t]=(e[t]??0)+1,e),{}),o=Object.entries(i).sort((e,t)=>t[1]-e[1]).slice(0,10).map(([e])=>e);t(o)}catch(e){const a=e instanceof Error?e:new Error(String(e));Vt.error("Failed to load trending tags",a,{action:"loadTrendingTags"}),t([])}},[])}}const $t=J("usePostActions");function Wt(e={}){const{onPostCreated:t,onRefreshFeed:a}=e;return{handleAuthorClick:u.useCallback(e=>{$t.info("View author profile",{action:"viewAuthorProfile",authorId:e})},[]),handlePostCreated:u.useCallback(()=>{null==t||t(),null==a||a(),ie.success()},[t,a]),handleToggleFavorite:u.useCallback(e=>{ie.trigger("light")},[])}}const Ht=J("MediaViewer");function qt({children:e,direction:a,isVisible:s}){const r=ye(a>0?1e3:-1e3),i=ye(0),o=ye(.9);u.useEffect(()=>{s?(r.value=ke(0),i.value=je(1),o.value=ke(1)):(r.value=ke(a>0?-1e3:1e3),i.value=je(0),o.value=je(.9))},[s,a,r,i,o]);const n=we(()=>({transform:[{translateX:r.value},{scale:o.value}],opacity:i.value}));return s?t.jsx(Ee,{style:n,className:"absolute inset-0 flex items-center justify-center",children:e}):null}const Xt=Object.freeze(Object.defineProperty({__proto__:null,MediaViewer:function({open:e,onOpenChange:s,media:i,initialIndex:o=0,authorName:n}){var d,m;const{t:h}=Q(),[p,x]=u.useState(o),[g,v]=u.useState(!1),[f,j]=u.useState(0),[w,N]=u.useState(!1),C=ye(0),S=u.useRef(0),E=u.useRef(null),[z,P]=u.useState(!1),[L,M]=u.useState(!1),[F,O]=u.useState(0),[A,T]=u.useState(0),[U,I]=u.useState(!0),_=u.useRef(void 0);u.useEffect(()=>{x(o)},[o,e]),u.useEffect(()=>{e||(v(!1),j(0),P(!1),C.value=0,E.current&&E.current.pause())},[e,C]),u.useEffect(()=>{const e=E.current;if(!e)return;const t=()=>O(e.currentTime),a=()=>{e.duration&&!isNaN(e.duration)&&T(e.duration)},s=()=>P(!0),r=()=>P(!1),i=()=>P(!1);return e.addEventListener("timeupdate",t),e.addEventListener("loadedmetadata",a),e.addEventListener("play",s),e.addEventListener("pause",r),e.addEventListener("ended",i),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("loadedmetadata",a),e.removeEventListener("play",s),e.removeEventListener("pause",r),e.removeEventListener("ended",i)}},[p,i]);const B=u.useCallback(()=>{_.current&&clearTimeout(_.current),I(!0),_.current=window.setTimeout(()=>{z&&I(!1)},3e3)},[z]);u.useEffect(()=>(B(),()=>{_.current&&clearTimeout(_.current)}),[B]);const $=u.useCallback(()=>{p>0&&(j(-1),x(e=>e-1),v(!1),E.current&&E.current.pause(),ie.selection())},[p]),K=u.useCallback(()=>{p<i.length-1&&(j(1),x(e=>e+1),v(!1),E.current&&E.current.pause(),ie.selection())},[p,i.length]),G=u.useCallback(e=>{g||"video"===(null==xe?void 0:xe.type)||(N(!0),S.current=e)},[g]),Z=u.useCallback(e=>{if(!w||g||"video"===(null==xe?void 0:xe.type))return;const t=e-S.current;C.value=t},[w,g,C]),J=u.useCallback(e=>{if(!w||g||"video"===(null==xe?void 0:xe.type))return N(!1),void(C.value=ke(0));const t=e-S.current;Math.abs(t)>50&&(t>0&&p>0?$():t<0&&p<i.length-1&&K()),N(!1),C.value=ke(0)},[w,g,p,i.length,$,K,C]),te=u.useCallback(e=>{G(e.clientX)},[G]),ae=u.useCallback(e=>{w?Z(e.clientX):"video"===(null==xe?void 0:xe.type)&&B()},[w,Z,null==xe?void 0:xe.type,B]),se=u.useCallback(e=>{J(e.clientX)},[J]),re=u.useCallback(e=>{e.touches[0]&&G(e.touches[0].clientX)},[G]),oe=u.useCallback(e=>{e.touches[0]&&w&&Z(e.touches[0].clientX)},[w,Z]),ne=u.useCallback(e=>{e.changedTouches[0]&&J(e.changedTouches[0].clientX)},[J]),le=u.useCallback(()=>{v(!g),ie.selection()},[g]),ce=u.useCallback(()=>{E.current&&(z?E.current.pause():E.current.play().catch(()=>{}),B(),ie.impact())},[z,B]),de=u.useCallback(()=>{E.current&&(E.current.muted=!E.current.muted,M(!L),ie.selection())},[L]),ue=u.useCallback(e=>{if(!E.current||void 0===e[0])return;const t=e[0];E.current.currentTime=t,O(t),B()},[B]),me=u.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),he=u.useCallback(async()=>{var e,t,a;ie.impact();try{const a=i[p];if(!a)return void b.error((null==(e=h.community)?void 0:e.mediaNotAvailable)||"Media not available");const s="video"===a.type,r=a.url,o=await fetch(r),n=await o.blob(),l=window.URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.download=`pawfectmatch-${a.id}.${s?"mp4":"jpg"}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),b.success((null==(t=h.community)?void 0:t.downloaded)||(s?"Video":"Image")+" downloaded")}catch(s){Ht.error("Failed to download",s instanceof Error?s:new Error(String(s))),b.error((null==(a=h.community)?void 0:a.downloadError)||"Failed to download")}},[p,i,h,Ht]),pe=u.useCallback(async()=>{var e;ie.selection();const t=i[p];if(!t)return void b.error((null==(e=h.community)?void 0:e.mediaNotAvailable)||"Media not available");const a="video"===t.type,s=t.url;if(navigator.share)try{await navigator.share({title:`${a?"Video":"Photo"} by ${n}`,url:s})}catch{}else navigator.clipboard.writeText(s).then(()=>{var e;b.success((null==(e=h.community)?void 0:e.linkCopied)||"Link copied to clipboard")}).catch(()=>{})},[p,i,n,h]),xe=i[p];if(!xe)return null;const ge="video"===xe.type,ve=we(()=>{if(ge)return{opacity:1};return{opacity:De(C.value,[-200,0,200],[.5,1,.5],Ve.CLAMP)}}),fe=we(()=>({transform:[{translateX:C.value}]})),be=ye(U||!ge?1:0),Ce=ye(0);u.useEffect(()=>{U||!ge?(be.value=je(1),Ce.value=je(0)):(be.value=je(0),Ce.value=je(-20))},[U,ge,be,Ce]);const Se=we(()=>({opacity:be.value,transform:[{translateY:Ce.value}]})),ze=ye(g?2:1);u.useEffect(()=>{ze.value=ke(g?2:1)},[g,ze]);const Pe=we(()=>({transform:[{scale:ze.value}]})),Le=ye(U?1:0),Me=ye(0);u.useEffect(()=>{U?(Le.value=je(1),Me.value=je(0)):(Le.value=je(0),Me.value=je(20))},[U,Le,Me]);const Re=we(()=>({opacity:Le.value,transform:[{translateY:Me.value}]})),Fe=Ne({hoverScale:1.1,tapScale:.95}),Oe=ye(p>0&&U?1:0),Ae=ye(-20);u.useEffect(()=>{p>0&&U?(Oe.value=je(1),Ae.value=je(0)):(Oe.value=je(0),Ae.value=je(-20))},[p,U,Oe,Ae]);const Te=we(()=>({opacity:Oe.value,transform:[{translateX:Ae.value}]})),Ue=ye(p<i.length-1&&U?1:0),Ie=ye(20);u.useEffect(()=>{p<i.length-1&&U?(Ue.value=je(1),Ie.value=je(0)):(Ue.value=je(0),Ie.value=je(20))},[p,i.length,U,Ue,Ie]);const _e=we(()=>({opacity:Ue.value,transform:[{translateX:Ie.value}]})),We=ye(0);u.useEffect(()=>{We.value=ge?0:Be(500,je(1))},[ge,We]);const He=we(()=>({opacity:We.value}));return t.jsx(a,{open:e,onOpenChange:s,children:t.jsxs(l,{children:[t.jsx(c,{className:"fixed inset-0 z-50 bg-black/95 backdrop-blur-xl data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),t.jsx(r,{className:"fixed inset-0 z-50 flex items-center justify-center",onPointerDownOutside:e=>e.preventDefault(),children:t.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",onMouseDown:te,onMouseMove:ae,onMouseUp:se,onTouchStart:re,onTouchMove:oe,onTouchEnd:ne,children:[(U||!ge)&&t.jsx(Ee,{style:Se,className:"absolute top-0 left-0 right-0 z-50 p-4 bg-gradient-to-b from-black/80 to-transparent",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>s(!1),className:"rounded-full bg-black/40 hover:bg-black/60 text-white backdrop-blur-sm",children:t.jsx(y,{size:24})}),n&&t.jsxs("div",{className:"text-white",children:[t.jsx("p",{className:"text-sm font-medium",children:n}),t.jsxs("p",{className:"text-xs text-white/60",children:[p+1," / ",i.length]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>{he()},className:"rounded-full bg-black/40 hover:bg-black/60 text-white backdrop-blur-sm",children:t.jsx(W,{size:22,weight:"bold"})}),t.jsx(ee,{variant:"ghost",size:"icon",onClick:()=>{pe()},className:"rounded-full bg-black/40 hover:bg-black/60 text-white backdrop-blur-sm",children:t.jsx(R,{size:22,weight:"bold"})}),t.jsx(ee,{variant:"ghost",size:"icon",className:"rounded-full bg-black/40 hover:bg-black/60 text-white backdrop-blur-sm",children:t.jsx(k,{size:22,weight:"bold"})})]})]})}),t.jsx("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:t.jsx(qt,{direction:f,isVisible:!0,children:t.jsx(Ee,{style:[fe,ve],className:"absolute inset-0 flex items-center justify-center",children:ge?t.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[t.jsx("video",{ref:E,src:xe.url,poster:xe.thumbnail,className:"max-w-full max-h-full object-contain",playsInline:!0,onClick:ce}),U&&t.jsx(Ee,{style:Re,className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:t.jsx(Ee,{style:Fe.animatedStyle,onMouseEnter:Fe.handleMouseEnter,onMouseLeave:Fe.handleMouseLeave,onClick:ce,className:"pointer-events-auto w-20 h-20 rounded-full bg-black/60 backdrop-blur-sm flex items-center justify-center text-white hover:bg-black/80 transition-colors cursor-pointer",children:z?t.jsx(D,{size:40,weight:"fill"}):t.jsx(V,{size:40,weight:"fill"})})}),U&&A>0&&!isNaN(A)&&t.jsx(Ee,{style:Re,className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(ee,{variant:"ghost",size:"icon",onClick:ce,className:"h-10 w-10 rounded-full bg-black/40 hover:bg-black/60 text-white backdrop-blur-sm shrink-0",children:z?t.jsx(D,{size:20,weight:"fill"}):t.jsx(V,{size:20,weight:"fill"})}),t.jsx("span",{className:"text-white text-sm font-medium min-w-[45px]",children:me(F)}),t.jsx($e,{value:[F],max:A||0,step:.1,onValueChange:ue,className:"flex-1"}),t.jsx("span",{className:"text-white/60 text-sm min-w-[45px] text-right",children:me(A||0)}),t.jsx(ee,{variant:"ghost",size:"icon",onClick:de,className:"h-10 w-10 rounded-full bg-black/40 hover:bg-black/60 text-white backdrop-blur-sm shrink-0",children:L?t.jsx(H,{size:20,weight:"fill"}):t.jsx(q,{size:20,weight:"fill"})})]})})]}):t.jsx(Ee,{style:Pe,onClick:le,className:"max-w-full max-h-full cursor-zoom-in select-none",children:t.jsx("img",{src:xe.url,alt:`Post media ${p+1}`,className:"max-w-full max-h-full object-contain select-none",draggable:!1})})})})}),i.length>1&&t.jsxs(t.Fragment,{children:[p>0&&t.jsx(Ee,{style:Te,className:"absolute left-4 top-1/2 -translate-y-1/2 z-50",children:t.jsx(ee,{variant:"ghost",size:"icon",onClick:$,className:"h-12 w-12 rounded-full bg-black/60 hover:bg-black/80 text-white backdrop-blur-sm",children:t.jsx(X,{size:32,weight:"bold"})})}),p<i.length-1&&t.jsx(Ee,{style:_e,className:"absolute right-4 top-1/2 -translate-y-1/2 z-50",children:t.jsx(ee,{variant:"ghost",size:"icon",onClick:K,className:"h-12 w-12 rounded-full bg-black/60 hover:bg-black/80 text-white backdrop-blur-sm",children:t.jsx(Y,{size:32,weight:"bold"})})})]}),i.length>1&&t.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-50 flex gap-2 bg-black/60 backdrop-blur-sm px-4 py-2 rounded-full",children:i.map((e,a)=>{var s;return t.jsx("button",{onClick:()=>{j(a>p?1:-1),x(a),E.current&&E.current.pause(),ie.selection()},className:"h-2 rounded-full transition-all duration-300 "+(a===p?"w-8 bg-white":"w-2 bg-white/50 hover:bg-white/75"),"aria-label":`View ${"video"===(null==(s=i[a])?void 0:s.type)?"video":"photo"} ${a+1}`},a)})}),!ge&&t.jsx(Ee,{style:He,className:"absolute bottom-20 left-1/2 -translate-x-1/2 text-white/60 text-xs bg-black/40 px-3 py-1 rounded-full backdrop-blur-sm",children:g?(null==(d=h.community)?void 0:d.tapToZoomOut)||"Tap to zoom out":(null==(m=h.community)?void 0:m.tapToZoom)||"Tap to zoom in"})]})})]})})}},Symbol.toStringTag,{value:"Module"}));export{ot as D,wt as P,Lt as R,st as S,nt as a,lt as b,ct as c,It as d,Bt as e,Dt as f,Wt as g,mt as h,Pt as i,Ye as j,Ke as k,Ze as l,Je as m,et as n,rt as o,it as p,dt as q,ut as r,At as s,Ut as u};
