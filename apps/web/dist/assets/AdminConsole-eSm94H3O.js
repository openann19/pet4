const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-admin-g8AIjMAb.js","assets/react-vendor-atdIga2R.js","assets/vendor-B2U5onNE.js","assets/utils-vendor-7mYxNw04.js","assets/ui-vendor-CttiZxwU.js","assets/feature-adoption-C919WvgL.js","assets/feature-community-DxZ7YsOF.js"])))=>i.map(i=>d[i]);
import{c as e,aD as s,C as t,q as a,r as n,n as i,ad as r,ae as c,af as l,ag as o,s as d,I as m,d as x,B as u,D as h,g as j,i as p,j as f,k as _,L as b,t as v,v as g,w as N,x as w,y,T as E,a6 as I,aU as S,am as R,aV as A,_ as L}from"./feature-admin-g8AIjMAb.js";import{j as D,r as V,am as P,aC as C,a1 as T,aG as O,cC as k,ak as U,cD as M,W as z}from"./react-vendor-atdIga2R.js";import{T as F}from"./index-BUV2g3LC.js";import"./utils-vendor-7mYxNw04.js";import"./vendor-B2U5onNE.js";import"./feature-adoption-C919WvgL.js";import"./feature-community-DxZ7YsOF.js";import"./ui-vendor-CttiZxwU.js";import"./view-CommunityView.tsx-CD5NUxZ2.js";import"./view-AdoptionView.tsx-BJlxubb2.js";import"./view-ProfileView.tsx-CUP3xfdt.js";import"./feature-stories-DX9BRjll.js";import"./feature-chat-CPR2_-OR.js";import"./view-ChatView.tsx-DI-Ea8ls.js";import"simple-peer";function $({className:s,...t}){return D.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:D.jsx("table",{"data-slot":"table",className:e("w-full caption-bottom text-sm",s),...t})})}function q({className:s,...t}){return D.jsx("thead",{"data-slot":"table-header",className:e("[&_tr]:border-b",s),...t})}function G({className:s,...t}){return D.jsx("tbody",{"data-slot":"table-body",className:e("[&_tr:last-child]:border-0",s),...t})}function Q({className:s,...t}){return D.jsx("tr",{"data-slot":"table-row",className:e("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function W({className:s,...t}){return D.jsx("th",{"data-slot":"table-head",className:e("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function B({className:s,...t}){return D.jsx("td",{"data-slot":"table-cell",className:e("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function K(){const[e,S]=V.useState([]),[R,A]=V.useState([]),[L,F]=V.useState(null),[K,Y]=V.useState(""),[H,J]=V.useState(!0),[X,Z]=V.useState(!1),[ee,se]=V.useState(null),[te,ae]=V.useState("1"),[ne,ie]=V.useState("");V.useEffect(()=>{re()},[]);const re=async()=>{J(!0);try{const[e,t,a]=await Promise.all([s.getAllSubscriptions(),s.getAuditLogs(100),s.getRevenueMetrics()]);S(e),A(t),F(a)}catch{P.error("Failed to load data")}finally{J(!1)}},ce=e.filter(e=>String(e.userId||"").toLowerCase().includes(K.toLowerCase())||String(e.planId||"").toLowerCase().includes(K.toLowerCase())),le=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e);return H?D.jsx("div",{className:"flex items-center justify-center p-12",children:D.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):D.jsxs("div",{className:"space-y-6",children:[D.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[D.jsxs(t,{children:[D.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[D.jsx(n,{className:"text-sm font-medium",children:"Monthly Recurring Revenue"}),D.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),D.jsxs(i,{children:[D.jsx("div",{className:"text-2xl font-bold",children:L?le(L.mrr):"$0"}),D.jsxs("p",{className:"text-xs text-muted-foreground",children:["ARR: ",L?le(L.arr):"$0"]})]})]}),D.jsxs(t,{children:[D.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[D.jsx(n,{className:"text-sm font-medium",children:"Active Subscriptions"}),D.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),D.jsxs(i,{children:[D.jsx("div",{className:"text-2xl font-bold",children:(null==L?void 0:L.activeSubscriptions)||0}),D.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",(null==L?void 0:L.newSubscriptionsThisMonth)||0," this month"]})]})]}),D.jsxs(t,{children:[D.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[D.jsx(n,{className:"text-sm font-medium",children:"Average Revenue Per User"}),D.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),D.jsxs(i,{children:[D.jsx("div",{className:"text-2xl font-bold",children:L?le(L.arpu):"$0"}),D.jsx("p",{className:"text-xs text-muted-foreground",children:"Per active subscriber"})]})]}),D.jsxs(t,{children:[D.jsxs(a,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[D.jsx(n,{className:"text-sm font-medium",children:"Churn Rate"}),D.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),D.jsxs(i,{children:[D.jsxs("div",{className:"text-2xl font-bold",children:[L?L.churnRate.toFixed(1):"0","%"]}),D.jsxs("p",{className:"text-xs text-muted-foreground",children:[(null==L?void 0:L.canceledSubscriptionsThisMonth)||0," canceled this month"]})]})]})]}),D.jsxs(r,{defaultValue:"subscriptions",className:"space-y-4",children:[D.jsxs(c,{children:[D.jsx(l,{value:"subscriptions",children:"Subscriptions"}),D.jsx(l,{value:"audit",children:"Audit Log"})]}),D.jsx(o,{value:"subscriptions",className:"space-y-4",children:D.jsxs(t,{children:[D.jsxs(a,{children:[D.jsx(n,{children:"Subscription Management"}),D.jsx(d,{children:"View and manage user subscriptions"}),D.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[D.jsxs("div",{className:"relative flex-1",children:[D.jsx(U,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),D.jsx(m,{placeholder:"Search by user ID or plan...",value:K,onChange:e=>Y(e.target.value),className:"pl-10"})]}),D.jsx(x,{onClick:re,variant:"outline",children:"Refresh"})]})]}),D.jsxs(i,{children:[D.jsxs($,{children:[D.jsx(q,{children:D.jsxs(Q,{children:[D.jsx(W,{children:"User ID"}),D.jsx(W,{children:"Plan"}),D.jsx(W,{children:"Status"}),D.jsx(W,{children:"Store"}),D.jsx(W,{children:"Period End"}),D.jsx(W,{children:"Actions"})]})}),D.jsx(G,{children:ce.map(e=>{return D.jsxs(Q,{children:[D.jsxs(B,{className:"font-mono text-xs",children:[String(e.userId||"unknown").slice(0,12),"..."]}),D.jsxs(B,{children:[e.planId,e.isComp&&D.jsxs(u,{variant:"secondary",className:"ml-2",children:[D.jsx(M,{className:"h-3 w-3 mr-1"}),"Comp"]})]}),D.jsx(B,{children:(a=e.status,D.jsx(u,{variant:{active:"default",trial:"secondary",canceled:"destructive",expired:"outline",past_due:"destructive"}[a]||"outline",children:a}))}),D.jsx(B,{className:"capitalize",children:e.store}),D.jsx(B,{children:(t=e.currentPeriodEnd,new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),D.jsx(B,{children:D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(x,{size:"sm",variant:"outline",onClick:()=>{se(e),Z(!0)},children:D.jsx(M,{className:"h-4 w-4"})}),D.jsx(x,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(confirm("Are you sure you want to cancel this subscription?"))try{const t=await spark.user();await s.cancelSubscription(e.id,!0,t.id,"Admin cancellation"),P.success("Subscription canceled"),await re()}catch{P.error("Failed to cancel subscription")}})(e),disabled:"canceled"===e.status,children:D.jsx(z,{className:"h-4 w-4"})})]})})]},e.id);var t,a})})]}),0===ce.length&&D.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No subscriptions found"})]})]})}),D.jsx(o,{value:"audit",className:"space-y-4",children:D.jsxs(t,{children:[D.jsxs(a,{children:[D.jsx(n,{children:"Audit Log"}),D.jsx(d,{children:"Recent administrative actions"})]}),D.jsxs(i,{children:[D.jsxs($,{children:[D.jsx(q,{children:D.jsxs(Q,{children:[D.jsx(W,{children:"Timestamp"}),D.jsx(W,{children:"Actor"}),D.jsx(W,{children:"Action"}),D.jsx(W,{children:"Target User"}),D.jsx(W,{children:"Reason"})]})}),D.jsx(G,{children:R.map(e=>D.jsxs(Q,{children:[D.jsx(B,{className:"text-xs",children:new Date(e.timestamp).toLocaleString()}),D.jsxs(B,{className:"font-mono text-xs",children:[String(e.actorUserId||"unknown").slice(0,12),"...",D.jsx(u,{variant:"outline",className:"ml-2 text-xs",children:e.actorRole})]}),D.jsx(B,{className:"capitalize",children:String(e.action||"").replace(/_/g," ")}),D.jsx(B,{className:"font-mono text-xs",children:e.targetUserId?`${String(e.targetUserId).slice(0,12)}...`:"-"}),D.jsx(B,{className:"text-xs max-w-xs truncate",children:e.reason||"-"})]},e.id))})]}),0===R.length&&D.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No audit logs found"})]})]})})]}),D.jsx(h,{open:X,onOpenChange:Z,children:D.jsxs(j,{children:[D.jsxs(p,{children:[D.jsx(f,{children:"Comp Subscription"}),D.jsx(_,{children:"Grant a complimentary subscription to this user"})]}),D.jsxs("div",{className:"space-y-4",children:[D.jsxs("div",{className:"space-y-2",children:[D.jsx(b,{children:"User ID"}),D.jsx(m,{value:(null==ee?void 0:ee.userId)||"",disabled:!0})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx(b,{children:"Duration (months)"}),D.jsxs(v,{value:te,onValueChange:ae,children:[D.jsx(g,{children:D.jsx(N,{})}),D.jsxs(w,{children:[D.jsx(y,{value:"1",children:"1 month"}),D.jsx(y,{value:"3",children:"3 months"}),D.jsx(y,{value:"6",children:"6 months"}),D.jsx(y,{value:"12",children:"12 months"})]})]})]}),D.jsxs("div",{className:"space-y-2",children:[D.jsx(b,{children:"Reason (required)"}),D.jsx(E,{placeholder:"Why is this subscription being comped?",value:ne,onChange:e=>ie(e.target.value),rows:3})]})]}),D.jsxs(I,{children:[D.jsx(x,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),D.jsx(x,{onClick:async()=>{if(ee&&ne.trim())try{const e=await spark.user();await s.compSubscription(ee.userId,ee.planId,parseInt(te),e.id,ne),P.success("Subscription comped successfully"),Z(!1),ie(""),ae("1"),se(null),await re()}catch{P.error("Failed to comp subscription")}else P.error("Please fill in all fields")},children:"Comp Subscription"})]})]})})]})}function Y(e){return V.lazy(e)}function H(e,s){return V.lazy(async()=>{const t=(await e())[s];if(!t)throw new Error(`Component ${s} not found in module`);return{default:t}})}const J=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bb),__vite__mapDeps([0,1,2,3,4,5,6]))),X=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bc),__vite__mapDeps([0,1,2,3,4,5,6])),"AdoptionListingReview"),Z=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bd),__vite__mapDeps([0,1,2,3,4,5,6]))),ee=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.be),__vite__mapDeps([0,1,2,3,4,5,6]))),se=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bf),__vite__mapDeps([0,1,2,3,4,5,6]))),te=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bg),__vite__mapDeps([0,1,2,3,4,5,6]))),ae=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bh),__vite__mapDeps([0,1,2,3,4,5,6]))),ne=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bi),__vite__mapDeps([0,1,2,3,4,5,6]))),ie=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bj),__vite__mapDeps([0,1,2,3,4,5,6])),"ContentModerationQueue"),re=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bk),__vite__mapDeps([0,1,2,3,4,5,6]))),ce=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bl),__vite__mapDeps([0,1,2,3,4,5,6]))),le=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bm),__vite__mapDeps([0,1,2,3,4,5,6])),"KYCManagement"),oe=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bn),__vite__mapDeps([0,1,2,3,4,5,6])),"LiveStreamManagement"),de=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bo),__vite__mapDeps([0,1,2,3,4,5,6])),"LostFoundManagement"),me=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bp),__vite__mapDeps([0,1,2,3,4,5,6]))),xe=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bq),__vite__mapDeps([0,1,2,3,4,5,6])),"ModerationQueue"),ue=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.br),__vite__mapDeps([0,1,2,3,4,5,6]))),he=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bs),__vite__mapDeps([0,1,2,3,4,5,6]))),je=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bt),__vite__mapDeps([0,1,2,3,4,5,6]))),pe=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bu),__vite__mapDeps([0,1,2,3,4,5,6]))),fe=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bv),__vite__mapDeps([0,1,2,3,4,5,6]))),_e=Y(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bw),__vite__mapDeps([0,1,2,3,4,5,6]))),be=H(()=>L(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.bx),__vite__mapDeps([0,1,2,3,4,5,6])),"VerificationReviewDashboard"),ve=()=>D.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:D.jsxs("div",{className:"flex flex-col items-center gap-4",children:[D.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),D.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading admin panel..."})]})});function ge({onClose:e}){const[s,t]=V.useState("dashboard");return V.useEffect(()=>(S.initialize(R),()=>{S.disconnect()}),[]),D.jsxs(D.Fragment,{children:[D.jsx(A,{currentView:s,onViewChange:t,...e?{onExit:e}:{},children:D.jsxs(V.Suspense,{fallback:D.jsx(ve,{}),children:["dashboard"===s&&D.jsx(ce,{}),"subscriptions"===s&&D.jsx(K,{}),"business-config"===s&&D.jsx(te,{}),"reports"===s&&D.jsx(he,{}),"users"===s&&D.jsx(_e,{}),"community"===s&&D.jsx(ne,{}),"adoption"===s&&D.jsx(Z,{}),"adoption-applications"===s&&D.jsx(J,{}),"adoption-listings"===s&&D.jsx(X,{}),"lost-found"===s&&D.jsx(de,{}),"live-streams"===s&&D.jsx(oe,{}),"content"===s&&D.jsx(re,{}),"moderation"===s&&D.jsx(xe,{}),"content-moderation"===s&&D.jsx(ie,{}),"chat-moderation"===s&&D.jsx(ae,{}),"support-chat"===s&&D.jsx(pe,{}),"kyc"===s&&D.jsx(le,{}),"audit"===s&&D.jsx(se,{}),"settings"===s&&D.jsx(je,{}),"api-config"===s&&D.jsx(ee,{}),"map-settings"===s&&D.jsx(me,{}),"performance"===s&&D.jsx(ue,{}),"system-map"===s&&D.jsx(fe,{}),"verification"===s&&D.jsx(be,{})]})}),D.jsx(F,{})]})}export{ge as default};
