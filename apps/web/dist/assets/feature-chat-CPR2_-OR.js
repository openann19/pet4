const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/feature-admin-g8AIjMAb.js","assets/react-vendor-atdIga2R.js","assets/vendor-B2U5onNE.js","assets/utils-vendor-7mYxNw04.js","assets/ui-vendor-CttiZxwU.js","assets/feature-adoption-C919WvgL.js","assets/feature-community-DxZ7YsOF.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,n)=>((t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n)(t,"symbol"!=typeof a?a+"":a,n);import{r as a,j as n,am as s,bc as r,W as i,at as o,bd as l,be as c,bf as d,bg as u,aK as m,bh as f,bi as h,bj as g,bk as p,ac as v,bl as y}from"./react-vendor-atdIga2R.js";import{K as x,N as b,O as w,Q as j,R as S,U as k,A as N,f as M,V as C,W as E,X as _,d as P,Y as $,Z as A,$ as I,c as D,E as R,_ as T,a0 as L,a1 as z,h as B,a2 as F,G as O,H as U,J as Y,a3 as H,a as X,a4 as V,B as q}from"./feature-admin-g8AIjMAb.js";const G={},W={enableHoloBackground:!0,enableGlowTrail:!0,enableSendPing:!0,enableMessagePeek:!0,enableSmartImage:!0};function K(){return function(){if("undefined"!=typeof window&&"__FEATURE_FLAGS__"in window){const e=window;if(e.__FEATURE_FLAGS__)return{...W,...e.__FEATURE_FLAGS__}}return void 0!==import.meta&&G?{enableHoloBackground:!0,enableGlowTrail:!0,enableSendPing:!0,enableMessagePeek:!0,enableSmartImage:!0}:W}()}let J=60;function Q(e){let t=performance.now(),a=0,n=null,s=!0;const r=i=>{if(s){if(a++,i-t>=1e3){const n=Math.min(240,Math.round(1e3*a/(i-t)));J=n,a=0,t=i,null==e||e(n)}n=requestAnimationFrame(r)}};return n=requestAnimationFrame(r),()=>{s=!1,null!==n&&cancelAnimationFrame(n)}}function Z(){return J}function ee({children:e,isVisible:t,onExitComplete:s,childKey:r}){x();const i=b(t?1:0),o=b(t?1:.95),l=b(t?0:-8),[c,d]=a.useState(t),u=a.useRef(void 0);a.useEffect(()=>(t?(d(!0),i.value=w(1),o.value=w(1),l.value=w(0)):(i.value=j(0),o.value=j(.95),l.value=j(-8),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{d(!1),null==s||s()},S.fast.duration)),()=>{u.current&&clearTimeout(u.current)}),[t,i,o,l,s]);const m=k(()=>({opacity:i.value,transform:[{scale:o.value},{translateY:`${l.value}px`}]}));return c?n.jsx(N,{style:m,className:"w-full",children:e}):null}function te({children:e,mode:t="sync",initial:s=!1,onExitComplete:r}){const i=a.Children.toArray(e),[o,l]=a.useState(()=>{const e=new Set;return i.forEach((t,n)=>{const r=a.isValidElement(t)&&null!==t.key?t.key:n;s&&e.add(r)}),e});a.useEffect(()=>{const e=new Set;i.forEach((t,n)=>{const s=a.isValidElement(t)&&null!==t.key?t.key:n;e.add(s)}),l(e)},[i]);return n.jsx(n.Fragment,{children:i.map((e,t)=>{const s=a.isValidElement(e)&&null!==e.key?e.key:t,i=o.has(s);return n.jsx(ee,{childKey:s,isVisible:i,onExitComplete:()=>(e=>{l(t=>{const a=new Set(t);return a.delete(e),0===a.size&&(null==r||r()),a})})(s),children:e},s)})})}const ae=M("LocalStorage");function ne(e){if("undefined"==typeof window||"undefined"==typeof localStorage)return null;try{const a=localStorage.getItem(e);if(!a)return null;const n=JSON.parse(a);if(n.ttl){const a=Date.now();if(a-n.timestamp>n.ttl){try{localStorage.removeItem(e)}catch(t){const a=t instanceof Error?t:new Error(String(t));ae.error("Error removing expired item from localStorage",a,{key:e})}return null}}return n.value}catch(a){const t=a instanceof Error?a:new Error(String(a));return ae.error("Error reading from localStorage",t,{key:e}),null}}function se(e,t,a={}){if("undefined"==typeof window||"undefined"==typeof localStorage)return!1;try{const n={value:t,timestamp:Date.now(),...void 0!==a.ttl?{ttl:a.ttl}:{}};return localStorage.setItem(e,JSON.stringify(n)),!0}catch(n){const t=n instanceof Error?n:new Error(String(n));return ae.error("Error writing to localStorage",t,{key:e}),!1}}function re(e){if("undefined"==typeof window||"undefined"==typeof localStorage)return!1;try{return localStorage.removeItem(e),!0}catch(t){const a=t instanceof Error?t:new Error(String(t));return ae.error("Error removing from localStorage",a,{key:e}),!1}}function ie(e){return function(e){if(!e)return[];if(Array.isArray(e))return e;const t=[];for(const[a,n]of Object.entries(e))Array.isArray(n)&&t.push({emoji:a,userIds:n,count:n.length});return t}(e)}function oe(e){if(!e)return"";const t="string"==typeof e||"number"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"";const a=(new Date).getTime()-t.getTime(),n=Math.floor(a/6e4),s=Math.floor(a/36e5),r=Math.floor(a/864e5);return n<1?"now":n<60?`${n}m`:s<24?`${s}h`:r<7?`${r}d`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}const le=oe;function ce(){return`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function de(e){const t=new Map;for(const a of e){const e=a.timestamp||a.createdAt;if(!e)continue;const n=new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});t.has(n)||t.set(n,[]),t.get(n).push(a)}return Array.from(t.entries()).map(([e,t])=>({date:e,messages:t}))}function ue(e,t,a,n,s,r,i){const o=(new Date).toISOString();return{id:`chat-${e}`,participantIds:[t,a],type:"direct",matchId:e,matchedPetId:a,matchedPetName:s,...i?{matchedPetPhoto:i}:{},unreadCount:{},createdAt:o,updatedAt:o}}const me=[{id:"dog",emoji:"üêï",name:"Dog",label:"Dog"},{id:"cat",emoji:"üêà",name:"Cat",label:"Cat"},{id:"paw",emoji:"üêæ",name:"Paw",label:"Paw"},{id:"heart",emoji:"‚ù§Ô∏è",name:"Heart",label:"Heart"},{id:"happy",emoji:"üòä",name:"Happy",label:"Happy"},{id:"ball",emoji:"üéæ",name:"Ball",label:"Ball"},{id:"bone",emoji:"ü¶¥",name:"Bone",label:"Bone"},{id:"dog-face",emoji:"üê∂",name:"Dog Face",label:"Dog Face"},{id:"cat-face",emoji:"üê±",name:"Cat Face",label:"Cat Face"},{id:"star",emoji:"‚≠ê",name:"Star",label:"Star"}];function fe({onRecorded:e,onCancel:t,maxDuration:l=120}){x();const[c,d]=a.useState(0),[u,m]=a.useState([]),f=a.useRef(null),h=a.useRef([]),g=a.useRef(void 0),p=a.useRef(void 0),v=a.useRef(void 0),y=a.useRef(void 0),w=b(0),S=b(.9),N=b(1);a.useEffect(()=>(M(),w.value=j(1),S.value=j(1),N.value=C(E(j(1.2),j(1))),()=>{f.current&&"inactive"!==f.current.state&&(f.current.stop(),f.current.stream.getTracks().forEach(e=>e.stop())),g.current&&cancelAnimationFrame(g.current),y.current&&clearInterval(y.current),p.current&&p.current.close()}),[]);const M=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);f.current=t,h.current=[];const a=new AudioContext,n=a.createMediaStreamSource(e),s=a.createAnalyser();s.fftSize=256,n.connect(s),p.current=a,v.current=s,t.addEventListener("dataavailable",e=>{h.current.push(e.data)}),t.start(),$(),y.current=window.setInterval(()=>{d(e=>e>=l?(I(),e):e+1)},1e3)}catch{s.error("Unable to access microphone"),t()}},$=()=>{if(!v.current)return;const e=v.current.frequencyBinCount,t=new Uint8Array(e),a=()=>{if(!v.current)return;v.current.getByteFrequencyData(t);const n=t.reduce((e,t)=>e+t)/e,s=Math.min(n/128,1);m(e=>[...e,s].slice(-50)),g.current=requestAnimationFrame(a)};a()},A=()=>{f.current&&"inactive"!==f.current.state&&(f.current.stop(),f.current.stream.getTracks().forEach(e=>e.stop())),y.current&&clearInterval(y.current)},I=()=>{A(),f.current&&f.current.addEventListener("stop",()=>{const t=new Blob(h.current,{type:"audio/webm"});e(t,c,u)},{once:!0})},D=e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,R=k(()=>({opacity:w.value,transform:[{scale:S.value}]})),T=k(()=>({transform:[{scale:N.value}]})),L=_(R),z=_(T);return n.jsxs("div",{style:L,className:"flex-1 flex items-center gap-3 glass-effect rounded-2xl p-3",children:[n.jsx("div",{style:z,className:"shrink-0",children:n.jsx(r,{size:24,weight:"fill",className:"text-red-500"})}),n.jsxs("div",{className:"flex-1 space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs font-semibold",children:"Recording"}),n.jsx("span",{className:"text-xs text-muted-foreground",children:D(c)}),l&&n.jsxs("span",{className:"text-[10px] text-muted-foreground ml-auto",children:[D(l-c)," left"]})]}),n.jsx("div",{className:"flex items-center gap-0.5 h-6",children:u.map((e,t)=>n.jsx(he,{value:e},t))})]}),n.jsx(P,{size:"icon",variant:"ghost",onClick:()=>{A(),t()},className:"shrink-0","aria-label":"Cancel recording",children:n.jsx(i,{size:20})}),n.jsx(P,{size:"icon",onClick:I,className:"shrink-0 bg-linear-to-br from-primary to-accent","aria-label":"Stop and send recording",children:n.jsx(o,{size:20,weight:"bold"})})]})}function he({value:e}){const t=b(0);a.useEffect(()=>{t.value=j(100*e)},[e,t]);const s=k(()=>({height:`${t.value}%`}));return n.jsx(N,{style:s,className:"flex-1 bg-primary rounded-full",children:n.jsx("div",{})})}const ge=8,pe=15,ve=150,ye=1e3;const xe=0,be=40,we="outgoing",je=!0,Se=!0;function ke(e={}){const{scale:t=1.02,duration:n=S.fast.duration,enabled:s=!0}=e,r=b(1),i=b(0),o=b(0),l=a.useCallback(()=>{s&&(i.value=1,r.value=w(t))},[s,t,i,r]),c=a.useCallback(()=>{s&&(i.value=0,r.value=w(1))},[s,i,r]),d=a.useCallback(()=>{s&&(o.value=1,r.value=j(.98))},[s,n,o,r]),u=a.useCallback(()=>{if(!s)return;o.value=0;const e=1===i.value?t:1;r.value=w(e)},[s,t,i,o,r]);return{animatedStyle:k(()=>({transform:[{scale:r.value}]})),handleMouseEnter:l,handleMouseLeave:c,handleMouseDown:d,handleMouseUp:u}}function Ne(e={}){const{delay:t=0,duration:n=S.smooth.duration,initialY:s=20,initialOpacity:r=0,initialScale:i=.95,enabled:o=!0}=e,l=b(o?r:1),c=b(o?s:0),d=b(o?i:1);a.useEffect(()=>{if(!o)return l.value=1,c.value=0,void(d.value=1);const e=setTimeout(()=>{l.value=w(1),c.value=w(0),d.value=w(1)},t);return()=>{clearTimeout(e)}},[t,o,l,c,d]);return{animatedStyle:k(()=>({opacity:l.value,transform:[{translateY:`${c.value}px`},{scale:d.value}]})),opacity:l,translateY:c,scale:d}}function Me({dotSize:e=6,dotColor:t="#9ca3af",gap:a=4,animationDuration:s=1200,className:r}){return x(),n.jsx("div",{className:D("flex items-center",r),style:{gap:a},children:[0,1,2].map(a=>n.jsx(Ce,{dotSize:e,dotColor:t,animationDuration:s,delay:200*a},a))})}function Ce({dotSize:e,dotColor:t,animationDuration:s,delay:r}){const i=b(1),o=b(.5);a.useEffect(()=>{i.value=I(r,C(E(j(1.4),j(1)))),o.value=I(r,C(E(j(1),j(.5))))},[r,s,i,o]);const l=k(()=>({transform:[{scale:i.value}],opacity:o.value,width:e,height:e,backgroundColor:t}));return n.jsx(N,{style:l,className:"rounded-full",children:n.jsx("div",{})})}function Ee({children:e,isIncoming:t=!1,index:s=0,onClick:r,onLongPress:i,hasReaction:o=!1,reactionEmoji:l="‚ù§Ô∏è",showTyping:c=!1,className:d,bubbleClassName:u,enable3DTilt:m=!0,staggerDelay:f=.04,glowOpacity:h=0,glowIntensity:g=.85}){x();const p=function(e={}){const{maxTilt:t=ge,damping:n=pe,stiffness:s=ve,enabled:r=!0,perspective:i=ye}=e,o=b(0),l=b(0),c=b(0),d=a.useCallback((e,a,n,s)=>{if(!r)return;const i=e-n/2,d=$(a-s/2,[-s/2,s/2],[t,-t],A.CLAMP),u=$(i,[-n/2,n/2],[-t,t],A.CLAMP);o.value=w(d),l.value=w(u);const m=Math.sqrt(d*d+u*u);c.value=w($(m,[0,t],[0,1],A.CLAMP))},[r,t,n,s,o,l,c]),u=a.useCallback(()=>{r&&(o.value=w(0),l.value=w(0),c.value=w(0))},[r,n,s,o,l,c]),m=k(()=>{if(!r)return{transform:[{perspective:i},{rotateX:"0deg"},{rotateY:"0deg"}]};const e=$(c.value,[0,1],[4,16],A.CLAMP),t=$(c.value,[0,1],[0,8],A.CLAMP),a=$(c.value,[0,1],[.2,.4],A.CLAMP);return{transform:[{perspective:i},{rotateX:`${o.value}deg`},{rotateY:`${l.value}deg`}],boxShadow:`0 ${4*c.value}px ${e}px ${t}px rgba(0, 0, 0, ${a})`}});return{rotateX:o,rotateY:l,shadowDepth:c,animatedStyle:m,handleMove:d,handleLeave:u}}({enabled:m,maxTilt:10}),v=function(e={}){const{index:t=xe,staggerDelay:n=be,direction:s=we,enabled:r=je,isNew:i=Se}=e,o=b(i&&r?0:1),l=b(i&&r?20:0),c=b(i&&r?"incoming"===s?-30:30:0),d=b(i&&r?.95:1),u=a.useCallback(()=>{if(!r||!i)return;const e=t*n;o.value=I(e,w(1)),l.value=I(e,w(0)),c.value=I(e,w(0)),d.value=I(e,w(1))},[r,i,t,n,s,o,l,c,d]);a.useEffect(()=>{r&&i&&u()},[r,i,u]);const m=k(()=>({opacity:o.value,transform:[{translateY:l.value},{translateX:c.value},{scale:d.value}]}));return{opacity:o,translateY:l,translateX:c,scale:d,animatedStyle:m,trigger:u}}({index:s,staggerDelay:1e3*f,direction:t?"incoming":"outgoing",enabled:!0,isNew:!0}),y=ke({scale:1.02,enabled:m}),j=Ne({initialScale:0,delay:100,enabled:o}),S=a.useCallback(e=>{if(!m)return;const t=e.currentTarget.getBoundingClientRect(),a=e.clientX-t.left-t.width/2,n=e.clientY-t.top-t.height/2;p.handleMove(a,n,t.width,t.height)},[m,p]),M=a.useCallback(()=>{m&&p.handleLeave()},[m,p]),C=a.useCallback(e=>{e.preventDefault(),i&&i()},[i]),E=k(()=>({opacity:v.opacity.value,transform:[{translateY:v.translateY.value},{translateX:v.translateX.value},{scale:v.scale.value},{rotateX:`${p.rotateX.value}deg`},{rotateY:`${p.rotateY.value}deg`}]})),_=y.animatedStyle,P=k(()=>{if(h<=0)return{};return{position:"absolute",inset:"-4px",borderRadius:"inherit",background:`radial-gradient(circle, ${t?"rgba(59, 130, 246, 0.6)":"rgba(255, 255, 255, 0.8)"} 0%, transparent 70%)`,opacity:h*g,filter:"blur(8px)",pointerEvents:"none",zIndex:-1}});return n.jsxs(N,{onMouseMove:S,onMouseLeave:M,onClick:r,onContextMenu:C,style:E,className:D("relative",d),children:[h>0&&n.jsx(N,{style:P,children:n.jsx("div",{})}),n.jsx(N,{style:_,onMouseEnter:y.handleMouseEnter,onMouseLeave:y.handleMouseLeave,onMouseDown:y.handleMouseDown,onMouseUp:y.handleMouseUp,className:D("relative max-w-[85%] rounded-2xl px-4 py-2 shadow-lg transition-all duration-200",t?"bg-neutral-800 text-white self-start rounded-bl-sm":"bg-blue-600 text-white self-end rounded-br-sm",u),children:c?n.jsx(Me,{dotColor:t?"#9ca3af":"#ffffff",dotSize:6}):e}),o&&n.jsx(N,{style:j.animatedStyle,className:"absolute -bottom-4 -right-2 text-base pointer-events-none",children:l})]})}function _e({...e}){return n.jsx(l,{"data-slot":"popover",...e})}function Pe({...e}){return n.jsx(c,{"data-slot":"popover-trigger",...e})}function $e({className:e,align:t="center",sideOffset:a=4,...s}){return n.jsx(d,{children:n.jsx(u,{"data-slot":"popover-content",align:t,sideOffset:a,className:D("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...s})})}M("FeatureFlagsAPI");const Ae={stories_enabled:{key:"stories_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"24-hour expiring stories feature",lastModified:(new Date).toISOString(),modifiedBy:"system"},voice_messages_enabled:{key:"voice_messages_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Voice message recording and playback",lastModified:(new Date).toISOString(),modifiedBy:"system"},location_sharing_enabled:{key:"location_sharing_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Real-time location sharing in chat",lastModified:(new Date).toISOString(),modifiedBy:"system"},ai_photo_analysis_enabled:{key:"ai_photo_analysis_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"AI-powered pet photo analysis",lastModified:(new Date).toISOString(),modifiedBy:"system"},admin_console_enabled:{key:"admin_console_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Admin console access",lastModified:(new Date).toISOString(),modifiedBy:"system"},premium_animations_enabled:{key:"premium_animations_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Premium animations and micro-interactions",lastModified:(new Date).toISOString(),modifiedBy:"system"},push_notifications_enabled:{key:"push_notifications_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Push notification system",lastModified:(new Date).toISOString(),modifiedBy:"system"},advanced_filters_enabled:{key:"advanced_filters_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Advanced discovery filters",lastModified:(new Date).toISOString(),modifiedBy:"system"},story_highlights_enabled:{key:"story_highlights_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Permanent story highlight collections",lastModified:(new Date).toISOString(),modifiedBy:"system"},message_reactions_enabled:{key:"message_reactions_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Emoji reactions on messages",lastModified:(new Date).toISOString(),modifiedBy:"system"},typing_indicators_enabled:{key:"typing_indicators_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Real-time typing indicators",lastModified:(new Date).toISOString(),modifiedBy:"system"},read_receipts_enabled:{key:"read_receipts_enabled",enabled:!0,rolloutPercentage:100,environments:["dev","staging","prod"],description:"Message read receipts",lastModified:(new Date).toISOString(),modifiedBy:"system"},"chat.confetti":{key:"chat.confetti",enabled:!1,rolloutPercentage:0,environments:["dev","staging","prod"],description:"Confetti celebration effect for matches/likes",lastModified:(new Date).toISOString(),modifiedBy:"system"},"chat.reactionBurst":{key:"chat.reactionBurst",enabled:!1,rolloutPercentage:0,environments:["dev","staging","prod"],description:"Reaction burst animation with particles",lastModified:(new Date).toISOString(),modifiedBy:"system"},"chat.auroraRing":{key:"chat.auroraRing",enabled:!1,rolloutPercentage:0,environments:["dev","staging","prod"],description:"Aurora ring glow effect for active users",lastModified:(new Date).toISOString(),modifiedBy:"system"},"chat.virtualization":{key:"chat.virtualization",enabled:!1,rolloutPercentage:0,environments:["dev","staging","prod"],description:"Virtualized message list for 10k+ messages",lastModified:(new Date).toISOString(),modifiedBy:"system"}};function Ie(e){const[t]=R("feature-flags",Ae),[n,s]=a.useState(!1);return a.useEffect(()=>{if(!(null==t?void 0:t[e]))return void s(Ae[e].enabled);const a=t[e];if(a.enabled)if(a.rolloutPercentage<100){const t=function(e){let t=0;for(let a=0;a<e.length;a++){t=(t<<5)-t+e.charCodeAt(a),t&=t}return Math.abs(t)}((localStorage.getItem("user-id")||"anonymous")+e);s(t%100<a.rolloutPercentage)}else s(!0);else s(!1)},[t,e]),n}const De="(prefers-reduced-motion: reduce)";function Re(){if("undefined"==typeof window||"function"!=typeof window.matchMedia)return!1;try{return window.matchMedia(De).matches}catch{return!1}}function Te(){const[e,t]=a.useState(()=>Re());return a.useEffect(()=>{let e=!0;if("undefined"!=typeof window&&window.matchMedia){const a=window.matchMedia(De),n=a=>{e&&t(!!a.matches)};try{return a.addEventListener?a.addEventListener("change",n):a.addListener&&a.addListener(n),t(a.matches),()=>{e=!1,a.removeEventListener?a.removeEventListener("change",n):a.removeListener&&a.removeListener(n)}}catch{}}return()=>{e=!1}},[]),e}function Le(){const e=b(Re()),t=Te();return a.useEffect(()=>{e.value=t},[t,e]),e}function ze(e,t){return t?Math.min(120,e):e}async function Be(){return null}let Fe=null,Oe=null;async function Ue(){return null!==Fe?Fe:Oe||(Oe=T(()=>import("./feature-admin-g8AIjMAb.js").then(e=>e.b9),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>(e.haptics&&"object"==typeof e.haptics&&(Fe={haptics:e.haptics}),Fe)).catch(()=>null),Oe)}const Ye=()=>"undefined"!=typeof performance&&performance.now?performance.now():Date.now(),He={send:{type:"selection"},receive:{type:"light"},reaction:{type:"light"},reply:{type:"light"},delete:{type:"strong"},swipe:{type:"light"},longPress:{type:"medium"},tap:{type:"selection"},success:{type:"success"},error:{type:"error"},threshold:{type:"light"},statusChange:{type:"selection"}};class Xe{constructor(e=250){t(this,"lastTs",-1/0),t(this,"cooldownMs"),t(this,"reduced",Re()),this.cooldownMs=e}updateReducedMotion(e){this.reduced="boolean"==typeof e?e:Re()}async triggerAsync(e,t=!1){if(this.reduced)return!1;const a=Ye();if(!t&&a-this.lastTs<this.cooldownMs)return!1;try{if(await Promise.all([Ue(),Be()]),!(null==Fe?void 0:Fe.haptics))return!1;switch(e){case"selection":Fe.haptics.selection();break;case"light":Fe.haptics.impact("light");break;case"medium":Fe.haptics.impact("medium");break;case"strong":Fe.haptics.impact("heavy");break;case"success":Fe.haptics.success();break;case"warning":Fe.haptics.warning();break;case"error":Fe.haptics.error()}return this.lastTs=a,!0}catch{return!1}}trigger(e,t=!1){if(this.triggerAsync(e,t).catch(()=>{}),this.reduced)return!1;const a=Ye();return!(!t&&a-this.lastTs<this.cooldownMs)&&(this.lastTs=a,!0)}getTimeSinceLastTrigger(){return Ye()-this.lastTs}isCooldownActive(){return this.getTimeSinceLastTrigger()<this.cooldownMs}resetCooldown(){this.lastTs=-1/0}async triggerByContext(e,t=!1){const a=He[e];return!!a&&this.triggerAsync(a.type,t)}async triggerPattern(e,t=!1){if(this.reduced)return!1;const a=Ye();if(!t&&a-this.lastTs<this.cooldownMs)return!1;try{const a=e.repeat??1,n=e.interval??50;for(let s=0;s<a;s++)s>0&&n>0&&await new Promise(e=>setTimeout(e,n)),await this.triggerAsync(e.type,0!==s||t);return this.lastTs=Ye(),!0}catch{return!1}}}let Ve=null;function qe(e,t=!1){return(Ve??(Ve=new Xe)).trigger(e,t)}const Ge=M("Analytics");function We(){return!0===(ne("gdpr-consent")??L).analytics}const Ke=new class{track(e,t){"undefined"!=typeof window&&(We()?(Ge.debug("Track event",{eventName:e,properties:t}),window.spark_analytics&&window.spark_analytics.track(e,t)):Ge.debug("Analytics tracking skipped - consent not granted",{eventName:e}))}isEnabled(){return We()}clear(){"undefined"!=typeof window&&(Ge.debug("Clearing analytics data"),window.spark_analytics&&"function"==typeof window.spark_analytics.clear&&window.spark_analytics.clear())}},Je=Object.freeze(Object.defineProperty({__proto__:null,analytics:Ke},Symbol.toStringTag,{value:"Module"}));class Qe{constructor(e=Date.now()>>>0){t(this,"seed"),t(this,"_gaussSpare",null),this.seed=e>>>0}nextInt(e,t){return this.rangeInt(e,t)}next(){return this.seed=Math.imul(1664525,this.seed)+1013904223>>>0,this.seed/4294967296}range(e,t){return e+this.next()*(t-e)}rangeInt(e,t){return e+this.next()*(t-e)|0}nextGaussian(e=0,t=1){if(null!==this._gaussSpare){const a=this._gaussSpare;return this._gaussSpare=null,e+a*t}let a=0,n=0;for(;0===a;)a=this.next();for(;0===n;)n=this.next();const s=Math.sqrt(-2*Math.log(a)),r=s*Math.cos(2*Math.PI*n),i=s*Math.sin(2*Math.PI*n);return this._gaussSpare=i,e+r*t}setSeed(e){this.seed=e>>>0,this._gaussSpare=null}getSeed(){return this.seed>>>0}static seedFromString(e){let t=2166136261;for(let a=0;a<e.length;a++)t^=e.charCodeAt(a),t=Math.imul(t,16777619)>>>0;return t>>>0}}let Ze=null;function et(){return Ze??(Ze=new Qe(Date.now()>>>0))}const tt=M("effect-telemetry"),at=new Map;function nt(){if("undefined"==typeof window)return 60;try{const e=Z();return e>=240?240:e>=120?120:60}catch{return window.devicePixelRatio>=2&&"ontouchstart"in window?120:60}}function st(e,t={}){const a=`${e}-${Date.now()}-${et().next().toString(36).substring(2,9)}`,n=Date.now(),s={effect:e,startedAt:n,metadata:{...t,effect:e,startedAt:n,deviceHz:nt()}};at.set(a,s);const r={effect:e,startedAt:n.toString()};for(const[i,o]of Object.entries(t))null!=o&&"error"!==i&&(r[i]="string"==typeof o||"number"==typeof o||"boolean"==typeof o?o:"object"==typeof o?JSON.stringify(o):String(o));return Ke.track("effect_start",r),tt.debug("Effect started",{effect:e,effectId:a,startedAt:n}),a}function rt(e,t={}){var a;const n=at.get(e);if(!n)return void tt.warn("Effect end called for unknown effect",{effectId:e});const s=Date.now(),r=s-n.startedAt,i={effect:n.effect,startedAt:n.startedAt,...n.metadata,...t};at.delete(e);const o=i.droppedFrames??0,l=i.deviceHz??60,c=1e3/l,d=Math.ceil(r/c),u=d>0?o/d*100:0;(o>2||u>2)&&(tt.warn("Effect exceeded dropped frame threshold",{effect:i.effect,droppedFrames:o,dropRate:u.toFixed(2),durationMs:r,expectedFrames:d,frameBudget:c.toFixed(2),deviceHz:l,threshold:2}),Ke.track("effect_performance_issue",{effect:i.effect,droppedFrames:o.toString(),dropRate:u.toFixed(2),durationMs:r.toString(),deviceHz:l.toString(),frameBudget:c.toFixed(2),threshold:"2"})),Ke.track("effect_end",{effect:i.effect,startedAt:i.startedAt.toString(),endedAt:s.toString(),durationMs:r.toString(),droppedFrames:o.toString(),dropRate:u.toFixed(2),deviceHz:l.toString(),frameBudget:c.toFixed(2),success:(null==(a=i.success)?void 0:a.toString())??"true"}),tt.debug("Effect ended",{effect:i.effect,effectId:e,durationMs:r,droppedFrames:o,success:i.success})}function it(e,t){return t<=60?e:Math.round(e*(60/t))}function ot(e,t){return t<=60?e:Math.round(e*(t/60))}function lt(e,t){return{duration:it(e.duration,t),stiffness:e.stiffness?ot(e.stiffness,t):280,damping:e.damping??20,mass:e.mass??1}}const ct=(e=60)=>lt({duration:300,stiffness:280,damping:20,mass:1},e);function dt(){const[e,t]=a.useState(60);a.useEffect(()=>{const e=Q(e=>{t(e>=240?240:e>=120?120:60)}),a=Z();return t(a>=240?240:a>=120?120:60),e},[]);const n=e>=240?240:e>=120?120:60,s=n>60,r=n>=240,i=function(e){const t=60===e&&!1,a=120===e||60===e&&!0,n=e>=240||120===e&&!0;let s=80;return n?s=e>=240?200:120:a&&(s=100),{refreshRate:e,isLowEnd:t,isMidRange:a,isHighEnd:n,maxParticles:s,supportsAdvancedEffects:!t}}(n);return{hz:n,isHighRefreshRate:s,isUltraHighRefreshRate:r,deviceCapability:i,scaleDuration:e=>it(e,n),scaleSpringStiffness:e=>ot(e,n)}}const ut=z.bezier(.17,.84,.44,1),mt=!0;const ft=!0,ht=!0;function gt(e={}){const{enabled:t=ft,isNew:n=ht,isMention:s=!1,onComplete:r}=e,i=Le(),{hz:o,scaleDuration:l}=dt(),{visual:c,feedback:d,animation:u}=x(),m=b(n&&t?.98:1),f=b(0),h=b(0),g=a.useCallback(()=>{if(!t||!n)return;const e=i.value,a=e?ze(180,!0):180+(g=0,p=40,et().range(g,p));var g,p;const v=l(a),y=st("receive-air-cushion",{reducedMotion:e,isMention:s});e?m.value=j(1):(u.enableReanimated&&u.springPhysics?(u.springPhysics.stiffness,u.springPhysics.damping,u.springPhysics.mass):ct(o),m.value=w(1)),c.enableShadows&&(f.value=j(1),h.value=j(4)),s&&d.haptics&&qe("light"),r&&setTimeout(()=>{r()},v),setTimeout(()=>{rt(y,{durationMs:v,success:!0})},v)},[t,n,s,i,o,l,c,d,u,m,f,h,r]);a.useEffect(()=>{t&&n&&g()},[t,n,g]);const p=k(()=>({transform:[{scale:m.value}],boxShadow:`0 ${h.value}px ${2*h.value}px rgba(0, 0, 0, ${.2*f.value})`}));return{scale:m,shadowOpacity:f,shadowRadius:h,animatedStyle:p,trigger:g}}function pt({reactions:e,availableReactions:t,onReact:s,currentUserId:r}){x();const[i,o]=a.useState(!1),[l,c]=a.useState(new Set),d=a.useMemo(()=>e.reduce((e,t)=>{var a;if(!t.emoji)return e;e[a=t.emoji]??(e[a]=[]);const n=e[t.emoji];return void 0!==n&&n.push(t),e},{}),[e]),u=a.useCallback(e=>e.some(e=>e.userId===r),[r]);a.useEffect(()=>{const e=new Set(Object.keys(d));c(t=>{const a=new Set(t);return e.forEach(e=>{a.add(e)}),t.forEach(t=>{e.has(t)||a.delete(t)}),a})},[d]);const m=a.useCallback(e=>{B.selection(),s(e)},[s]),f=a.useCallback(e=>{B.selection(),s(e),o(!1)},[s]);return n.jsxs("div",{className:"flex items-center gap-1 mt-2 flex-wrap",children:[Object.entries(d).map(([e,t])=>{if(!l.has(e))return null;const a=u(t);return n.jsx(vt,{emoji:e,count:t.length,userReacted:a,reactions:t,onClick:()=>m(e)},e)}),n.jsx(yt,{showPicker:i,onTogglePicker:o,availableReactions:t,onSelectReaction:f})]})}function vt({emoji:e,count:t,userReacted:s,reactions:r,onClick:i}){const o=b(0),l=b(0),c=b(1);a.useEffect(()=>{o.value=w(1),l.value=j(1)},[o,l]);const d=F({onPress:i,hapticFeedback:!0,scale:.95}),u=k(()=>({transform:[{scale:o.value*c.value*d.scale.value}],opacity:l.value})),m=a.useCallback(()=>{c.value=w(1.1)},[c]),f=a.useCallback(()=>{c.value=w(1)},[c]);return n.jsxs(_e,{children:[n.jsx(Pe,{asChild:!0,children:n.jsx("button",{type:"button",onClick:d.handlePress,onMouseEnter:m,onMouseLeave:f,className:"flex items-center gap-1 px-2 py-0.5 rounded-full text-xs transition-colors cursor-pointer "+(s?"bg-primary/20 ring-1 ring-primary":"bg-white/10 hover:bg-white/20"),children:n.jsxs(N,{style:u,className:"flex items-center gap-1",children:[n.jsx("span",{className:"text-sm",children:e}),n.jsx("span",{className:"text-[10px] font-semibold",children:t})]})})}),n.jsx($e,{className:"w-48 glass-strong p-2",children:n.jsx("div",{className:"space-y-2",children:r.map((t,a)=>{var s;return n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(O,{className:"w-6 h-6",children:[n.jsx(U,{src:t.userAvatar,alt:t.userName??"User"}),n.jsx(Y,{className:"text-[10px]",children:(null==(s=t.userName)?void 0:s[0])??"?"})]}),n.jsx("span",{className:"text-xs",children:t.userName??"Unknown"}),n.jsx("span",{className:"ml-auto text-sm",children:e})]},`${t.userId??a}-${a}`)})})})]})}function yt({showPicker:e,onTogglePicker:t,availableReactions:s,onSelectReaction:r}){const i=b(1),o=b(.9),l=b(0),c=F({onPress:()=>t(!e),hapticFeedback:!0,scale:.95}),d=k(()=>({transform:[{scale:i.value*c.scale.value}]})),u=k(()=>({transform:[{scale:o.value}],opacity:l.value}));a.useEffect(()=>{e?(o.value=w(1),l.value=j(1)):(o.value=j(.9),l.value=j(0))},[e,o,l]);const f=a.useCallback(()=>{i.value=w(1.1)},[i]),h=a.useCallback(()=>{i.value=w(1)},[i]),g=a.useCallback(e=>{B.selection(),r(e)},[r]);return n.jsxs(_e,{open:e,onOpenChange:t,children:[n.jsx(Pe,{asChild:!0,children:n.jsx("button",{type:"button",onClick:c.handlePress,onMouseEnter:f,onMouseLeave:h,className:"flex items-center justify-center w-6 h-6 rounded-full bg-white/10 hover:bg-white/20 transition-colors cursor-pointer",children:n.jsx(N,{style:d,children:n.jsx(m,{size:12,weight:"bold"})})})}),n.jsx($e,{className:"w-64 glass-strong p-3",children:n.jsx(N,{style:u,children:n.jsx("div",{className:"grid grid-cols-6 gap-2",children:s.map(e=>n.jsx(xt,{emoji:e,onClick:()=>g(e)},e))})})})]})}function xt({emoji:e,onClick:t}){const s=b(1),r=F({onPress:t,hapticFeedback:!0,scale:.9}),i=k(()=>({transform:[{scale:s.value*r.scale.value}]})),o=a.useCallback(()=>{s.value=w(1.2)},[s]),l=a.useCallback(()=>{s.value=w(1)},[s]);return n.jsx(N,{style:i,onClick:r.handlePress,onMouseEnter:o,onMouseLeave:l,className:"text-2xl p-1 rounded-lg hover:bg-white/20 transition-colors cursor-pointer flex items-center justify-center",children:e})}function bt({src:e,lqip:t,alt:s,className:r="",width:i,height:o,onLoad:l,onClick:c}){const[d,u]=a.useState(!1),[m,f]=a.useState(!1),h=H(),{enableSmartImage:g}=K(),p=a.useRef(null),v=b(.6),y=b(0),x=b(0);a.useEffect(()=>{g&&(h?y.value=1:(v.value=j(.6),d&&m&&(y.value=w(1),x.value=w(0))))},[d,m,h,g,y,v,x]);const S=k(()=>({opacity:v.value})),M=k(()=>({opacity:y.value,transform:[{translateY:x.value}]}));return g?n.jsxs("div",{className:D("relative overflow-hidden",r),style:{width:i,height:o},children:[t&&!m&&n.jsx("img",{src:t,alt:"",className:"absolute inset-0 w-full h-full object-cover blur-sm","aria-hidden":"true"}),!d&&n.jsx(N,{style:S,className:"absolute inset-0 bg-linear-to-r from-transparent via-white/20 to-transparent animate-shimmer","aria-hidden":"true",children:n.jsx("div",{})}),n.jsx("img",{ref:p,src:e,alt:s,className:D("w-full h-full object-cover transition-opacity",m?"opacity-100":"opacity-0",c?"cursor-pointer":""),style:M,width:i,height:o,onLoad:()=>{u(!0),setTimeout(()=>{f(!0),null==l||l()},h?0:30)},onClick:c,loading:"lazy",decoding:"async"})]}):n.jsx("img",{src:e,alt:s,className:r,width:i,height:o,onLoad:l})}function wt({attachments:e}){return x(),n.jsx("div",{className:"space-y-2",children:e.map(e=>"voice"===e.type?n.jsx(jt,{attachment:e},e.id):"photo"===e.type?n.jsx(St,{attachment:e},e.id):"video"===e.type?n.jsx(kt,{attachment:e},e.id):"document"===e.type?n.jsx(Nt,{attachment:e},e.id):null)})}function jt({attachment:e}){const[t,s]=a.useState(!1),r=a.useCallback((e=0)=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),i=a.useCallback(()=>{s(e=>!e)},[]),o=e.waveform??Array.from({length:30},()=>.5);return n.jsxs("div",{className:"flex items-center gap-3 min-w-[200px]",children:[n.jsx(P,{size:"icon",variant:"ghost",onClick:i,className:"shrink-0 w-8 h-8","aria-label":t?"Pause voice message":"Play voice message",children:t?n.jsx(f,{size:16,weight:"fill"}):n.jsx(h,{size:16,weight:"fill"})}),n.jsxs("div",{className:"flex-1 space-y-1",children:[n.jsx("div",{className:"flex items-center gap-0.5 h-4",role:"img","aria-label":"Audio waveform",children:o.map((e,t)=>n.jsx("div",{className:"flex-1 bg-current opacity-40 rounded-full",style:{height:`${Math.max(20,100*e)}%`}},t))}),n.jsx("span",{className:"text-[10px] opacity-70",children:r(e.duration)})]})]})}function St({attachment:e}){const t=X({scale:1.02}),s=a.useCallback(()=>{const t=document.createElement("a");t.href=e.url,t.download=e.name??"photo",t.click()},[e.url,e.name]);return n.jsxs(N,{style:t.animatedStyle,className:"relative rounded-lg overflow-hidden max-w-sm",onMouseEnter:t.handleEnter,onMouseLeave:t.handleLeave,children:[n.jsx(bt,{src:e.url,...e.thumbnail?{lqip:e.thumbnail}:{},alt:e.name??"Photo attachment",className:"w-full h-auto",onLoad:()=>{}}),n.jsx(P,{size:"icon",variant:"ghost",className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70",onClick:s,"aria-label":"Download photo",children:n.jsx(g,{size:16,weight:"bold"})})]})}function kt({attachment:e}){const t=X({scale:1.02});return n.jsx(N,{style:t.animatedStyle,className:"relative rounded-lg overflow-hidden max-w-sm",onMouseEnter:t.handleEnter,onMouseLeave:t.handleLeave,children:n.jsx("video",{src:e.url,controls:!0,className:"w-full h-auto",poster:e.thumbnail,"aria-label":e.name??"Video attachment"})})}function Nt({attachment:e}){const t=X({scale:1.02}),s=a.useCallback((e=0)=>e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`,[]),r=a.useCallback(()=>{const t=document.createElement("a");t.href=e.url,t.download=e.name??"document",t.click()},[e.url,e.name]);return n.jsxs(N,{style:t.animatedStyle,className:"flex items-center gap-3 p-3 glass-effect rounded-lg",onMouseEnter:t.handleEnter,onMouseLeave:t.handleLeave,children:[n.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center",children:n.jsx("span",{className:"text-xs font-bold",children:"DOC"})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:e.name??"Document"}),n.jsx("p",{className:"text-xs text-muted-foreground",children:s(e.size??0)})]}),n.jsx(P,{size:"icon",variant:"ghost",onClick:r,"aria-label":`Download ${e.name??"document"}`,children:n.jsx(g,{size:16,weight:"bold"})})]})}function Mt({src:e,alt:t,fallback:s,status:r="online",size:i=40,className:o}){x();const l=Te(),c=b(0),d=ze(3600,l);a.useMemo(()=>{c.value=0,l||"offline"===r||(c.value=C(j(360)))},[l,r,d,c]);const u=k(()=>({transform:[{rotate:`${c.value}deg`}],opacity:"offline"===r?0:1})),m="online"===r?"from-emerald-400 via-cyan-400 to-blue-500":"away"===r?"from-amber-400 via-orange-400 to-rose-400":"from-rose-500 via-fuchsia-500 to-indigo-500";return n.jsxs("div",{className:`relative inline-block ${o??""}`,style:{width:i,height:i},children:[n.jsxs(O,{className:"w-full h-full",children:[n.jsx(U,{src:e,alt:t}),n.jsx(Y,{className:"bg-linear-to-br from-secondary to-primary text-white text-xs font-bold",children:((null==s?void 0:s[0])??"?").toUpperCase()})]}),"offline"!==r&&n.jsx(N,{style:u,className:`pointer-events-none absolute -inset-0.5 rounded-full bg-[conic-gradient(var(--tw-gradient-stops))] ${m} blur-[2px] opacity-80`,children:n.jsx("div",{})})]})}const Ct=!0,Et=200,_t=40,Pt="#3B82F6";function $t({waveform:e=[],duration:t=0,currentTime:s=0,isPlaying:r=!1,width:i=200,height:o=40,color:l="#3B82F6",className:c}){x();const{playheadProgress:d,animatedStyle:u,canvasRef:m,drawWaveform:f}=function(e={}){const{enabled:t=Ct,waveform:n=[],duration:s=0,currentTime:r=0,isPlaying:i=!1,width:o=Et,height:l=_t,color:c=Pt}=e,d=Le(),{hz:u}=dt(),{visual:m,animation:f}=x(),h=b(0),g=b(1),p=a.useRef(null);a.useEffect(()=>{if(t&&s>0){const e=r/s;d.value?h.value=e:(f.enableReanimated&&f.springPhysics?(f.springPhysics.stiffness,f.springPhysics.damping,f.springPhysics.mass):ct(u),h.value=w(e))}},[t,r,s,d,u,f,h]);const v=()=>{const e=p.current;if(!e||!t||0===n.length)return;const a=e.getContext("2d");if(!a)return;e.width=o,e.height=l,a.clearRect(0,0,o,l);const s=o/n.length,r=l/2;n.forEach((e,t)=>{const n=e/100*l*.8,i=t*s,o=r-n/2,d=a.createLinearGradient(i,0,i+s,l);m.enableGlow?(d.addColorStop(0,`${c}40`),d.addColorStop(.5,c),d.addColorStop(1,`${c}40`)):(d.addColorStop(0,c),d.addColorStop(1,c)),a.fillStyle=d,a.fillRect(i,o,.8*s,n),m.enableGlow&&(a.shadowBlur=4,a.shadowColor=c,a.fillRect(i,o,.8*s,n),a.shadowBlur=0)})};a.useEffect(()=>{v()},[n,o,l,c,t,m]);const y=k(()=>({opacity:g.value}));return{playheadProgress:h,waveformOpacity:g,animatedStyle:y,canvasRef:p,drawWaveform:v}}({enabled:!0,waveform:e,duration:t,currentTime:s,isPlaying:r,width:i,height:o,color:l});a.useEffect(()=>{f()},[f]);const h=k(()=>({position:"absolute",left:100*d.value+"%",top:0,bottom:0,width:2,backgroundColor:l,opacity:.8}));return n.jsxs(N,{style:u,className:`relative ${c??""}`,children:[n.jsx("canvas",{ref:m,width:i,height:o,className:"w-full h-full"}),r&&n.jsx(N,{style:h,children:n.jsx("div",{})})]})}const At=[{id:"greet-1",text:"Hey! Your pet looks adorable!",category:"greeting"},{id:"greet-2",text:"Hi there! Would love to set up a playdate!",category:"greeting"},{id:"playdate-1",text:"Want to meet up at the park this weekend?",category:"playdate"},{id:"playdate-2",text:"Are you free for a playdate?",category:"playdate"},{id:"followup-1",text:"Thanks for the great time!",category:"followup"},{id:"closing-1",text:"Talk to you soon!",category:"closing"}],It=["‚ù§Ô∏è","üòÇ","üëç","üëé","üî•","üôè","‚≠ê"],Dt=M("fixed-references");function Rt(e){return`message-${e}`}function Tt(e){const t="string"==typeof e?new Date(e):e;if(Number.isNaN(t.getTime()))return Dt.warn("Invalid timestamp",new Error("Invalid date"),{timestamp:e}),"Invalid date";return t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function Lt(e,t,a,n){const s=Rt(e),r=function(e){const t="string"==typeof e?new Date(e):e;if(Number.isNaN(t.getTime()))return Dt.warn("Invalid timestamp",new Error("Invalid date"),{timestamp:e}),"Invalid date";const a=(new Date).getTime()-t.getTime(),n=Math.floor(a/6e4),s=Math.floor(a/36e5),r=Math.floor(a/864e5);return n<1?"Just now":n<60?`${n} minute${n>1?"s":""} ago`:s<24?`${s} hour${s>1?"s":""} ago`:r<7?`${r} day${r>1?"s":""} ago`:Tt(t)}(t);return{stableId:s,stableTimestamp:r,ariaLabel:`Message from ${a}, ${r}`,ariaDescription:n?`Message content: ${n.substring(0,100)}${n.length>100?"...":""}`:void 0}}const zt=new Map;function Bt(e,t,a,n,s=!1){const r=`${e}-${"string"==typeof t?t:t.getTime()}-${a}`;if(zt.has(r))return zt.get(r);const i=s?Lt(e,t,a,n):function(e,t,a,n){const s=Rt(e),r=Tt(t);return{stableId:s,stableTimestamp:r,ariaLabel:`Message from ${a} at ${r}`,ariaDescription:n?`Message content: ${n.substring(0,100)}${n.length>100?"...":""}`:void 0}}(e,t,a,n);return zt.set(r,i),i}function Ft({message:e,isCurrentUser:t,currentUserId:s,currentUserName:r,delay:i,onReaction:o,onTranslate:l}){var c,d,u,m,f,h,g,y,w;const S=a.useRef(null),M=ke({scale:1.02}),C=function(e={}){const{enabled:t=mt,onComplete:n,onStatusChange:s}=e,r=Le(),{scaleDuration:i}=dt(),{visual:o,animation:l,feedback:c}=x(),d=b(0),u=b(1),m=b(0),f=b(0),h=a.useRef(null),g=a.useRef(!1),p=a.useCallback(()=>{if(!t||g.current)return;g.current=!0;const e=r.value,a=ze(i(220),e),s=st("send-warp",{reducedMotion:e});if(h.current=s,c.haptics&&qe("selection"),d.value=j(100,{easing:e?z.linear:ut}),u.value=j(0,{easing:e?z.linear:ut}),!e&&o.enableGlow){const e=i(140),t=i(160);m.value=j(1,{easing:z.out(z.ease)},()=>{m.value=j(0,{duration:e,easing:z.in(z.ease)})}),l.showParticles&&(f.value=j(.9,{easing:z.out(z.ease)},()=>{f.value=j(0,{duration:t,easing:z.in(z.ease)})}))}n&&setTimeout(()=>{n()},a),setTimeout(()=>{h.current&&(rt(h.current,{durationMs:a,success:!0}),h.current=null)},a)},[t,r,i,o,l,c,d,u,m,f,n]),v=a.useCallback(e=>{c.haptics&&qe("light"),null==s||s(e)},[c.haptics,s]),y=k(()=>({transform:[{translateX:d.value}],opacity:u.value}));return a.useEffect(()=>{t||(g.current=!1)},[t]),{translateX:d,opacity:u,glowOpacity:m,bloomIntensity:f,animatedStyle:y,trigger:p,triggerStatusChange:v}}({enabled:t&&"sent"===e.status}),E=gt({enabled:!t,isNew:i<100,isMention:((null==(c=e.content)?void 0:c.includes(`@${r}`))??!1)||((null==(d=e.content)?void 0:d.includes(`@${s}`))??!1)}),_=Ne({initialY:20,initialScale:.95,delay:i}),$=a.useMemo(()=>Bt(e.id,e.timestamp||e.createdAt,e.senderName||r||"Unknown",e.content,!0),[e.id,e.timestamp,e.createdAt,e.senderName,r,e.content]);a.useEffect(()=>{if(S.current){const e=S.current.querySelector('[class*="rounded-2xl"]');e&&(e.setAttribute("id",$.stableId),e.setAttribute("tabIndex","0"),e.setAttribute("role","article"),e.setAttribute("aria-label",$.ariaLabel),$.ariaDescription&&e.setAttribute("aria-describedby",`${$.stableId}-description`),V(e))}},[$]),a.useEffect(()=>{t&&"sent"===e.status&&C.trigger()},[t,e.status,C]);const A=k(()=>({..._.animatedStyle,...t?C.animatedStyle:E.animatedStyle}));return n.jsxs(N,{style:A,className:"flex items-end gap-2 "+(t?"flex-row-reverse":"flex-row"),children:[!t&&e.senderAvatar&&n.jsx(Mt,{src:e.senderAvatar,...e.senderName?{alt:e.senderName}:{},fallback:e.senderName??"?",status:"online",size:32,className:"shrink-0"}),n.jsxs("div",{ref:S,className:"flex flex-col max-w-[75%] "+(t?"items-end":"items-start"),children:[n.jsx(Ee,{isIncoming:!t,index:i/50,glowOpacity:t?C.glowOpacity.value:0,glowIntensity:t?C.bloomIntensity.value:0,className:"relative",children:n.jsxs(N,{style:M.animatedStyle,onMouseEnter:M.handleMouseEnter,onMouseLeave:M.handleMouseLeave,className:`relative group ${"sticker"===e.type?"p-0":"p-3"} rounded-2xl shadow-lg focus-ring ${t?"bg-linear-to-br from-primary to-accent text-white":"glass-strong backdrop-blur-xl border border-white/20"}`,children:[$.ariaDescription&&n.jsx("div",{id:`${$.stableId}-description`,className:"sr-only",children:$.ariaDescription}),"text"===e.type&&n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"text-sm wrap-break-word",children:e.content}),(null==(m=null==(u=e.metadata)?void 0:u.translation)?void 0:m.translatedText)&&n.jsxs("div",{className:"mt-2 pt-2 border-t border-white/20 text-xs opacity-80",children:[n.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[n.jsx(p,{size:12}),n.jsx("span",{children:"Translation:"})]}),n.jsx("p",{children:e.metadata.translation.translatedText})]})]}),"sticker"===e.type&&n.jsx("div",{className:"text-5xl p-2",children:e.content}),"voice"===e.type&&e.attachments&&n.jsxs("div",{className:"space-y-2",children:[(null==(h=null==(f=e.metadata)?void 0:f.voiceNote)?void 0:h.waveform)&&n.jsx($t,{waveform:e.metadata.voiceNote.waveform,duration:(null==(g=e.attachments[0])?void 0:g.duration)??0,currentTime:0,isPlaying:!1,width:200,height:40,color:t?"#ffffff":"#3B82F6"}),n.jsx(wt,{attachments:e.attachments})]}),"location"===e.type&&(null==(y=e.metadata)?void 0:y.location)&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(v,{size:20,weight:"fill"}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium",children:"Shared Location"}),n.jsx("p",{className:"text-xs opacity-80",children:e.metadata.location.address})]})]}),"pet-card"===e.type&&(null==(w=e.metadata)?void 0:w.petCard)&&n.jsxs("div",{className:"flex items-center gap-3 p-2 bg-white/10 rounded-lg",children:[n.jsx("img",{src:e.metadata.petCard.petPhoto,alt:e.metadata.petCard.petName,className:"w-12 h-12 rounded-full object-cover"}),n.jsx("div",{children:n.jsx("p",{className:"font-semibold text-sm",children:e.metadata.petCard.petName})})]}),n.jsx(pt,{reactions:Array.isArray(e.reactions)?e.reactions:[],availableReactions:It,onReact:t=>{o(e.id,t)},currentUserId:s}),!t&&"text"===e.type&&n.jsx(P,{size:"sm",variant:"ghost",className:"absolute -bottom-2 -right-2 opacity-0 group-hover:opacity-100 transition-opacity text-xs",onClick:()=>{l(e.id)},children:n.jsx(p,{size:14})})]})}),n.jsxs("span",{className:"text-xs text-muted-foreground mt-1 px-1 flex items-center gap-2",children:[le(e.timestamp),t&&n.jsx(q,{variant:"secondary",className:"text-[10px] px-1 py-0",children:e.status})]})]})]})}function Ot({index:e}){x();const t=b(.3),s=b(0);a.useEffect(()=>{const a=200*e;t.value=I(a,C(E(j(1),j(.3)))),s.value=I(a,C(E(j(-3),j(0))))},[e,t,s]);const r=k(()=>({opacity:t.value,transform:[{translateY:s.value}]}));return n.jsx(N,{style:r,className:"w-1 h-1 bg-primary rounded-full"})}function Ut({users:e}){if(0===e.length)return null;const t=a.useMemo(()=>e.slice(0,3),[e]),s=b(0),r=b(-5);a.useEffect(()=>{s.value=j(1),r.value=j(0)},[s,r]);const i=k(()=>({opacity:s.value,transform:[{translateY:r.value}]})),o=a.useMemo(()=>{var t,a,n,s,r,i,o,l;if(1===e.length){return`${(null==(a=null==(t=e[0])?void 0:t.userName)?void 0:a.trim())||"Someone"} is typing`}if(2===e.length){return`${(null==(s=null==(n=e[0])?void 0:n.userName)?void 0:s.trim())||"Someone"} and ${(null==(i=null==(r=e[1])?void 0:r.userName)?void 0:i.trim())||"Someone"} are typing`}return`${(null==(l=null==(o=e[0])?void 0:o.userName)?void 0:l.trim())||"Someone"} and ${e.length-1} others are typing`},[e]);return n.jsxs(N,{style:i,className:"flex items-center gap-2",role:"status","aria-live":"polite",children:[n.jsx("div",{className:"flex -space-x-2",children:t.map(e=>{var t;return n.jsxs(O,{className:"w-4 h-4 ring-1 ring-background",children:[n.jsx(U,{src:e.userAvatar,alt:e.userName}),n.jsx(Y,{className:"text-[8px]",children:(null==(t=e.userName)?void 0:t[0])??"?"})]},e.userId)})}),n.jsxs("div",{className:"flex items-center gap-1 text-xs text-primary",children:[n.jsx("span",{children:o}),n.jsx("div",{className:"flex gap-0.5","aria-hidden":"true",children:[0,1,2].map(e=>n.jsx(Ot,{index:e},e))})]})]})}function Yt({messages:e,currentUserId:t,currentUserName:s,typingUsers:r,onReaction:i,onTranslate:o,className:l}){const c=Ie("chat.virtualization"),d=a.useRef(null),u=a.useRef(new Map),m=a.useMemo(()=>de(e||[]),[e]),f=a.useMemo(()=>{const e=[];for(const t of m){e.push({type:"header",key:`h:${t.date}`,date:t.date});for(const a of t.messages)e.push({type:"msg",key:a.id,msg:a})}return r.length>0&&e.push({type:"typing",key:"typing"}),e},[m,r]),h=a.useCallback(e=>{const t=u.current.get(e);if(null!=t)return t;const a=f[e];if(!a)return 84;if("header"===a.type)return 36;if("typing"===a.type)return 60;if(a.msg){const t=84;let n=0;if(a.msg.content&&a.msg.content.length>100&&(n+=Math.min(20*Math.floor(a.msg.content.length/100),200)),a.msg.attachments&&a.msg.attachments.length>0&&(n+=60*a.msg.attachments.length),a.msg.reactions){(Array.isArray(a.msg.reactions)?a.msg.reactions.length:Object.values(a.msg.reactions).flat().length)>0&&(n+=30)}const s=Math.min(t+n,400);return u.current.set(e,s),s}return 84},[f]),g=y({count:f.length,getScrollElement:()=>d.current,estimateSize:h,overscan:c?12:0,measureElement:"undefined"!=typeof window&&"ResizeObserver"in window?(e,t,a)=>{if(!e)return 84;const n=parseInt(e.getAttribute("data-index")??"-1",10);if(n>=0){const t=e.getBoundingClientRect().height;return u.current.set(n,t),t}return 84}:void 0});a.useEffect(()=>{u.current.clear(),g.measure()},[e.length,g]);const p=Ne({initialScale:.8,delay:0});return!c||f.length<50?n.jsxs("div",{ref:d,className:`flex-1 overflow-y-auto p-4 ${l??""}`,children:[m.map(e=>n.jsxs(a.Fragment,{children:[n.jsx(N,{style:p.animatedStyle,className:"flex justify-center py-2",children:n.jsx("div",{className:"glass-effect px-4 py-1.5 rounded-full text-xs font-medium text-muted-foreground shadow-sm",children:e.date})}),e.messages.map(e=>n.jsx(Ft,{message:e,isCurrentUser:e.senderId===t,currentUserId:t,currentUserName:s,delay:0,onReaction:i,onTranslate:o},e.id))]},e.date)),r.length>0&&n.jsx(te,{children:n.jsx(Ut,{users:r},"typing")})]}):n.jsx("div",{ref:d,className:`flex-1 overflow-y-auto p-4 ${l??""}`,role:"log","aria-label":"Chat messages","aria-live":"polite","aria-atomic":"false",children:n.jsx("div",{style:{height:g.getTotalSize(),position:"relative"},children:g.getVirtualItems().map(e=>{const a=f[e.index];return a?n.jsx("div",{"data-index":e.index,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`},children:"header"===a.type?n.jsx(N,{style:p.animatedStyle,className:"flex justify-center py-2",children:n.jsx("div",{className:"glass-effect px-4 py-1.5 rounded-full text-xs font-medium text-muted-foreground shadow-sm",children:a.date})}):"typing"===a.type?n.jsx(te,{children:n.jsx(Ut,{users:r},"typing")}):"msg"===a.type&&a.msg?n.jsx(Ft,{message:a.msg,isCurrentUser:a.msg.senderId===t,currentUserId:t,currentUserName:s,delay:0,onReaction:i,onTranslate:o}):null},a.key):null})})})}function Ht({lastText:e,senderName:t}){x();const s=a.useRef(null);return a.useEffect(()=>{if(e&&s.current){const a=t?`${t}: ${e}`:`New message: ${e}`;s.current.textContent=a}else s.current&&(s.current.textContent="")},[e,t]),n.jsx("div",{ref:s,"aria-live":"assertive","aria-atomic":"true",className:"sr-only",role:"status","aria-label":"New message announcement"})}function Xt({userName:e,multipleUsers:t=!1}){const s=a.useRef(null);return a.useEffect(()=>{if(e&&s.current){const a=t?"Multiple people are typing...":`${e} is typing...`;s.current.textContent=a}else s.current&&(s.current.textContent="")},[e,t]),n.jsx("div",{ref:s,"aria-live":"polite","aria-atomic":"true",className:"sr-only",role:"status","aria-label":"Typing indicator announcement"})}function Vt({inputRef:e,label:t="Skip to message input"}){const s=a.useCallback(t=>{var a;t.preventDefault(),null==(a=e.current)||a.focus()},[e]),r=a.useCallback(t=>{var a;"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),null==(a=e.current)||a.focus())},[e]);return n.jsx("a",{href:"#chat-input",onClick:s,onKeyDown:r,className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-foreground focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2","aria-label":t,children:t})}const qt=M("ChatErrorBoundary");class Gt extends a.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var a,n;qt.error("Chat error boundary caught error",e,{componentStack:t.componentStack}),null==(n=(a=this.props).onError)||n.call(a,e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:n.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Something went wrong. UI recovered."}):this.props.children}}export{te as A,me as C,At as M,_e as P,It as R,Vt as S,Yt as V,Ee as W,ce as a,ie as b,Ht as c,Xt as d,Pe as e,oe as f,de as g,$e as h,le as i,fe as j,ue as k,Gt as l,ne as m,K as n,Q as o,Ke as p,Je as q,re as r,se as s,Ie as u};
