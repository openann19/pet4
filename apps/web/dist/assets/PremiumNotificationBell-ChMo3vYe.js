import{r as e,j as s,at as t,cI as a,av as r,cJ as i,cK as n,cL as l,cM as o,cf as c,cB as d,cN as u,cO as m,aF as h,cP as f,cd as x,cQ as p,a1 as v,c4 as g,U as j,bB as y,ah as N,a3 as b,a7 as w,cH as k}from"./react-vendor-atdIga2R.js";import{f as C,h as A,N as M,b as S,Q as E,O as z,U as R,A as D,c as $,d as I,$ as P,V as F,W as L,B as V,ad as U,ae as O,af as q,L as G,aA as H,ag as T,F as Y,E as B,Y as J,Z as W}from"./feature-admin-g8AIjMAb.js";import{j as Q,l as K,m as Z,n as X,D as _,a as ee,b as se,q as te,c as ae,r as re}from"./feature-community-DxZ7YsOF.js";import{g as ie,j as ne,k as le,l as oe}from"./utils-vendor-7mYxNw04.js";import{V as ce}from"./view-CommunityView.tsx-CD5NUxZ2.js";import"./vendor-B2U5onNE.js";import"./ui-vendor-CttiZxwU.js";import"./feature-adoption-C919WvgL.js";import"./view-AdoptionView.tsx-BJlxubb2.js";function de(s,t){const[a,r]=e.useState(()=>{if("undefined"==typeof window)return t;try{const e=window.localStorage.getItem(s);return e?JSON.parse(e):t}catch{return t}}),i=e.useCallback(e=>{try{const t=e instanceof Function?e(a):e;r(t),"undefined"!=typeof window&&window.localStorage.setItem(s,JSON.stringify(t))}catch{}},[s,a]);return e.useEffect(()=>{if("undefined"==typeof window)return;const e=e=>{if(e.key===s&&null!==e.newValue)try{r(JSON.parse(e.newValue))}catch{}};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[s]),[a,i]}C("useNotifications");const ue=C("useNotificationActions");function me(s){const[t,a]=e.useState("all"),[r,i]=e.useState("all"),[n,l]=e.useState("grouped");return{filter:t,selectedCategory:r,view:n,categories:e.useMemo(()=>{const e=new Map;s.forEach(s=>{if(!s.archived){const t=e.get(s.type)||0;e.set(s.type,t+1)}});const t={all:"All",match:"Matches",message:"Messages",like:"Likes",verification:"Verification",story:"Stories",system:"System",moderation:"Moderation",achievement:"Achievements",social:"Social",event:"Events"},a=Array.from(e.entries()).map(([e,s])=>({value:e,label:t[e]||e,count:s}));return[{value:"all",label:"All",count:s.filter(e=>!e.archived).length},...a.sort((e,s)=>s.count-e.count)]},[s]),setFilter:a,setSelectedCategory:i,setView:l}}const he=e.memo(function({notification:i,onMarkAsRead:n,onArchive:l,onDelete:o,getIcon:c}){const d=M(0),u=M(20),m=S({hoverScale:1.005,tapScale:1});e.useEffect(()=>{d.value=E(1),u.value=z(0)},[d,u]);const h=R(()=>({opacity:d.value,transform:[{translateY:u.value},{scale:m.scale.value}]})),f=M(i.read?0:1);e.useEffect(()=>{f.value=z(i.read?0:1)},[i.read,f]);const x=R(()=>({transform:[{scale:f.value}]}));return s.jsx(D,{style:h,onMouseEnter:m.handleMouseEnter,onMouseLeave:m.handleMouseLeave,className:$("relative rounded-xl overflow-hidden transition-all bg-card border border-border/50 p-4",!i.read&&"ring-2 ring-primary/20"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsxs("div",{className:"shrink-0 w-12 h-12 rounded-xl flex items-center justify-center bg-primary/10 relative",children:[c(i.type,i.priority),!i.read&&s.jsx(D,{style:x,className:"absolute -top-1 -right-1 w-3 h-3 rounded-full bg-primary",children:null})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-semibold text-sm leading-tight",children:i.title}),s.jsx("p",{className:"text-sm mt-1 text-muted-foreground leading-relaxed",children:i.message})]}),!i.read&&s.jsx(D,{style:x,className:"shrink-0 w-2 h-2 rounded-full bg-primary mt-1",children:null})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3 gap-2",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:ie(i.timestamp,{addSuffix:!0})}),s.jsxs("div",{className:"flex items-center gap-1",children:[!i.read&&s.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>n(i.id),children:s.jsx(t,{size:16})}),s.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>l(i.id),children:s.jsx(a,{size:16})}),s.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full text-destructive",onClick:()=>o(i.id),children:s.jsx(r,{size:16})})]})]})]})]})})},(e,s)=>e.notification.id===s.notification.id&&e.notification.read===s.notification.read&&e.notification.timestamp===s.notification.timestamp&&e.notification.title===s.notification.title&&e.notification.message===s.notification.message&&e.onMarkAsRead===s.onMarkAsRead&&e.onArchive===s.onArchive&&e.onDelete===s.onDelete&&e.getIcon===s.getIcon);function fe({filter:t}){const a=M(0),r=M(.9),n=M(0),l=M(1);e.useEffect(()=>{a.value=E(1),r.value=z(1),n.value=P(2e3,F(L(E(-10),E(10),E(0)))),l.value=P(2e3,F(L(z(1.1),z(1))))},[a,r,n,l]);const o=R(()=>({opacity:a.value,transform:[{scale:r.value}]})),c=R(()=>({transform:[{rotate:`${n.value}deg`},{scale:l.value}]}));return s.jsxs(D,{style:o,className:"flex flex-col items-center justify-center py-12 px-4",children:[s.jsx(D,{style:c,className:"mb-4",children:s.jsx(i,{size:48,className:"text-muted-foreground"})}),s.jsxs("p",{className:"text-muted-foreground mt-4 text-center text-lg font-medium",children:["unread"===t&&"All caught up!","archived"===t&&"No archived notifications","all"===t&&"No notifications yet"]}),s.jsxs("p",{className:"text-sm text-muted-foreground/60 mt-1 text-center max-w-xs",children:["unread"===t&&"You've read all your notifications","archived"===t&&"Archived notifications will appear here","all"===t&&"We'll notify you when something important happens"]})]})}function xe({notifications:t,filter:a,preferences:r,onMarkAsRead:i,onArchive:n,onDelete:l,getIcon:o,getPriorityStyles:c}){const d=e.useMemo(()=>{const e=new Map;return t.forEach(s=>{const t=new Date(s.timestamp);let a;a=ne(t)?"Today":le(t)?"Yesterday":oe(t,new Date)?"This Week":ie(t,{addSuffix:!1}),e.has(a)||e.set(a,[]);const r=e.get(a);r&&r.push(s)}),Array.from(e.entries())},[t]),u=e.useMemo(()=>{if(t.length<=20)return null;const e=[];return d.forEach(([s,t])=>{e.push({type:"header",key:`header-${s}`,data:s}),t.forEach(s=>{e.push({type:"notification",key:s.id,data:s})})}),e},[d,t.length]),m=e.useCallback(e=>{if("header"===e.type)return s.jsx("div",{className:"px-2 py-2",children:s.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:e.data})});const t=e.data;return s.jsx("div",{className:"px-2",children:s.jsx(he,{notification:t,onMarkAsRead:i,onArchive:n,onDelete:l,getIcon:o,getPriorityStyles:c,preferences:r})})},[i,n,l,o,c,r]),h=e.useCallback(e=>{if(!u)return 80;const s=u[e];return"header"===(null==s?void 0:s.type)?40:80},[u]),f=e.useCallback(e=>e.key,[]);return 0===t.length?s.jsx(fe,{filter:a}):u&&u.length>20?s.jsx(ce,{items:u,renderItem:m,estimateSize:h,overscan:5,keyExtractor:f,containerClassName:"h-full"}):s.jsx("div",{className:"space-y-6",children:d.map(([e,t])=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider px-2",children:e}),s.jsx("div",{className:"space-y-1",children:t.map(e=>s.jsx(he,{notification:e,onMarkAsRead:i,onArchive:n,onDelete:l,getIcon:o,getPriorityStyles:c,preferences:r},e.id))})]},e))})}function pe({...e}){return s.jsx(n,{"data-slot":"collapsible",...e})}function ve({...e}){return s.jsx(l,{"data-slot":"collapsible-trigger",...e})}function ge({...e}){return s.jsx(o,{"data-slot":"collapsible-content",...e})}function je({group:r,index:i,onMarkAsRead:n,onArchive:l,onDelete:o,getIcon:c,getPriorityStyles:d,preferences:u}){const[m,h]=e.useState(!1),f=r.notifications[0];if(!f)return null;const x=M(0),p=M(20),v=S({hoverScale:1.005,tapScale:1}),g=S({hoverScale:1.05,tapScale:1});e.useEffect(()=>{x.value=E(1),p.value=z(0)},[x,p]);const j=R(()=>({opacity:x.value,transform:[{translateY:p.value},{scale:v.scale.value}]})),y=R(()=>({transform:[{scale:g.scale.value}]})),N=M(r.read?0:1);e.useEffect(()=>{N.value=z(r.read?0:1)},[r.read,N]);const b=R(()=>({transform:[{scale:N.value}]}));return s.jsx(pe,{open:m,onOpenChange:h,children:s.jsxs(D,{style:j,onMouseEnter:v.handleMouseEnter,onMouseLeave:v.handleMouseLeave,className:$("relative rounded-xl overflow-hidden transition-all bg-card border border-border/50",!r.read&&"ring-2 ring-primary/20"),children:[s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsxs(D,{style:y,onMouseEnter:g.handleMouseEnter,onMouseLeave:g.handleMouseLeave,className:"shrink-0 w-12 h-12 rounded-xl flex items-center justify-center bg-primary/10 relative",children:[c(r.type,f.priority),r.notifications.length>1&&s.jsx(V,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 min-w-[20px] px-1 rounded-full text-xs font-bold",children:r.notifications.length})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-semibold text-sm leading-tight",children:r.title}),s.jsx("p",{className:"text-sm mt-1 text-muted-foreground leading-relaxed",children:r.summary})]}),!r.read&&s.jsx(D,{style:b,className:"shrink-0 w-2 h-2 rounded-full bg-primary mt-1",children:null})]}),s.jsxs("div",{className:"flex items-center justify-between mt-3 gap-2",children:[s.jsx("span",{className:"text-xs text-muted-foreground",children:ie(r.timestamp,{addSuffix:!0})}),s.jsxs("div",{className:"flex items-center gap-1",children:[!r.read&&s.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>n(r.id),children:s.jsx(t,{size:16})}),s.jsx(I,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:()=>l(r.id),children:s.jsx(a,{size:16})})]})]})]})]}),r.notifications.length>1&&s.jsx(ve,{asChild:!0,children:s.jsx(I,{variant:"ghost",size:"sm",className:"w-full mt-2 text-xs",children:m?"Show less":`Show ${r.notifications.length-1} more`})})]}),r.notifications.length>1&&s.jsx(ge,{children:s.jsx("div",{className:"border-t border-border/50 px-4 py-2 space-y-2",children:r.notifications.slice(1).map(e=>s.jsx("div",{className:"text-sm text-muted-foreground",children:e.message},e.id))})})]})})}function ye({groups:t,filter:a,preferences:r,onMarkAsRead:i,onArchive:n,onDelete:l,getIcon:o,getPriorityStyles:c}){const d=e.useMemo(()=>{const e=new Map;return t.forEach(s=>{const t=new Date(s.timestamp);let a;a=ne(t)?"Today":le(t)?"Yesterday":oe(t,new Date)?"This Week":ie(t,{addSuffix:!1}),e.has(a)||e.set(a,[]);const r=e.get(a);r&&r.push(s)}),Array.from(e.entries())},[t]);return 0===t.length?s.jsx(fe,{filter:a}):s.jsx("div",{className:"space-y-6",children:d.map(([e,t])=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider px-2",children:e}),s.jsx("div",{className:"space-y-2",children:t.map((e,t)=>s.jsx(je,{group:e,index:t,onMarkAsRead:i,onArchive:n,onDelete:l,getIcon:o,getPriorityStyles:c,preferences:r},e.id))})]},e))})}function Ne({filter:e,view:t,categories:a,selectedCategory:r,unreadCount:i,onFilterChange:n,onViewChange:l,onCategoryChange:o,onShowSettings:m}){return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(U,{value:e,onValueChange:e=>n(e),children:s.jsxs(O,{children:[s.jsxs(q,{value:"all",children:["All",i>0&&s.jsx(V,{variant:"destructive",className:"ml-2 h-5 min-w-[20px] px-1.5 text-xs",children:i})]}),s.jsx(q,{value:"unread",children:"Unread"}),s.jsx(q,{value:"archived",children:"Archived"})]})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(I,{variant:"ghost",size:"icon",onClick:()=>l("grouped"===t?"list":"grouped"),className:$("grouped"===t&&"bg-primary/10"),children:"grouped"===t?s.jsx(c,{size:20}):s.jsx(d,{size:20})}),s.jsx(I,{variant:"ghost",size:"icon",onClick:m,children:s.jsx(u,{size:20})})]})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:a.map(e=>s.jsxs(I,{variant:r===e.value?"default":"outline",size:"sm",onClick:()=>o(e.value),children:[e.label,e.count>0&&s.jsx(V,{variant:"secondary",className:"ml-2 h-5 min-w-[20px] px-1.5 text-xs",children:e.count})]},e.value))})]})}function be({preferences:e,onPreferencesChange:t}){var a;const r=s=>{e&&t({...e,...s})};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(G,{htmlFor:"quiet-hours",className:"text-sm font-medium",children:[s.jsx(m,{size:16,className:"inline mr-2"}),"Quiet hours"]}),s.jsx(H,{id:"quiet-hours",checked:(null==(a=null==e?void 0:e.quietHours)?void 0:a.enabled)??!1,onCheckedChange:s=>{if(!e)return;const t=e.quietHours;r({quietHours:t?{...t,enabled:s}:{enabled:s,start:"22:00",end:"08:00"}})}})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(G,{htmlFor:"group-similar",className:"text-sm font-medium",children:[s.jsx(h,{size:16,className:"inline mr-2"}),"Group similar"]}),s.jsx(H,{id:"group-similar",checked:(null==e?void 0:e.groupSimilar)??!1,onCheckedChange:e=>{r({groupSimilar:e})}})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(G,{htmlFor:"show-previews",className:"text-sm font-medium",children:[s.jsx(i,{size:16,className:"inline mr-2"}),"Show previews"]}),s.jsx(H,{id:"show-previews",checked:(null==e?void 0:e.showPreviews)??!1,onCheckedChange:e=>{r({showPreviews:e})}})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(G,{htmlFor:"sound-enabled",className:"text-sm font-medium",children:[s.jsx(f,{size:16,className:"inline mr-2"}),"Sound enabled"]}),s.jsx(H,{id:"sound-enabled",checked:(null==e?void 0:e.soundEnabled)??!1,onCheckedChange:e=>{r({soundEnabled:e})}})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(G,{htmlFor:"push-enabled",className:"text-sm font-medium",children:[s.jsx(f,{size:16,className:"inline mr-2"}),"Push notifications"]}),s.jsx(H,{id:"push-enabled",checked:(null==e?void 0:e.pushEnabled)??!1,onCheckedChange:e=>{r({pushEnabled:e})}})]})]})}function we(e,t){const a={size:24,weight:"urgent"===t||"critical"===t?"fill":"regular"};switch(e){case"match":return s.jsx(b,{...a,className:"text-primary"});case"message":return s.jsx(w,{...a,className:"text-secondary"});case"like":return s.jsx(b,{...a,className:"text-accent"});case"verification":return s.jsx(N,{...a,className:"text-green-500"});case"story":return s.jsx(y,{...a,className:"text-purple-500"});case"moderation":return s.jsx(j,{...a,className:"text-orange-500"});case"achievement":return s.jsx(g,{...a,className:"text-yellow-500"});case"social":return s.jsx(v,{...a,className:"text-blue-500"});case"event":return s.jsx(p,{...a,className:"text-pink-500"});case"system":return s.jsx(x,{...a,className:"text-blue-500"});default:return s.jsx(i,{...a})}}function ke(e){switch(e){case"critical":return"border-l-4 border-l-destructive bg-linear-to-r from-destructive/10 to-transparent";case"urgent":return"border-l-4 border-l-destructive bg-destructive/5";case"high":return"border-l-4 border-l-accent bg-accent/5";case"normal":return"border-l-2 border-l-primary/30";default:return"border-l border-l-border/50"}}function Ce({isOpen:a,onClose:i}){const[n,l]=de("notification-preferences",{quietHours:{enabled:!1,start:"22:00",end:"08:00"},groupSimilar:!0,showPreviews:!0,soundEnabled:!0,pushEnabled:!0}),[o,c]=e.useState(!1),d=me([]),m=function(s){const{preferences:t,view:a,filter:r,selectedCategory:i}=s,[n,l]=de("premium-notifications",[]),o=e.useMemo(()=>n??[],[n]),c=e.useMemo(()=>o.filter(e=>"archived"===r?e.archived:"unread"===r?!e.read&&!e.archived:!e.archived).filter(e=>"all"===i||e.type===i).sort((e,s)=>s.timestamp-e.timestamp),[o,r,i]),d=e.useMemo(()=>{if(!(null==t?void 0:t.groupSimilar)||"list"===a)return[];const e=new Map;return c.forEach(s=>{var t,a;const r=s.groupId??`${s.type}-${(null==(t=s.metadata)?void 0:t.userName)??(null==(a=s.metadata)?void 0:a.petName)??"solo"}`;e.has(r)||e.set(r,[]),e.get(r).push(s)}),Array.from(e.entries()).map(([e,s])=>{const t=s[0],a=s.every(e=>e.read);return{id:e,type:t.type,notifications:s,title:t.title,summary:s.length>1?`${s.length} notifications`:t.message,timestamp:t.timestamp,read:a}}).sort((e,s)=>s.timestamp-e.timestamp)},[c,t,a]),u=e.useMemo(()=>o.filter(e=>!e.read&&!e.archived).length,[o]),m=e.useCallback(e=>{l(s=>(s??[]).map(s=>s.id===e?{...s,read:!0}:s))},[l]),h=e.useCallback(()=>{l(e=>(e??[]).map(e=>e.archived?e:{...e,read:!0}))},[l]),f=e.useCallback(e=>{l(s=>(s??[]).map(s=>s.id===e?{...s,archived:!0,read:!0}:s))},[l]),x=e.useCallback(e=>{l(s=>(s??[]).map(s=>{var t,a;return(s.groupId??`${s.type}-${(null==(t=s.metadata)?void 0:t.userName)??(null==(a=s.metadata)?void 0:a.petName)??"solo"}`)===e?{...s,archived:!0,read:!0}:s}))},[l]),p=e.useCallback(e=>{l(s=>(s??[]).filter(s=>s.id!==e))},[l]),v=e.useCallback(e=>{l(s=>(s??[]).filter(s=>{var t,a;return(s.groupId??`${s.type}-${(null==(t=s.metadata)?void 0:t.userName)??(null==(a=s.metadata)?void 0:a.petName)??"solo"}`)!==e}))},[l]);return{notifications:o,filteredNotifications:c,groupedNotifications:d,unreadCount:u,markAsRead:m,markAllAsRead:h,archive:f,archiveGroup:x,deleteNotification:p,deleteGroup:v}}({preferences:n,view:d.view,filter:d.filter,selectedCategory:d.selectedCategory}),x=me(m.notifications),p=function(s){const{onMarkAsRead:t,onMarkAllAsRead:a,onArchive:r,onDelete:i,enableHaptics:n=!0}=s,l=e.useCallback(e=>{n&&A.impact("light"),t(e),ue.debug("Notification marked as read",{id:e})},[t,n]),o=e.useCallback(()=>{n&&A.impact("medium"),a(),ue.debug("All notifications marked as read")},[a,n]),c=e.useCallback(e=>{n&&A.impact("light"),r(e),ue.debug("Notification archived",{id:e})},[r,n]),d=e.useCallback(e=>{n&&A.impact("medium"),i(e),ue.debug("Notification deleted",{id:e})},[i,n]),u=e.useCallback(e=>{e.read||l(e.id),e.actionUrl&&(window.location.href=e.actionUrl)},[l]);return{handleMarkAsRead:l,handleMarkAllAsRead:o,handleArchive:c,handleDelete:d,handleNotificationClick:u}}({onMarkAsRead:m.markAsRead,onMarkAllAsRead:m.markAllAsRead,onArchive:m.archive,onDelete:m.deleteNotification,enableHaptics:!0}),v=e.useMemo(()=>m.notifications.filter(e=>e.archived).length,[m.notifications]),g=e.useCallback(()=>{A.impact("heavy"),m.notifications.filter(e=>e.archived).forEach(e=>{m.deleteNotification(e.id)})},[m]),j=M(0),y=M(1);e.useEffect(()=>{a&&m.unreadCount>0&&(j.value=F(L(E(-10),E(10),E(-10),E(0))),y.value=F(L(E(1.1),E(1))))},[a,m.unreadCount,j,y]);const N=R(()=>({transform:[{rotate:`${j.value}deg`},{scale:y.value}]})),b=M(o?1:0),w=M(o?1:0);e.useEffect(()=>{b.value=E(o?1:0),w.value=E(o?1:0)},[o,b,w]);const C=R(()=>({opacity:b.value,height:1===w.value?"auto":"0",overflow:"hidden"}));return s.jsx(Q,{open:a,onOpenChange:i,children:s.jsxs(K,{side:"right",className:"w-full sm:max-w-2xl p-0 overflow-hidden flex flex-col",children:[s.jsxs(Z,{className:"px-6 py-4 border-b border-border/50 bg-linear-to-br from-background via-primary/5 to-accent/5 shrink-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(D,{style:N,children:s.jsx(f,{size:28,weight:"fill",className:"text-primary"})}),s.jsxs("div",{children:[s.jsx(X,{className:"text-xl",children:"Notifications"}),m.unreadCount>0&&s.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[m.unreadCount," unread"," ",v>0&&`Â· ${v} archived`]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(I,{variant:"ghost",size:"icon",className:"rounded-full",onClick:()=>{A.impact("light"),c(!o)},children:s.jsx(u,{size:20})}),s.jsxs(_,{children:[s.jsx(ee,{asChild:!0,children:s.jsx(I,{variant:"ghost",size:"icon",className:"rounded-full",children:s.jsx(k,{size:20})})}),s.jsxs(se,{align:"end",className:"w-56",children:[s.jsx(te,{children:"Actions"}),s.jsxs(ae,{onClick:p.handleMarkAllAsRead,disabled:0===m.unreadCount,children:[s.jsx(t,{size:16,className:"mr-2"}),"Mark all as read"]}),s.jsxs(ae,{onClick:()=>x.setView("grouped"===x.view?"list":"grouped"),children:[s.jsx(h,{size:16,className:"mr-2"}),"grouped"===x.view?"List view":"Grouped view"]}),s.jsx(re,{}),s.jsxs(ae,{onClick:g,disabled:0===v,children:[s.jsx(r,{size:16,className:"mr-2"}),"Delete archived (",v,")"]})]})]})]})]}),o&&s.jsx(D,{style:C,className:"overflow-hidden",children:s.jsx("div",{className:"pt-4 space-y-4 border-t border-border/30 mt-4",children:s.jsx(be,{preferences:n,onPreferencesChange:l})})})]}),s.jsxs(U,{value:x.filter,onValueChange:e=>x.setFilter(e),className:"flex-1 flex flex-col overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-border/50 shrink-0",children:s.jsx(Ne,{filter:x.filter,view:x.view,categories:x.categories,selectedCategory:x.selectedCategory,unreadCount:m.unreadCount,onFilterChange:x.setFilter,onViewChange:x.setView,onCategoryChange:x.setSelectedCategory,onShowSettings:()=>c(!0)})}),s.jsx(T,{value:x.filter,className:"flex-1 overflow-hidden m-0",children:s.jsx(Y,{className:"h-full",children:s.jsx("div",{className:"px-6 py-4",children:"grouped"===x.view&&m.groupedNotifications.length>0?s.jsx(ye,{groups:m.groupedNotifications,filter:x.filter,preferences:n,onMarkAsRead:m.archiveGroup,onArchive:m.archiveGroup,onDelete:m.deleteGroup,getIcon:we,getPriorityStyles:ke}):s.jsx(xe,{notifications:m.filteredNotifications,filter:x.filter,preferences:n,onMarkAsRead:p.handleMarkAsRead,onArchive:p.handleArchive,onDelete:p.handleDelete,getIcon:we,getPriorityStyles:ke})})})})]})]})})}const Ae=C("PremiumNotificationBell");function Me(){const[t,a]=e.useState(!1),[r]=B("premium-notifications",[]),[i,n]=e.useState(!1),[l,o]=B("last-notification-check",Date.now()),c=e.useRef(null),d=e.useMemo(()=>r||[],[r]),u=e.useMemo(()=>d.filter(e=>!e.read&&!e.archived).length,[d]),m=e.useMemo(()=>d.filter(e=>!(e.read||e.archived||"urgent"!==e.priority&&"critical"!==e.priority)).length,[d]),h=e.useMemo(()=>m>0,[m]);e.useEffect(()=>{try{const e=d.filter(e=>e.timestamp>(l||0));if(e.length>0&&!t)return n(!0),A.medium(),Ae.info("New notifications received",{count:e.length,urgentCount:e.filter(e=>"urgent"===e.priority||"critical"===e.priority).length}),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{n(!1)},3e3),()=>{c.current&&(clearTimeout(c.current),c.current=null)}}catch(e){const s=e instanceof Error?e:new Error(String(e));Ae.error("Failed to check for new notifications",s)}},[d.length,l,t,d]);const f=e.useCallback(()=>{try{A.medium(),a(!0),o(Date.now()),n(!1),Ae.info("Notification bell clicked",{unreadCount:u,urgentCount:m})}catch(e){const s=e instanceof Error?e:new Error(String(e));Ae.error("Failed to handle notification bell click",s)}},[o,u,m]),x=e.useCallback(()=>{a(!1)},[]),p=e.useMemo(()=>{const e=["Notifications"];return u>0&&e.push(`${u} unread`),m>0&&e.push(`${m} urgent`),e.join(" - ")},[u,m]);return s.jsxs(s.Fragment,{children:[s.jsxs(I,{variant:"ghost",size:"icon",onClick:f,className:"relative rounded-full w-11 h-11 hover:bg-primary/10 active:bg-primary/20 transition-colors shrink-0 touch-manipulation","aria-label":p,"aria-expanded":t,"aria-haspopup":"dialog",children:[s.jsx(Se,{hasNewNotification:i,unreadCount:u,hasUrgent:h}),u>0&&s.jsx(Ee,{unreadCount:u,hasUrgent:h}),u>0&&s.jsx(ze,{hasUrgent:h}),h&&s.jsx(Re,{})]}),s.jsx(Ce,{isOpen:t,onClose:x})]})}function Se({hasNewNotification:t,unreadCount:a,hasUrgent:r}){const n=M(0),l=M(1),o=M(1);e.useEffect(()=>{t&&a>0?(n.value=L(E(-20),E(20),E(-20),E(20),E(-15),E(15),E(-10),E(10),E(0)),l.value=L(E(1.15),E(1),E(1.15),E(1),E(1.1),E(1),E(1.05),E(1))):(n.value=E(0),l.value=E(1))},[t,a,n,l]);const c=R(()=>({transform:[{rotate:`${n.value}deg`},{scale:l.value}],opacity:o.value})),d=e.useMemo(()=>r?"text-destructive":a>0?"text-primary":"text-foreground/80",[r,a]);return t&&a>0?s.jsx(D,{style:c,children:s.jsx(f,{size:20,weight:"fill",className:d,"aria-hidden":"true"})}):s.jsx(D,{style:c,children:s.jsx(i,{size:20,weight:a>0?"fill":"regular",className:d,"aria-hidden":"true"})})}function Ee({unreadCount:t,hasUrgent:a}){const r=M(0),i=M(0),n=M(1);e.useEffect(()=>{r.value=E(1),i.value=E(1)},[r,i]),e.useEffect(()=>{n.value=a?F(L(E(1.2),E(1))):E(1)},[a,n]);const l=R(()=>({transform:[{scale:r.value}],opacity:i.value})),o=R(()=>({transform:[{scale:n.value}]}));return s.jsx(D,{style:l,className:"absolute -top-1 -right-1",children:s.jsx(D,{style:o,children:s.jsx(V,{variant:a?"destructive":"default",className:"h-5 min-w-[20px] px-1 rounded-full text-xs font-bold flex items-center justify-center shadow-lg","aria-label":`${t} unread notification${1!==t?"s":""}`,children:t>99?"99+":t})})})}function ze({hasUrgent:t}){const a=M(1),r=M(.6);e.useEffect(()=>{a.value=F(L(E(1.4),E(1))),r.value=F(L(E(0),E(.6)))},[t,a,r]);const i=R(()=>({transform:[{scale:a.value}],opacity:r.value}));return s.jsx(D,{style:i,className:$("absolute inset-0 rounded-full border-2 pointer-events-none",t?"border-destructive":"border-primary"),"aria-hidden":"true",children:s.jsx("span",{className:"sr-only",children:"Ripple effect"})})}function Re(){const t=M(0),a=M(0);e.useEffect(()=>{t.value=F(L(E(8),E(0))),a.value=F(L(E(.3),E(0)))},[t,a]);const r=R(()=>({boxShadow:`0 0 ${J(t.value,[0,8],[0,8],W.CLAMP)}px rgba(239, 68, 68, ${J(a.value,[0,.3],[0,.3],W.CLAMP)})`}));return s.jsx(D,{style:r,className:"absolute inset-0 rounded-full pointer-events-none","aria-hidden":"true",children:s.jsx("span",{className:"sr-only",children:"Urgent glow effect"})})}export{Me as PremiumNotificationBell};
