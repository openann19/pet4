import{r as e,j as s,ag as t,a3 as a,aC as i,ac as r,a6 as l,aj as n,bb as o,am as c,aK as d,ak as m}from"./react-vendor-atdIga2R.js";import{C as u,B as x,d as h,D as p,g,i as j,j as f,k as v,L as y,I as N,T as S,au as w,f as b,u as C,E as F,ad as k,ae as A,af as L,F as z,M as D}from"./feature-admin-g8AIjMAb.js";import{P}from"./view-AdoptionView.tsx-BJlxubb2.js";import{A as R}from"./feature-chat-CPR2_-OR.js";import{g as T}from"./utils-vendor-7mYxNw04.js";import{a as E,C as I}from"./view-CommunityView.tsx-CD5NUxZ2.js";import"./vendor-B2U5onNE.js";import"./ui-vendor-CttiZxwU.js";import"./feature-adoption-C919WvgL.js";import"./feature-community-DxZ7YsOF.js";function $({alert:o,onSelect:c,onReportSighting:d,isFavorited:m=!1,onToggleFavorite:p}){const[g,j]=e.useState(!1),f=T(new Date(o.createdAt),{addSuffix:!0}),v=T(new Date(o.lastSeen.whenISO),{addSuffix:!0});return s.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-300",children:s.jsxs(u,{className:"overflow-hidden hover:shadow-lg transition-shadow cursor-pointer",children:[s.jsxs("div",{className:"relative aspect-[4/3] bg-muted",children:[o.photos&&o.photos.length>0&&!g?s.jsx("img",{src:o.photos[0],alt:o.petSummary.name,className:"w-full h-full object-cover",onError:()=>j(!0)}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx("div",{className:"text-6xl",children:"ðŸ¾"})}),s.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:["active"===o.status&&s.jsxs(x,{variant:"destructive",className:"gap-1",children:[s.jsx(t,{size:12,weight:"fill"}),"Lost"]}),"found"===o.status&&s.jsx(x,{variant:"default",className:"gap-1 bg-green-600",children:"Found"}),p&&s.jsx(h,{size:"icon",variant:"ghost",className:"h-8 w-8 bg-background/80 backdrop-blur-sm",onClick:e=>{e.stopPropagation(),p(o.id)},children:s.jsx(a,{size:16,weight:m?"fill":"regular",className:m?"text-red-500":""})})]}),o.reward&&s.jsx("div",{className:"absolute bottom-2 left-2",children:s.jsxs(x,{variant:"secondary",className:"gap-1 bg-yellow-500/90 text-yellow-950",children:[s.jsx(i,{size:12,weight:"fill"}),"Reward: $",o.reward]})})]}),s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg mb-1",children:o.petSummary.name}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx("span",{className:"capitalize",children:o.petSummary.species}),o.petSummary.breed&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"â€¢"}),s.jsx("span",{children:o.petSummary.breed})]}),o.petSummary.size&&s.jsxs(s.Fragment,{children:[s.jsx("span",{children:"â€¢"}),s.jsx("span",{className:"capitalize",children:o.petSummary.size})]})]})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex items-start gap-2 text-muted-foreground",children:[s.jsx(r,{size:16,className:"mt-0.5 shrink-0"}),s.jsxs("div",{children:[s.jsxs("p",{children:["Last seen ",v]}),o.lastSeen.description&&s.jsx("p",{className:"text-xs mt-0.5",children:o.lastSeen.description}),o.lastSeen.lat&&o.lastSeen.lon&&s.jsxs("p",{className:"text-xs mt-0.5",children:[o.lastSeen.lat.toFixed(4),", ",o.lastSeen.lon.toFixed(4)]})]})]}),s.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(l,{size:14}),s.jsxs("span",{children:[o.viewsCount," views"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(n,{size:14}),s.jsx("span",{children:f})]}),o.sightingsCount>0&&s.jsxs(x,{variant:"outline",className:"text-xs",children:[o.sightingsCount," sighting",1!==o.sightingsCount?"s":""]})]})]}),o.petSummary.distinctiveFeatures&&o.petSummary.distinctiveFeatures.length>0&&s.jsxs("div",{className:"flex flex-wrap gap-1",children:[o.petSummary.distinctiveFeatures.slice(0,3).map((e,t)=>s.jsx(x,{variant:"outline",className:"text-xs",children:e},t)),o.petSummary.distinctiveFeatures.length>3&&s.jsxs(x,{variant:"outline",className:"text-xs",children:["+",o.petSummary.distinctiveFeatures.length-3," more"]})]}),s.jsxs("div",{className:"flex gap-2 pt-2",children:[s.jsx(h,{variant:"outline",className:"flex-1",onClick:e=>{e.stopPropagation(),c(o)},children:"View Details"}),d&&"active"===o.status&&s.jsx(h,{variant:"default",className:"flex-1",onClick:e=>{e.stopPropagation(),d(o)},children:"Report Sighting"})]})]})]})})}function M({open:a,alert:i,onClose:l,onSuccess:d}){const[m,u]=e.useState(!1),[x,C]=e.useState(!1),[F,k]=e.useState(""),[A,L]=e.useState(""),[z,D]=e.useState(""),[P,R]=e.useState(null),[T,I]=e.useState(500),[$,M]=e.useState(""),[U,O]=e.useState([]),V=e=>{if(e.includes("@")){const[s,t]=e.split("@");if(s&&t)return`${s.substring(0,2)}***@${t}`}return e.length>4?`${e.substring(0,3)}***${e.substring(e.length-2)}`:e};return i?s.jsxs(s.Fragment,{children:[s.jsx(p,{open:a&&!x,onOpenChange:l,children:s.jsxs(g,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(j,{children:[s.jsx(f,{children:"Report Sighting"}),s.jsxs(v,{children:["Report a sighting of ",i.petSummary.name,". Your information will be shared with the owner."]})]}),s.jsxs("div",{className:"space-y-6 py-4",children:[s.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[s.jsxs("h3",{className:"font-semibold mb-2",children:["Lost Pet: ",i.petSummary.name]}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.petSummary.species," â€¢ ",i.petSummary.breed||"Unknown breed"]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(y,{htmlFor:"sightingDate",children:[s.jsx(n,{size:16,className:"inline mr-2"}),"Date of Sighting *"]}),s.jsx(N,{id:"sightingDate",type:"date",value:F,onChange:e=>k(e.target.value),max:(new Date).toISOString().split("T")[0]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(y,{htmlFor:"sightingTime",children:[s.jsx(t,{size:16,className:"inline mr-2"}),"Time of Sighting *"]}),s.jsx(N,{id:"sightingTime",type:"time",value:A,onChange:e=>L(e.target.value)})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Location on Map *"}),s.jsxs(h,{type:"button",variant:"outline",className:"w-full",onClick:()=>C(!0),children:[s.jsx(r,{size:16,className:"mr-2"}),P?"Update Location":"Pick Location on Map"]}),P&&s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Location: ",P.lat.toFixed(4),", ",P.lon.toFixed(4)]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"radiusM",children:"Search Radius"}),s.jsxs("select",{id:"radiusM",value:T,onChange:e=>I(parseInt(e.target.value)),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[s.jsx("option",{value:100,children:"100 m"}),s.jsx("option",{value:250,children:"250 m"}),s.jsx("option",{value:500,children:"500 m"}),s.jsx("option",{value:1e3,children:"1 km"}),s.jsx("option",{value:2e3,children:"2 km"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"description",children:"Description *"}),s.jsx(S,{id:"description",value:z,onChange:e=>D(e.target.value),placeholder:"Describe what you saw, the pet's condition, any distinctive features...",rows:4})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{htmlFor:"contactInfo",children:"Your Contact Information *"}),s.jsx(N,{id:"contactInfo",value:$,onChange:e=>M(e.target.value),placeholder:"Email or phone number"}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Will be partially masked for privacy (e.g., ab***@email.com)"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(y,{children:"Photos (Optional)"}),s.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary/50 transition-colors cursor-pointer",children:[s.jsx(o,{size:24,className:"mx-auto mb-2 text-muted-foreground"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload photos of the sighting"}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Up to 3 photos, max 5MB each"})]})]})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 sticky bottom-0 bg-card pt-4 border-t",children:[s.jsx(h,{variant:"outline",onClick:l,disabled:m,children:"Cancel"}),s.jsx(h,{onClick:async()=>{if(i)if(F&&A&&z)if(P)if($)try{u(!0);const e=await spark.user(),s=new Date(`${F}T${A}`).toISOString();await w.createSighting({alertId:i.id,whenISO:s,lat:P.lat,lon:P.lon,radiusM:T,description:z.trim(),photos:U,contactMask:V($),reporterId:e.id,reporterName:e.login||"Anonymous",reporterAvatar:e.avatarUrl}),c.success("Sighting reported! The owner will be notified."),d(),l(),k(""),L(""),D(""),R(null),M(""),O([])}catch(e){const s=b("ReportSightingDialog"),t=e instanceof Error?e.message:"Failed to report sighting. Please try again.";s.error("Failed to report sighting",e instanceof Error?e:new Error(String(e))),c.error(t)}finally{u(!1)}else c.error("Please provide contact information");else c.error("Please select a location on the map");else c.error("Please fill in all required fields")},disabled:m,children:m?"Submitting...":"Submit Sighting Report"})]})]})}),x&&s.jsx(E,{onSelect:(e,s)=>{R({lat:e,lon:s}),C(!1)},onClose:()=>C(!1),...P?{initialLocation:P}:{}})]}):null}const U=b("LostFoundView");function O(){var t,a,i,l;const{t:n}=C(),[o,u]=e.useState("browse"),[x,p]=e.useState("all"),[g,j]=e.useState([]),[f,v]=e.useState(!0),[y,S]=e.useState(""),[b,T]=F("lost-found-favorites",[]),[E,O]=e.useState(null),[V,B]=e.useState(!1),[Y,q]=e.useState(!1),[K,W]=e.useState(),[G,H]=e.useState(null),J=e.useCallback(async()=>{try{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{H({lat:e.coords.latitude,lon:e.coords.longitude})},()=>{})}catch(e){const s=e instanceof Error?e:new Error(String(e));U.error("Failed to get user location",s,{action:"getUserLocation"})}},[]),Q=e.useCallback(async()=>{try{v(!0);const e={limit:50,...K&&{cursor:K}};if("mine"===o){const e=await spark.user(),s=await w.getUserAlerts(e.id);return j(s),void v(!1)}G&&"all"===x&&(e.location={lat:G.lat,lon:G.lon,radiusKm:50}),"active"===x?e.status=["active"]:"found"===x&&(e.status=["found"]);const s=await w.queryAlerts(e);j(s.alerts),W(s.nextCursor)}catch(e){const s=e instanceof Error?e:new Error(String(e));U.error("Failed to load alerts",s,{action:"loadAlerts"}),c.error("Failed to load lost & found alerts")}finally{v(!1)}},[o,K,G,x]);e.useEffect(()=>{Q(),J()},[Q,J]);const X=e=>{T(s=>{const t=Array.isArray(s)?s:[];return t.includes(e)?t.filter(s=>s!==e):[...t,e]})},Z=e=>{O(e)},_=e=>{O(e),q(!0)},ee=()=>{let e=g;return"favorites"===x&&(e=e.filter(e=>Array.isArray(b)&&b.includes(e.id))),y&&(e=e.filter(e=>{var s,t;return e.petSummary.name.toLowerCase().includes(y.toLowerCase())||(null==(s=e.petSummary.breed)?void 0:s.toLowerCase().includes(y.toLowerCase()))||e.petSummary.species.toLowerCase().includes(y.toLowerCase())||(null==(t=e.lastSeen.description)?void 0:t.toLowerCase().includes(y.toLowerCase()))})),e.sort((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())};if(f&&0===g.length)return s.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),s.jsx("p",{className:"text-muted-foreground",children:n.common.loading})]})});const se=g.filter(e=>"active"===e.status).length,te=g.filter(e=>"found"===e.status).length;return s.jsx(P,{direction:"up",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-3",children:[s.jsx(r,{size:32,weight:"fill",className:"text-primary"}),(null==(t=n.lostFound)?void 0:t.title)||"Lost & Found"]}),s.jsx("p",{className:"text-muted-foreground",children:(null==(a=n.lostFound)?void 0:a.subtitle)||"Report lost pets and help reunite families"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(h,{onClick:()=>u("browse"===o?"mine":"browse"),variant:"outline",children:"browse"===o?"My Alerts":"Browse All"}),s.jsxs(h,{onClick:()=>B(!0),className:"gap-2",children:[s.jsx(d,{size:20,weight:"fill"}),(null==(i=n.lostFound)?void 0:i.reportLost)||"Report Lost Pet"]})]})]}),"browse"===o&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[s.jsxs("div",{className:"flex-1 relative w-full",children:[s.jsx(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),s.jsx(N,{placeholder:(null==(l=n.lostFound)?void 0:l.searchPlaceholder)||"Search by pet name, breed, location...",value:y,onChange:e=>S(e.target.value),className:"pl-10"})]}),s.jsx(k,{value:x,onValueChange:e=>p(e),children:s.jsxs(A,{children:[s.jsxs(L,{value:"all",children:["All ",g.length>0&&`(${g.length})`]}),s.jsxs(L,{value:"active",children:["Active ",se>0&&`(${se})`]}),s.jsxs(L,{value:"found",children:["Found ",te>0&&`(${te})`]}),s.jsxs(L,{value:"favorites",children:["Favorites"," ",Array.isArray(b)&&b.length>0&&`(${b.length})`]})]})})]}),s.jsx(z,{className:"h-[calc(100vh-320px)]",children:s.jsx(R,{mode:"wait",children:0===ee().length?s.jsxs(D,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col items-center justify-center py-16",children:[s.jsx(r,{size:64,className:"text-muted-foreground mb-4",weight:"thin"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"favorites"===x?"No Favorites Yet":y?"No Results Found":"No Active Alerts"}),s.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:"favorites"===x?"Start adding alerts to your favorites to see them here.":y?"Try adjusting your search terms.":"Check back soon for lost pet alerts in your area."})]},"empty"):s.jsx(D,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-6",children:ee().map((e,t)=>s.jsx(D,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},children:s.jsx($,{alert:e,onSelect:Z,onReportSighting:_,isFavorited:Array.isArray(b)&&b.includes(e.id),onToggleFavorite:X})},e.id))},"grid")})})]}),"mine"===o&&s.jsx(z,{className:"h-[calc(100vh-320px)]",children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-6",children:g.map((e,t)=>s.jsx(D,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},children:s.jsx($,{alert:e,onSelect:Z,onReportSighting:_,isFavorited:Array.isArray(b)&&b.includes(e.id),onToggleFavorite:X})},e.id))})}),s.jsx(I,{open:V,onClose:()=>B(!1),onSuccess:()=>{Q(),c.success("Lost pet alert created successfully!")}}),s.jsx(M,{open:Y,alert:E,onClose:()=>{q(!1),O(null)},onSuccess:()=>{Q()}})]})},"lost-found-view")}export{O as default};
