import{r as e,j as s,an as a,W as t,_ as i,am as r}from"./react-vendor-atdIga2R.js";import{A as n,a as o,b as c}from"./index-BUV2g3LC.js";import{aD as l,ap as d,d as u}from"./feature-admin-g8AIjMAb.js";import"./vendor-B2U5onNE.js";import"./utils-vendor-7mYxNw04.js";import"./ui-vendor-CttiZxwU.js";import"./view-CommunityView.tsx-CD5NUxZ2.js";import"./feature-adoption-C919WvgL.js";import"./feature-community-DxZ7YsOF.js";import"./view-AdoptionView.tsx-BJlxubb2.js";import"./view-ProfileView.tsx-CUP3xfdt.js";import"./feature-stories-DX9BRjll.js";import"./feature-chat-CPR2_-OR.js";import"./view-ChatView.tsx-DI-Ea8ls.js";import"simple-peer";function m(){const[m,p]=e.useState(null),[f,h]=e.useState(!1),[y,j]=e.useState(!1);e.useEffect(()=>{x()},[]);const x=async()=>{try{const e=await spark.user(),s=await l.getUserBillingIssue(e.id);s&&!s.resolved&&p(s)}catch(e){const s=e instanceof Error?e:new Error(String(e));d.error("Failed to check billing issues",s,{action:"checkBillingIssues"})}};if(!m||f)return null;const w=Math.max(0,Math.ceil((new Date(m.gracePeriodEnd).getTime()-Date.now())/864e5));return s.jsx("div",{className:"sticky top-16 z-30 px-4 sm:px-6 lg:px-8 py-4",children:s.jsxs(n,{variant:"destructive",className:"relative",children:[s.jsx(a,{className:"h-5 w-5"}),s.jsx("button",{onClick:()=>h(!0),className:"absolute right-4 top-4 opacity-70 hover:opacity-100 transition-opacity","aria-label":"Dismiss",children:s.jsx(t,{className:"h-4 w-4"})}),s.jsx(o,{children:"Payment Issue"}),s.jsxs(c,{className:"mt-2 flex flex-col gap-3",children:[s.jsxs("p",{children:[(()=>{switch(m.type){case"payment_failed":return"Your last payment failed. Please update your payment method.";case"card_expired":return"Your payment card has expired. Please add a new card.";case"insufficient_funds":return"Payment could not be processed due to insufficient funds.";default:return"There is an issue with your subscription payment."}})()," You have ",w," ",1===w?"day":"days"," left in your grace period before your subscription is canceled."]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(u,{size:"sm",variant:"outline",className:"bg-background",onClick:async()=>{if(m){j(!0);try{await l.resolveBillingIssue(m.id),r.success("Payment updated successfully"),p(null)}catch{r.error("Failed to update payment method")}finally{j(!1)}}},disabled:y,children:[s.jsx(i,{className:"h-4 w-4 mr-2"}),y?"Processing...":"Update Payment Method"]})})]})]})})}export{m as BillingIssueBanner};
