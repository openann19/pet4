import{r as e,j as t,bl as s,am as a,a3 as i,a4 as r,aK as n,ak as o}from"./react-vendor-atdIga2R.js";import{a3 as l,ao as c,X as d,A as u,u as p,E as m,m as h,a as f,e as x,f as g,d as v,B as y,I as j,ad as w,ae as N,af as b}from"./feature-admin-g8AIjMAb.js";import{b as C,M as A,C as S,c as k}from"./feature-adoption-C919WvgL.js";function L({children:s,key:a="default",duration:i=300,direction:r="up",className:n}){const o=l(),p=c({key:a,duration:o?0:i,direction:r}),m=d(o?{opacity:1,transform:[]}:p.style),h=e.useMemo(()=>{const e="w-full h-full";return n?`${e} ${n}`:e},[n]);return o?t.jsx("div",{className:h,children:s}):t.jsx(u,{style:m,className:h,children:s})}function E({items:a,renderItem:i,columns:r=3,itemHeight:n=300,gap:o=24,overscan:l=5,className:c="",containerClassName:d="",onEndReached:u,endReachedThreshold:p=200,keyExtractor:m}){const h=e.useRef(null),[f,x]=e.useState(!1),g=e.useRef(void 0),v=Math.ceil(a.length/r),y=n+o,j=s({count:v,getScrollElement:()=>h.current,estimateSize:()=>y,overscan:l}),w=e.useCallback(()=>{if(x(!0),g.current&&clearTimeout(g.current),g.current=window.setTimeout(()=>{x(!1)},150),u&&h.current){const e=h.current;e.scrollHeight-e.scrollTop-e.clientHeight<p&&u()}},[u,p]);return e.useEffect(()=>{const e=h.current;if(e)return e.addEventListener("scroll",w,{passive:!0}),()=>{e.removeEventListener("scroll",w),g.current&&clearTimeout(g.current)}},[w]),t.jsx("div",{ref:h,className:`overflow-y-auto ${d}`,style:{contain:"strict"},children:t.jsx("div",{style:{height:`${j.getTotalSize()}px`,width:"100%",position:"relative"},className:c,children:j.getVirtualItems().map(e=>{const s=e.index*r,l=Math.min(s+r,a.length),c=a.slice(s,l);return t.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${e.start}px)`,display:"grid",gridTemplateColumns:`repeat(${r}, 1fr)`,gap:`${o}px`},"data-index":e.index,children:c.map((e,a)=>{const r=s+a,o=m?m(e,r):r;return t.jsx("div",{style:{height:`${n}px`},children:i(e,r)},o)})},e.index)})})})}const T=g("AdoptionView");const $=Object.freeze(Object.defineProperty({__proto__:null,default:function(){var s,l,c,d,g;const{t:$}=p(),[z,F]=e.useState("browse"),[I,M]=e.useState([]),[P,R]=e.useState(!0),[_,D]=m("adoption-favorites",[]),[B,H]=e.useState(""),[O,V]=e.useState("all"),[W,K]=e.useState(0),[U,Y]=e.useState(null),[q,G]=e.useState(!1),[X,J]=e.useState(!1),[Q,Z]=e.useState(),ee=h(!P);f(),e.useEffect(()=>{te(),se()},[]);const te=async()=>{try{R(!0),await spark.user();const e=await x.getAdoptionProfiles({limit:50}),t=e.profiles.map(e=>({id:e._id,ownerId:e.shelterId,ownerName:e.shelterName,petId:e.petId,petName:e.petName,petBreed:e.breed,petAge:e.age,petGender:e.gender,petSize:e.size,petSpecies:"dog",petPhotos:e.photos,petDescription:e.description,status:"available"===e.status?"active":"pending"===e.status?"pending_review":"adopted"===e.status?"adopted":"pending_review",location:{city:e.location.split(", ")[0]||"",country:e.location.split(", ")[1]||"",privacyRadiusM:1e3},requirements:[],vetDocuments:[],vaccinated:e.vaccinated,spayedNeutered:e.spayedNeutered,microchipped:!1,goodWithKids:e.goodWithKids,goodWithPets:e.goodWithPets,energyLevel:e.energyLevel,temperament:e.personality,reasonForAdoption:e.description||"Looking for a loving home",createdAt:e.postedDate,updatedAt:e.postedDate,viewsCount:0,applicationsCount:0,featured:!1}));M(t),Z(e.nextCursor)}catch(e){const t=e instanceof Error?e:new Error(String(e));T.error("Failed to load listings",t,{action:"loadListings"}),a.error("Failed to load adoption listings")}finally{R(!1)}},se=async()=>{try{const e=await spark.user(),t=await x.getUserApplications(e.id);K(t.length)}catch(e){const t=e instanceof Error?e:new Error(String(e));T.error("Failed to load user applications count",t,{action:"loadUserApplicationsCount"})}},ae=e.useCallback(e=>{D(t=>{const s=Array.isArray(t)?t:[];return s.includes(e)?s.filter(t=>t!==e):[...s,e]})},[D]),ie=e.useCallback(e=>{Y(e),G(!0)},[]),re=e.useCallback(e=>t.jsx(C,{listing:e,onSelect:ie,onFavorite:ae,isFavorited:Array.isArray(_)&&_.includes(e.id)}),[_,ie,ae]),ne=e.useCallback(e=>e.id,[]),oe=e.useMemo(()=>{let e=I.filter(e=>"active"===e.status);return"available"===O?e=e.filter(e=>"active"===e.status):"favorites"===O&&(e=e.filter(e=>Array.isArray(_)&&_.includes(e.id))),B&&(e=e.filter(e=>e.petName.toLowerCase().includes(B.toLowerCase())||e.petBreed.toLowerCase().includes(B.toLowerCase())||e.location.city.toLowerCase().includes(B.toLowerCase())||e.location.country.toLowerCase().includes(B.toLowerCase()))),e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},[I,O,_,B]);if("my-applications"===z)return t.jsx(A,{onBack:()=>F("browse")});const le=I.filter(e=>"active"===e.status).length;return P&&0===I.length?t.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),t.jsx("p",{className:"text-muted-foreground",children:$.common.loading})]})}):t.jsx(L,{direction:"up",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-3xl font-bold flex items-center gap-3",children:[t.jsx(i,{size:32,weight:"fill",className:"text-primary"}),(null==(s=$.adoption)?void 0:s.title)||"Pet Adoption"]}),t.jsx("p",{className:"text-muted-foreground",children:(null==(l=$.adoption)?void 0:l.subtitle)||"Find your perfect companion and give them a forever home"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(v,{onClick:()=>F("my-applications"),variant:"outline",className:"gap-2",children:[t.jsx(r,{size:20,weight:"fill"}),(null==(c=$.adoption)?void 0:c.myApplications)||"My Applications",W>0&&t.jsx(y,{variant:"secondary",className:"ml-1",children:W})]}),t.jsxs(v,{onClick:()=>J(!0),className:"gap-2",children:[t.jsx(n,{size:20,weight:"fill"}),(null==(d=$.adoption)?void 0:d.createListing)||"Create Listing"]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[t.jsxs("div",{className:"flex-1 relative w-full",children:[t.jsx(o,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:20}),t.jsx(j,{placeholder:"Search by pet name, breed, location...",value:B,onChange:e=>H(e.target.value),className:"pl-10"})]}),t.jsx(w,{value:O,onValueChange:e=>V(e),children:t.jsxs(N,{children:[t.jsxs(b,{value:"all",children:["All ",I.length>0&&`(${I.length})`]}),t.jsxs(b,{value:"available",children:[(null==(g=$.adoption)?void 0:g.available)||"Available"," ",le>0&&`(${le})`]}),t.jsxs(b,{value:"favorites",children:["Favorites"," ",Array.isArray(_)&&_.length>0&&`(${_.length})`]})]})})]}),t.jsx("div",{className:"h-[calc(100vh-320px)]",children:ee.shouldRender&&!P&&t.jsx(u,{style:ee.animatedStyle,children:0===oe.length?t.jsxs(u,{className:"flex flex-col items-center justify-center py-16",children:[t.jsx(i,{size:64,className:"text-muted-foreground mb-4",weight:"thin"}),t.jsx("h3",{className:"text-xl font-semibold mb-2",children:"favorites"===O?"No Favorites Yet":B?"No Results Found":"No Pets Available"}),t.jsx("p",{className:"text-muted-foreground text-center max-w-md",children:"favorites"===O?"Start adding pets to your favorites to see them here.":B?"Try adjusting your search terms or filters.":"Check back soon for new pets looking for their forever homes."})]},"empty"):t.jsx(E,{items:oe,renderItem:re,columns:3,itemHeight:400,gap:24,overscan:5,containerClassName:"h-full",keyExtractor:ne})})}),t.jsx(S,{open:X,onOpenChange:J,onSuccess:()=>{te(),se()}}),t.jsx(k,{listing:U,open:q,onOpenChange:e=>{G(e),e||Y(null),se()},onApplicationSubmitted:()=>{se()}})]})},"adoption-view")}},Symbol.toStringTag,{value:"Module"}));export{$ as A,L as P,E as V};
